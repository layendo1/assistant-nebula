var zo=Object.defineProperty;var Ho=(n,e,t)=>e in n?zo(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var I=(n,e,t)=>Ho(n,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const u of r.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&i(u)}).observe(document,{childList:!0,subtree:!0});function t(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(o){if(o.ep)return;o.ep=!0;const r=t(o);fetch(o.href,r)}})();/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Bt{}function k(n,e){const t=/\{([^}]+)\}/g;return n.replace(t,(i,o)=>{if(Object.prototype.hasOwnProperty.call(e,o)){const r=e[o];return r!=null?String(r):""}else throw new Error(`Key '${o}' not found in valueMap.`)})}function s(n,e,t){for(let r=0;r<e.length-1;r++){const u=e[r];if(u.endsWith("[]")){const l=u.slice(0,-2);if(!(l in n))if(Array.isArray(t))n[l]=Array.from({length:t.length},()=>({}));else throw new Error(`Value must be a list given an array path ${u}`);if(Array.isArray(n[l])){const c=n[l];if(Array.isArray(t))for(let d=0;d<c.length;d++){const p=c[d];s(p,e.slice(r+1),t[d])}else for(const d of c)s(d,e.slice(r+1),t)}return}else if(u.endsWith("[0]")){const l=u.slice(0,-3);l in n||(n[l]=[{}]);const c=n[l];s(c[0],e.slice(r+1),t);return}(!n[u]||typeof n[u]!="object")&&(n[u]={}),n=n[u]}const i=e[e.length-1],o=n[i];if(o!==void 0){if(!t||typeof t=="object"&&Object.keys(t).length===0||t===o)return;if(typeof o=="object"&&typeof t=="object"&&o!==null&&t!==null)Object.assign(o,t);else throw new Error(`Cannot set value for an existing key. Key: ${i}`)}else n[i]=t}function a(n,e){try{if(e.length===1&&e[0]==="_self")return n;for(let t=0;t<e.length;t++){if(typeof n!="object"||n===null)return;const i=e[t];if(i.endsWith("[]")){const o=i.slice(0,-2);if(o in n){const r=n[o];return Array.isArray(r)?r.map(u=>a(u,e.slice(t+1))):void 0}else return}else n=n[i]}return n}catch(t){if(t instanceof TypeError)return;throw t}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function J(n,e){if(!e||typeof e!="string")throw new Error("model is required and must be a string");if(n.isVertexAI()){if(e.startsWith("publishers/")||e.startsWith("projects/")||e.startsWith("models/"))return e;if(e.indexOf("/")>=0){const t=e.split("/",2);return`publishers/${t[0]}/models/${t[1]}`}else return`publishers/google/models/${e}`}else return e.startsWith("models/")||e.startsWith("tunedModels/")?e:`models/${e}`}function Wi(n,e){const t=J(n,e);return t?t.startsWith("publishers/")&&n.isVertexAI()?`projects/${n.getProject()}/locations/${n.getLocation()}/${t}`:t.startsWith("models/")&&n.isVertexAI()?`projects/${n.getProject()}/locations/${n.getLocation()}/publishers/google/${t}`:t:""}function Kn(n,e){if(e==null)throw new Error("PartUnion is required");if(typeof e=="object")return e;if(typeof e=="string")return{text:e};throw new Error(`Unsupported part type: ${typeof e}`)}function Ye(n,e){if(e==null||Array.isArray(e)&&e.length===0)throw new Error("PartListUnion is required");return Array.isArray(e)?e.map(t=>Kn(n,t)):[Kn(n,e)]}function Qi(n){return n!=null&&typeof n=="object"&&"parts"in n&&Array.isArray(n.parts)}function Go(n){return n!=null&&typeof n=="object"&&"functionCall"in n}function Sn(n){return!(n==null||Go(n))}function Zi(n){return n==null||Array.isArray(n)&&n.length===0?!1:n.every(Sn)}function Z(n,e){if(e==null)throw new Error("ContentUnion is required");return Qi(e)?e:Sn(e)?{role:"user",parts:Ye(n,e)}:{role:"model",parts:Ye(n,e)}}function Xi(n,e){if(!e)return[];if(n.isVertexAI()&&Array.isArray(e))return e.flatMap(t=>{const i=Z(n,t);return i.parts&&i.parts.length>0&&i.parts[0].text!==void 0?[i.parts[0].text]:[]});if(n.isVertexAI()){const t=Z(n,e);return t.parts&&t.parts.length>0&&t.parts[0].text!==void 0?[t.parts[0].text]:[]}return Array.isArray(e)?e.map(t=>Z(n,t)):[Z(n,e)]}function ct(n,e,t){t.length!==0&&(Zi(t)?e.push({role:"user",parts:Ye(n,t)}):e.push({role:"model",parts:Ye(n,t)}),t.length=0)}function Uo(n,e,t,i){Sn(i)===Zi(t)||(ct(n,e,t),t.length=0),t.push(i)}function N(n,e){if(e==null||Array.isArray(e)&&e.length===0)throw new Error("contents are required");if(!Array.isArray(e))return[Z(n,e)];const t=[],i=[];for(const o of e)if(Qi(o))ct(n,t,i),t.push(o);else if(typeof o=="string"||typeof o=="object"&&!Array.isArray(o))Uo(n,t,i,o);else if(Array.isArray(o))ct(n,t,i),t.push({role:"user",parts:Ye(n,o)});else throw new Error(`Unsupported content type: ${typeof o}`);return ct(n,t,i),t}function dt(n,e){if(!n.isVertexAI()&&"default"in e)throw new Error("Default value is not supported in the response schema for the Gemini API.");if("anyOf"in e&&e.anyOf!==void 0)for(const t of e.anyOf)dt(n,t);if("items"in e&&e.items!==void 0&&dt(n,e.items),"properties"in e&&e.properties!==void 0)for(const t of Object.values(e.properties))dt(n,t)}function ji(n,e){return dt(n,e),e}function eo(n,e){if(typeof e=="object"&&"voiceConfig"in e)return e;if(typeof e=="string")return{voiceConfig:{prebuiltVoiceConfig:{voiceName:e}}};throw new Error(`Unsupported speechConfig type: ${typeof e}`)}function to(n,e){return e}function qe(n,e){if(!Array.isArray(e))throw new Error("tool is required and must be an array of Tools");return e}function Oo(n,e,t,i=1){const o=!e.startsWith(`${t}/`)&&e.split("/").length===i;return n.isVertexAI()?e.startsWith("projects/")?e:e.startsWith("locations/")?`projects/${n.getProject()}/${e}`:e.startsWith(`${t}/`)?`projects/${n.getProject()}/locations/${n.getLocation()}/${e}`:o?`projects/${n.getProject()}/locations/${n.getLocation()}/${t}/${e}`:e:o?`${t}/${e}`:e}function Ce(n,e){if(typeof e!="string")throw new Error("name must be a string");return Oo(n,e,"cachedContents")}function Ee(n,e){if(typeof e!="string")throw new Error("fromImageBytes must be a string");return e}function no(n,e){if(typeof e!="string")throw new Error("fromName must be a string");return e.startsWith("files/")?e.split("files/")[1]:e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Ko(n,e){const t={};if(a(e,["videoMetadata"])!==void 0)throw new Error("videoMetadata parameter is not supported in Gemini API.");const i=a(e,["thought"]);i!=null&&s(t,["thought"],i);const o=a(e,["codeExecutionResult"]);o!=null&&s(t,["codeExecutionResult"],o);const r=a(e,["executableCode"]);r!=null&&s(t,["executableCode"],r);const u=a(e,["fileData"]);u!=null&&s(t,["fileData"],u);const l=a(e,["functionCall"]);l!=null&&s(t,["functionCall"],l);const c=a(e,["functionResponse"]);c!=null&&s(t,["functionResponse"],c);const d=a(e,["inlineData"]);d!=null&&s(t,["inlineData"],d);const p=a(e,["text"]);return p!=null&&s(t,["text"],p),t}function Yn(n,e){const t={},i=a(e,["parts"]);i!=null&&(Array.isArray(i)?s(t,["parts"],i.map(r=>Ko(n,r))):s(t,["parts"],i));const o=a(e,["role"]);return o!=null&&s(t,["role"],o),t}function Yo(n,e){const t={};if(a(e,["response"])!==void 0)throw new Error("response parameter is not supported in Gemini API.");const i=a(e,["description"]);i!=null&&s(t,["description"],i);const o=a(e,["name"]);o!=null&&s(t,["name"],o);const r=a(e,["parameters"]);return r!=null&&s(t,["parameters"],r),t}function Jo(){return{}}function Wo(n,e){const t={},i=a(e,["mode"]);i!=null&&s(t,["mode"],i);const o=a(e,["dynamicThreshold"]);return o!=null&&s(t,["dynamicThreshold"],o),t}function Qo(n,e){const t={},i=a(e,["dynamicRetrievalConfig"]);return i!=null&&s(t,["dynamicRetrievalConfig"],Wo(n,i)),t}function Zo(n,e){const t={},i=a(e,["functionDeclarations"]);if(i!=null&&(Array.isArray(i)?s(t,["functionDeclarations"],i.map(l=>Yo(n,l))):s(t,["functionDeclarations"],i)),a(e,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");a(e,["googleSearch"])!=null&&s(t,["googleSearch"],Jo());const r=a(e,["googleSearchRetrieval"]);r!=null&&s(t,["googleSearchRetrieval"],Qo(n,r));const u=a(e,["codeExecution"]);return u!=null&&s(t,["codeExecution"],u),t}function Xo(n,e){const t={},i=a(e,["mode"]);i!=null&&s(t,["mode"],i);const o=a(e,["allowedFunctionNames"]);return o!=null&&s(t,["allowedFunctionNames"],o),t}function jo(n,e){const t={},i=a(e,["functionCallingConfig"]);return i!=null&&s(t,["functionCallingConfig"],Xo(n,i)),t}function er(n,e,t){const i={},o=a(e,["ttl"]);t!==void 0&&o!=null&&s(t,["ttl"],o);const r=a(e,["expireTime"]);t!==void 0&&r!=null&&s(t,["expireTime"],r);const u=a(e,["displayName"]);t!==void 0&&u!=null&&s(t,["displayName"],u);const l=a(e,["contents"]);t!==void 0&&l!=null&&(Array.isArray(l)?s(t,["contents"],N(n,N(n,l).map(f=>Yn(n,f)))):s(t,["contents"],N(n,l)));const c=a(e,["systemInstruction"]);t!==void 0&&c!=null&&s(t,["systemInstruction"],Yn(n,Z(n,c)));const d=a(e,["tools"]);t!==void 0&&d!=null&&(Array.isArray(d)?s(t,["tools"],d.map(f=>Zo(n,f))):s(t,["tools"],d));const p=a(e,["toolConfig"]);return t!==void 0&&p!=null&&s(t,["toolConfig"],jo(n,p)),i}function tr(n,e){const t={},i=a(e,["model"]);i!=null&&s(t,["model"],Wi(n,i));const o=a(e,["config"]);return o!=null&&s(t,["config"],er(n,o,t)),t}function nr(n,e){const t={},i=a(e,["name"]);i!=null&&s(t,["_url","name"],Ce(n,i));const o=a(e,["config"]);return o!=null&&s(t,["config"],o),t}function ir(n,e){const t={},i=a(e,["name"]);i!=null&&s(t,["_url","name"],Ce(n,i));const o=a(e,["config"]);return o!=null&&s(t,["config"],o),t}function or(n,e,t){const i={},o=a(e,["ttl"]);t!==void 0&&o!=null&&s(t,["ttl"],o);const r=a(e,["expireTime"]);return t!==void 0&&r!=null&&s(t,["expireTime"],r),i}function rr(n,e){const t={},i=a(e,["name"]);i!=null&&s(t,["_url","name"],Ce(n,i));const o=a(e,["config"]);return o!=null&&s(t,["config"],or(n,o,t)),t}function sr(n,e,t){const i={},o=a(e,["pageSize"]);t!==void 0&&o!=null&&s(t,["_query","pageSize"],o);const r=a(e,["pageToken"]);return t!==void 0&&r!=null&&s(t,["_query","pageToken"],r),i}function ar(n,e){const t={},i=a(e,["config"]);return i!=null&&s(t,["config"],sr(n,i,t)),t}function lr(n,e){const t={},i=a(e,["videoMetadata"]);i!=null&&s(t,["videoMetadata"],i);const o=a(e,["thought"]);o!=null&&s(t,["thought"],o);const r=a(e,["codeExecutionResult"]);r!=null&&s(t,["codeExecutionResult"],r);const u=a(e,["executableCode"]);u!=null&&s(t,["executableCode"],u);const l=a(e,["fileData"]);l!=null&&s(t,["fileData"],l);const c=a(e,["functionCall"]);c!=null&&s(t,["functionCall"],c);const d=a(e,["functionResponse"]);d!=null&&s(t,["functionResponse"],d);const p=a(e,["inlineData"]);p!=null&&s(t,["inlineData"],p);const f=a(e,["text"]);return f!=null&&s(t,["text"],f),t}function Jn(n,e){const t={},i=a(e,["parts"]);i!=null&&(Array.isArray(i)?s(t,["parts"],i.map(r=>lr(n,r))):s(t,["parts"],i));const o=a(e,["role"]);return o!=null&&s(t,["role"],o),t}function ur(n,e){const t={},i=a(e,["example"]);i!=null&&s(t,["example"],i);const o=a(e,["pattern"]);o!=null&&s(t,["pattern"],o);const r=a(e,["default"]);r!=null&&s(t,["default"],r);const u=a(e,["maxLength"]);u!=null&&s(t,["maxLength"],u);const l=a(e,["minLength"]);l!=null&&s(t,["minLength"],l);const c=a(e,["minProperties"]);c!=null&&s(t,["minProperties"],c);const d=a(e,["maxProperties"]);d!=null&&s(t,["maxProperties"],d);const p=a(e,["anyOf"]);p!=null&&s(t,["anyOf"],p);const f=a(e,["description"]);f!=null&&s(t,["description"],f);const h=a(e,["enum"]);h!=null&&s(t,["enum"],h);const m=a(e,["format"]);m!=null&&s(t,["format"],m);const g=a(e,["items"]);g!=null&&s(t,["items"],g);const y=a(e,["maxItems"]);y!=null&&s(t,["maxItems"],y);const C=a(e,["maximum"]);C!=null&&s(t,["maximum"],C);const E=a(e,["minItems"]);E!=null&&s(t,["minItems"],E);const x=a(e,["minimum"]);x!=null&&s(t,["minimum"],x);const w=a(e,["nullable"]);w!=null&&s(t,["nullable"],w);const P=a(e,["properties"]);P!=null&&s(t,["properties"],P);const q=a(e,["propertyOrdering"]);q!=null&&s(t,["propertyOrdering"],q);const A=a(e,["required"]);A!=null&&s(t,["required"],A);const R=a(e,["title"]);R!=null&&s(t,["title"],R);const $=a(e,["type"]);return $!=null&&s(t,["type"],$),t}function cr(n,e){const t={},i=a(e,["response"]);i!=null&&s(t,["response"],ur(n,i));const o=a(e,["description"]);o!=null&&s(t,["description"],o);const r=a(e,["name"]);r!=null&&s(t,["name"],r);const u=a(e,["parameters"]);return u!=null&&s(t,["parameters"],u),t}function dr(){return{}}function pr(n,e){const t={},i=a(e,["mode"]);i!=null&&s(t,["mode"],i);const o=a(e,["dynamicThreshold"]);return o!=null&&s(t,["dynamicThreshold"],o),t}function fr(n,e){const t={},i=a(e,["dynamicRetrievalConfig"]);return i!=null&&s(t,["dynamicRetrievalConfig"],pr(n,i)),t}function hr(n,e){const t={},i=a(e,["functionDeclarations"]);i!=null&&(Array.isArray(i)?s(t,["functionDeclarations"],i.map(c=>cr(n,c))):s(t,["functionDeclarations"],i));const o=a(e,["retrieval"]);o!=null&&s(t,["retrieval"],o),a(e,["googleSearch"])!=null&&s(t,["googleSearch"],dr());const u=a(e,["googleSearchRetrieval"]);u!=null&&s(t,["googleSearchRetrieval"],fr(n,u));const l=a(e,["codeExecution"]);return l!=null&&s(t,["codeExecution"],l),t}function mr(n,e){const t={},i=a(e,["mode"]);i!=null&&s(t,["mode"],i);const o=a(e,["allowedFunctionNames"]);return o!=null&&s(t,["allowedFunctionNames"],o),t}function gr(n,e){const t={},i=a(e,["functionCallingConfig"]);return i!=null&&s(t,["functionCallingConfig"],mr(n,i)),t}function yr(n,e,t){const i={},o=a(e,["ttl"]);t!==void 0&&o!=null&&s(t,["ttl"],o);const r=a(e,["expireTime"]);t!==void 0&&r!=null&&s(t,["expireTime"],r);const u=a(e,["displayName"]);t!==void 0&&u!=null&&s(t,["displayName"],u);const l=a(e,["contents"]);t!==void 0&&l!=null&&(Array.isArray(l)?s(t,["contents"],N(n,N(n,l).map(f=>Jn(n,f)))):s(t,["contents"],N(n,l)));const c=a(e,["systemInstruction"]);t!==void 0&&c!=null&&s(t,["systemInstruction"],Jn(n,Z(n,c)));const d=a(e,["tools"]);t!==void 0&&d!=null&&(Array.isArray(d)?s(t,["tools"],d.map(f=>hr(n,f))):s(t,["tools"],d));const p=a(e,["toolConfig"]);return t!==void 0&&p!=null&&s(t,["toolConfig"],gr(n,p)),i}function vr(n,e){const t={},i=a(e,["model"]);i!=null&&s(t,["model"],Wi(n,i));const o=a(e,["config"]);return o!=null&&s(t,["config"],yr(n,o,t)),t}function Tr(n,e){const t={},i=a(e,["name"]);i!=null&&s(t,["_url","name"],Ce(n,i));const o=a(e,["config"]);return o!=null&&s(t,["config"],o),t}function Cr(n,e){const t={},i=a(e,["name"]);i!=null&&s(t,["_url","name"],Ce(n,i));const o=a(e,["config"]);return o!=null&&s(t,["config"],o),t}function Er(n,e,t){const i={},o=a(e,["ttl"]);t!==void 0&&o!=null&&s(t,["ttl"],o);const r=a(e,["expireTime"]);return t!==void 0&&r!=null&&s(t,["expireTime"],r),i}function xr(n,e){const t={},i=a(e,["name"]);i!=null&&s(t,["_url","name"],Ce(n,i));const o=a(e,["config"]);return o!=null&&s(t,["config"],Er(n,o,t)),t}function Sr(n,e,t){const i={},o=a(e,["pageSize"]);t!==void 0&&o!=null&&s(t,["_query","pageSize"],o);const r=a(e,["pageToken"]);return t!==void 0&&r!=null&&s(t,["_query","pageToken"],r),i}function wr(n,e){const t={},i=a(e,["config"]);return i!=null&&s(t,["config"],Sr(n,i,t)),t}function pt(n,e){const t={},i=a(e,["name"]);i!=null&&s(t,["name"],i);const o=a(e,["displayName"]);o!=null&&s(t,["displayName"],o);const r=a(e,["model"]);r!=null&&s(t,["model"],r);const u=a(e,["createTime"]);u!=null&&s(t,["createTime"],u);const l=a(e,["updateTime"]);l!=null&&s(t,["updateTime"],l);const c=a(e,["expireTime"]);c!=null&&s(t,["expireTime"],c);const d=a(e,["usageMetadata"]);return d!=null&&s(t,["usageMetadata"],d),t}function kr(){return{}}function br(n,e){const t={},i=a(e,["nextPageToken"]);i!=null&&s(t,["nextPageToken"],i);const o=a(e,["cachedContents"]);return o!=null&&(Array.isArray(o)?s(t,["cachedContents"],o.map(r=>pt(n,r))):s(t,["cachedContents"],o)),t}function ft(n,e){const t={},i=a(e,["name"]);i!=null&&s(t,["name"],i);const o=a(e,["displayName"]);o!=null&&s(t,["displayName"],o);const r=a(e,["model"]);r!=null&&s(t,["model"],r);const u=a(e,["createTime"]);u!=null&&s(t,["createTime"],u);const l=a(e,["updateTime"]);l!=null&&s(t,["updateTime"],l);const c=a(e,["expireTime"]);c!=null&&s(t,["expireTime"],c);const d=a(e,["usageMetadata"]);return d!=null&&s(t,["usageMetadata"],d),t}function Ar(){return{}}function Ir(n,e){const t={},i=a(e,["nextPageToken"]);i!=null&&s(t,["nextPageToken"],i);const o=a(e,["cachedContents"]);return o!=null&&(Array.isArray(o)?s(t,["cachedContents"],o.map(r=>ft(n,r))):s(t,["cachedContents"],o)),t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var yt;(function(n){n.PAGED_ITEM_BATCH_JOBS="batchJobs",n.PAGED_ITEM_MODELS="models",n.PAGED_ITEM_TUNING_JOBS="tuningJobs",n.PAGED_ITEM_FILES="files",n.PAGED_ITEM_CACHED_CONTENTS="cachedContents"})(yt||(yt={}));class io{constructor(e,t,i,o){this.pageInternal=[],this.paramsInternal={},this.requestInternal=t,this.init(e,i,o)}init(e,t,i){var o,r;this.nameInternal=e,this.pageInternal=t[this.nameInternal]||[],this.idxInternal=0;let u={config:{}};i?typeof i=="object"?u=Object.assign({},i):u=i:u={config:{}},u.config&&(u.config.pageToken=t.nextPageToken),this.paramsInternal=u,this.pageInternalSize=(r=(o=u.config)===null||o===void 0?void 0:o.pageSize)!==null&&r!==void 0?r:this.pageInternal.length}initNextPage(e){this.init(this.nameInternal,e,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(e){return this.pageInternal[e]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(this.hasNextPage())await this.nextPage();else return{value:void 0,done:!0};const e=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:e,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw new Error("No more pages to fetch.");const e=await this.requestInternal(this.params);return this.initNextPage(e),this.page}hasNextPage(){var e;return((e=this.params.config)===null||e===void 0?void 0:e.pageToken)!==void 0}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var Wn;(function(n){n.OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",n.OUTCOME_OK="OUTCOME_OK",n.OUTCOME_FAILED="OUTCOME_FAILED",n.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED"})(Wn||(Wn={}));var Qn;(function(n){n.LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",n.PYTHON="PYTHON"})(Qn||(Qn={}));var _;(function(n){n.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",n.STRING="STRING",n.NUMBER="NUMBER",n.INTEGER="INTEGER",n.BOOLEAN="BOOLEAN",n.ARRAY="ARRAY",n.OBJECT="OBJECT"})(_||(_={}));var Zn;(function(n){n.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",n.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",n.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",n.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",n.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",n.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY"})(Zn||(Zn={}));var Xn;(function(n){n.HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",n.SEVERITY="SEVERITY",n.PROBABILITY="PROBABILITY"})(Xn||(Xn={}));var jn;(function(n){n.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",n.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",n.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",n.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",n.BLOCK_NONE="BLOCK_NONE",n.OFF="OFF"})(jn||(jn={}));var ei;(function(n){n.MODE_UNSPECIFIED="MODE_UNSPECIFIED",n.MODE_DYNAMIC="MODE_DYNAMIC"})(ei||(ei={}));var ti;(function(n){n.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",n.STOP="STOP",n.MAX_TOKENS="MAX_TOKENS",n.SAFETY="SAFETY",n.RECITATION="RECITATION",n.OTHER="OTHER",n.BLOCKLIST="BLOCKLIST",n.PROHIBITED_CONTENT="PROHIBITED_CONTENT",n.SPII="SPII",n.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",n.IMAGE_SAFETY="IMAGE_SAFETY"})(ti||(ti={}));var ni;(function(n){n.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",n.NEGLIGIBLE="NEGLIGIBLE",n.LOW="LOW",n.MEDIUM="MEDIUM",n.HIGH="HIGH"})(ni||(ni={}));var ii;(function(n){n.HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",n.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",n.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",n.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",n.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"})(ii||(ii={}));var oi;(function(n){n.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",n.SAFETY="SAFETY",n.OTHER="OTHER",n.BLOCKLIST="BLOCKLIST",n.PROHIBITED_CONTENT="PROHIBITED_CONTENT"})(oi||(oi={}));var ri;(function(n){n.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",n.TEXT="TEXT",n.IMAGE="IMAGE",n.AUDIO="AUDIO"})(ri||(ri={}));var si;(function(n){n.STATE_UNSPECIFIED="STATE_UNSPECIFIED",n.ACTIVE="ACTIVE",n.ERROR="ERROR"})(si||(si={}));var ai;(function(n){n.MODE_UNSPECIFIED="MODE_UNSPECIFIED",n.MODE_DYNAMIC="MODE_DYNAMIC"})(ai||(ai={}));var li;(function(n){n.MODE_UNSPECIFIED="MODE_UNSPECIFIED",n.AUTO="AUTO",n.ANY="ANY",n.NONE="NONE"})(li||(li={}));var ui;(function(n){n.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",n.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",n.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",n.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"})(ui||(ui={}));var ci;(function(n){n.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",n.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",n.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",n.BLOCK_NONE="BLOCK_NONE"})(ci||(ci={}));var di;(function(n){n.DONT_ALLOW="DONT_ALLOW",n.ALLOW_ADULT="ALLOW_ADULT",n.ALLOW_ALL="ALLOW_ALL"})(di||(di={}));var pi;(function(n){n.auto="auto",n.en="en",n.ja="ja",n.ko="ko",n.hi="hi"})(pi||(pi={}));var fi;(function(n){n.STATE_UNSPECIFIED="STATE_UNSPECIFIED",n.PROCESSING="PROCESSING",n.ACTIVE="ACTIVE",n.FAILED="FAILED"})(fi||(fi={}));var hi;(function(n){n.SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",n.UPLOADED="UPLOADED",n.GENERATED="GENERATED"})(hi||(hi={}));var mi;(function(n){n.MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",n.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",n.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",n.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",n.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC"})(mi||(mi={}));var gi;(function(n){n.CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",n.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",n.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",n.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH"})(gi||(gi={}));var yi;(function(n){n.SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",n.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",n.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",n.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT"})(yi||(yi={}));var vi;(function(n){n.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",n.TEXT="TEXT",n.IMAGE="IMAGE",n.VIDEO="VIDEO",n.AUDIO="AUDIO",n.DOCUMENT="DOCUMENT"})(vi||(vi={}));class ot{get text(){var e,t,i,o,r,u,l,c;if(((o=(i=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||i===void 0?void 0:i.parts)===null||o===void 0?void 0:o.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let d="",p=!1;const f=[];for(const h of(c=(l=(u=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||u===void 0?void 0:u.content)===null||l===void 0?void 0:l.parts)!==null&&c!==void 0?c:[]){for(const[m,g]of Object.entries(h))m!=="text"&&m!=="thought"&&(g!==null||g!==void 0)&&f.push(m);if(typeof h.text=="string"){if(typeof h.thought=="boolean"&&h.thought)continue;p=!0,d+=h.text}}return f.length>0&&console.warn(`there are non-text parts ${f} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),p?d:void 0}get functionCalls(){var e,t,i,o,r,u,l,c;if(((o=(i=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||i===void 0?void 0:i.parts)===null||o===void 0?void 0:o.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");const d=(c=(l=(u=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||u===void 0?void 0:u.content)===null||l===void 0?void 0:l.parts)===null||c===void 0?void 0:c.filter(p=>p.functionCall).map(p=>p.functionCall).filter(p=>p!==void 0);if((d==null?void 0:d.length)!==0)return d}get executableCode(){var e,t,i,o,r,u,l,c,d;if(((o=(i=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||i===void 0?void 0:i.parts)===null||o===void 0?void 0:o.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");const p=(c=(l=(u=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||u===void 0?void 0:u.content)===null||l===void 0?void 0:l.parts)===null||c===void 0?void 0:c.filter(f=>f.executableCode).map(f=>f.executableCode).filter(f=>f!==void 0);if((p==null?void 0:p.length)!==0)return(d=p==null?void 0:p[0])===null||d===void 0?void 0:d.code}get codeExecutionResult(){var e,t,i,o,r,u,l,c,d;if(((o=(i=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||i===void 0?void 0:i.parts)===null||o===void 0?void 0:o.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");const p=(c=(l=(u=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||u===void 0?void 0:u.content)===null||l===void 0?void 0:l.parts)===null||c===void 0?void 0:c.filter(f=>f.codeExecutionResult).map(f=>f.codeExecutionResult).filter(f=>f!==void 0);if((p==null?void 0:p.length)!==0)return(d=p==null?void 0:p[0])===null||d===void 0?void 0:d.output}}class Ti{}class Ci{}class Ei{}class Lr{}class xi{}class Si{}class Mr{}class oo{constructor(e){const t={};for(const i of e.headers.entries())t[i[0]]=i[1];this.headers=t,this.responseInternal=e}json(){return this.responseInternal.json()}}class Rr{}class Pr{}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class _r extends Bt{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new io(yt.PAGED_ITEM_CACHED_CONTENTS,i=>this.listInternal(i),await this.listInternal(t),t)}async create(e){var t,i;let o,r="",u={};if(this.apiClient.isVertexAI()){const l=vr(this.apiClient,e);return r=k("cachedContents",l._url),u=l._query,delete l.config,delete l._url,delete l._query,o=this.apiClient.request({path:r,queryParams:u,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions}).then(c=>c.json()),o.then(c=>ft(this.apiClient,c))}else{const l=tr(this.apiClient,e);return r=k("cachedContents",l._url),u=l._query,delete l.config,delete l._url,delete l._query,o=this.apiClient.request({path:r,queryParams:u,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions}).then(c=>c.json()),o.then(c=>pt(this.apiClient,c))}}async get(e){var t,i;let o,r="",u={};if(this.apiClient.isVertexAI()){const l=Tr(this.apiClient,e);return r=k("{name}",l._url),u=l._query,delete l.config,delete l._url,delete l._query,o=this.apiClient.request({path:r,queryParams:u,body:JSON.stringify(l),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions}).then(c=>c.json()),o.then(c=>ft(this.apiClient,c))}else{const l=nr(this.apiClient,e);return r=k("{name}",l._url),u=l._query,delete l.config,delete l._url,delete l._query,o=this.apiClient.request({path:r,queryParams:u,body:JSON.stringify(l),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions}).then(c=>c.json()),o.then(c=>pt(this.apiClient,c))}}async delete(e){var t,i;let o,r="",u={};if(this.apiClient.isVertexAI()){const l=Cr(this.apiClient,e);return r=k("{name}",l._url),u=l._query,delete l.config,delete l._url,delete l._query,o=this.apiClient.request({path:r,queryParams:u,body:JSON.stringify(l),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions}).then(c=>c.json()),o.then(()=>{const c=Ar(),d=new xi;return Object.assign(d,c),d})}else{const l=ir(this.apiClient,e);return r=k("{name}",l._url),u=l._query,delete l.config,delete l._url,delete l._query,o=this.apiClient.request({path:r,queryParams:u,body:JSON.stringify(l),httpMethod:"DELETE",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions}).then(c=>c.json()),o.then(()=>{const c=kr(),d=new xi;return Object.assign(d,c),d})}}async update(e){var t,i;let o,r="",u={};if(this.apiClient.isVertexAI()){const l=xr(this.apiClient,e);return r=k("{name}",l._url),u=l._query,delete l.config,delete l._url,delete l._query,o=this.apiClient.request({path:r,queryParams:u,body:JSON.stringify(l),httpMethod:"PATCH",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions}).then(c=>c.json()),o.then(c=>ft(this.apiClient,c))}else{const l=rr(this.apiClient,e);return r=k("{name}",l._url),u=l._query,delete l.config,delete l._url,delete l._query,o=this.apiClient.request({path:r,queryParams:u,body:JSON.stringify(l),httpMethod:"PATCH",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions}).then(c=>c.json()),o.then(c=>pt(this.apiClient,c))}}async listInternal(e){var t,i;let o,r="",u={};if(this.apiClient.isVertexAI()){const l=wr(this.apiClient,e);return r=k("cachedContents",l._url),u=l._query,delete l.config,delete l._url,delete l._query,o=this.apiClient.request({path:r,queryParams:u,body:JSON.stringify(l),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions}).then(c=>c.json()),o.then(c=>{const d=Ir(this.apiClient,c),p=new Si;return Object.assign(p,d),p})}else{const l=ar(this.apiClient,e);return r=k("cachedContents",l._url),u=l._query,delete l.config,delete l._url,delete l._query,o=this.apiClient.request({path:r,queryParams:u,body:JSON.stringify(l),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions}).then(c=>c.json()),o.then(c=>{const d=br(this.apiClient,c),p=new Si;return Object.assign(p,d),p})}}}function wi(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],i=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&i>=n.length&&(n=void 0),{value:n&&n[i++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function O(n){return this instanceof O?(this.v=n,this):new O(n)}function vt(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=t.apply(n,e||[]),o,r=[];return o=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),l("next"),l("throw"),l("return",u),o[Symbol.asyncIterator]=function(){return this},o;function u(m){return function(g){return Promise.resolve(g).then(m,f)}}function l(m,g){i[m]&&(o[m]=function(y){return new Promise(function(C,E){r.push([m,y,C,E])>1||c(m,y)})},g&&(o[m]=g(o[m])))}function c(m,g){try{d(i[m](g))}catch(y){h(r[0][3],y)}}function d(m){m.value instanceof O?Promise.resolve(m.value.v).then(p,f):h(r[0][2],m)}function p(m){c("next",m)}function f(m){c("throw",m)}function h(m,g){m(g),r.shift(),r.length&&c(r[0][0],r[0][1])}}function Zt(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=n[Symbol.asyncIterator],t;return e?e.call(n):(n=typeof wi=="function"?wi(n):n[Symbol.iterator](),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(r){t[r]=n[r]&&function(u){return new Promise(function(l,c){u=n[r](u),o(l,c,u.done,u.value)})}}function o(r,u,l,c){Promise.resolve(c).then(function(d){r({value:d,done:l})},u)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Nr(n){var e;if(n.candidates==null||n.candidates.length===0)return!1;const t=(e=n.candidates[0])===null||e===void 0?void 0:e.content;return t===void 0?!1:ro(t)}function ro(n){if(n.parts===void 0||n.parts.length===0)return!1;for(const e of n.parts)if(e===void 0||Object.keys(e).length===0||e.text!==void 0&&e.text==="")return!1;return!0}function qr(n){if(n.length!==0){if(n[0].role!=="user")throw new Error("History must start with a user turn.");for(const e of n)if(e.role!=="user"&&e.role!=="model")throw new Error(`Role must be user or model, but got ${e.role}.`)}}function $r(n){if(n===void 0||n.length===0)return[];const e=[],t=n.length;let i=0,o=n[0];for(;i<t;)if(n[i].role==="user")o=n[i],i++;else{const r=[];let u=!0;for(;i<t&&n[i].role==="model";)r.push(n[i]),u&&!ro(n[i])&&(u=!1),i++;u&&(e.push(o),e.push(...r))}return e}class Fr{constructor(e,t){this.modelsModule=e,this.apiClient=t}create(e){return new Dr(this.apiClient,this.modelsModule,e.model,e.config,e.history)}}class Dr{constructor(e,t,i,o={},r=[]){this.apiClient=e,this.modelsModule=t,this.model=i,this.config=o,this.history=r,this.sendPromise=Promise.resolve(),qr(r)}async sendMessage(e){var t;await this.sendPromise;const i=Z(this.apiClient,e.message),o=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(i),config:(t=e.config)!==null&&t!==void 0?t:this.config});return this.sendPromise=(async()=>{var r,u;const c=(u=(r=(await o).candidates)===null||r===void 0?void 0:r[0])===null||u===void 0?void 0:u.content,d=c?[c]:[];this.recordHistory(i,d)})(),await this.sendPromise,o}async sendMessageStream(e){var t;await this.sendPromise;const i=Z(this.apiClient,e.message),o=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(i),config:(t=e.config)!==null&&t!==void 0?t:this.config});this.sendPromise=o.then(()=>{});const r=await o;return this.processStreamResponse(r,i)}getHistory(e=!1){return e?$r(this.history):this.history}processStreamResponse(e,t){var i,o;return vt(this,arguments,function*(){var u,l,c,d;const p=[];try{for(var f=!0,h=Zt(e),m;m=yield O(h.next()),u=m.done,!u;f=!0){d=m.value,f=!1;const g=d;if(Nr(g)){const y=(o=(i=g.candidates)===null||i===void 0?void 0:i[0])===null||o===void 0?void 0:o.content;y!==void 0&&p.push(y)}yield yield O(g)}}catch(g){l={error:g}}finally{try{!f&&!u&&(c=h.return)&&(yield O(c.call(h)))}finally{if(l)throw l.error}}this.recordHistory(t,p)})}recordHistory(e,t){let i=[];t.length>0&&t.every(o=>o.role==="model")?i=t:i.push({role:"model",parts:[]}),this.history.push(e),this.history.push(...i)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Vr(n,e,t){const i={},o=a(e,["pageSize"]);t!==void 0&&o!=null&&s(t,["_query","pageSize"],o);const r=a(e,["pageToken"]);return t!==void 0&&r!=null&&s(t,["_query","pageToken"],r),i}function Br(n,e){const t={},i=a(e,["config"]);return i!=null&&s(t,["config"],Vr(n,i,t)),t}function zr(n,e){const t={},i=a(e,["details"]);i!=null&&s(t,["details"],i);const o=a(e,["message"]);o!=null&&s(t,["message"],o);const r=a(e,["code"]);return r!=null&&s(t,["code"],r),t}function Hr(n,e){const t={},i=a(e,["name"]);i!=null&&s(t,["name"],i);const o=a(e,["displayName"]);o!=null&&s(t,["displayName"],o);const r=a(e,["mimeType"]);r!=null&&s(t,["mimeType"],r);const u=a(e,["sizeBytes"]);u!=null&&s(t,["sizeBytes"],u);const l=a(e,["createTime"]);l!=null&&s(t,["createTime"],l);const c=a(e,["expirationTime"]);c!=null&&s(t,["expirationTime"],c);const d=a(e,["updateTime"]);d!=null&&s(t,["updateTime"],d);const p=a(e,["sha256Hash"]);p!=null&&s(t,["sha256Hash"],p);const f=a(e,["uri"]);f!=null&&s(t,["uri"],f);const h=a(e,["downloadUri"]);h!=null&&s(t,["downloadUri"],h);const m=a(e,["state"]);m!=null&&s(t,["state"],m);const g=a(e,["source"]);g!=null&&s(t,["source"],g);const y=a(e,["videoMetadata"]);y!=null&&s(t,["videoMetadata"],y);const C=a(e,["error"]);return C!=null&&s(t,["error"],zr(n,C)),t}function Gr(n,e){const t={},i=a(e,["file"]);i!=null&&s(t,["file"],Hr(n,i));const o=a(e,["config"]);return o!=null&&s(t,["config"],o),t}function Ur(n,e){const t={},i=a(e,["name"]);i!=null&&s(t,["_url","file"],no(n,i));const o=a(e,["config"]);return o!=null&&s(t,["config"],o),t}function Or(n,e){const t={},i=a(e,["name"]);i!=null&&s(t,["_url","file"],no(n,i));const o=a(e,["config"]);return o!=null&&s(t,["config"],o),t}function Kr(n,e){const t={},i=a(e,["details"]);i!=null&&s(t,["details"],i);const o=a(e,["message"]);o!=null&&s(t,["message"],o);const r=a(e,["code"]);return r!=null&&s(t,["code"],r),t}function Xt(n,e){const t={},i=a(e,["name"]);i!=null&&s(t,["name"],i);const o=a(e,["displayName"]);o!=null&&s(t,["displayName"],o);const r=a(e,["mimeType"]);r!=null&&s(t,["mimeType"],r);const u=a(e,["sizeBytes"]);u!=null&&s(t,["sizeBytes"],u);const l=a(e,["createTime"]);l!=null&&s(t,["createTime"],l);const c=a(e,["expirationTime"]);c!=null&&s(t,["expirationTime"],c);const d=a(e,["updateTime"]);d!=null&&s(t,["updateTime"],d);const p=a(e,["sha256Hash"]);p!=null&&s(t,["sha256Hash"],p);const f=a(e,["uri"]);f!=null&&s(t,["uri"],f);const h=a(e,["downloadUri"]);h!=null&&s(t,["downloadUri"],h);const m=a(e,["state"]);m!=null&&s(t,["state"],m);const g=a(e,["source"]);g!=null&&s(t,["source"],g);const y=a(e,["videoMetadata"]);y!=null&&s(t,["videoMetadata"],y);const C=a(e,["error"]);return C!=null&&s(t,["error"],Kr(n,C)),t}function Yr(n,e){const t={},i=a(e,["nextPageToken"]);i!=null&&s(t,["nextPageToken"],i);const o=a(e,["files"]);return o!=null&&(Array.isArray(o)?s(t,["files"],o.map(r=>Xt(n,r))):s(t,["files"],o)),t}function Jr(n,e){const t={},i=a(e,["httpHeaders"]);return i!=null&&s(t,["httpHeaders"],i),t}function Wr(){return{}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Qr extends Bt{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new io(yt.PAGED_ITEM_FILES,i=>this.listInternal(i),await this.listInternal(t),t)}async upload(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(e.file,e.config).then(t=>Xt(this.apiClient,t))}async listInternal(e){var t;let i,o="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=Br(this.apiClient,e);return o=k("files",u._url),r=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:o,queryParams:r,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions}).then(l=>l.json()),i.then(l=>{const c=Yr(this.apiClient,l),d=new Mr;return Object.assign(d,c),d})}}async createInternal(e){var t;let i,o="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=Gr(this.apiClient,e);return o=k("upload/v1beta/files",u._url),r=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:o,queryParams:r,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions}).then(l=>l.json()),i.then(l=>{const c=Jr(this.apiClient,l),d=new Rr;return Object.assign(d,c),d})}}async get(e){var t;let i,o="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=Ur(this.apiClient,e);return o=k("files/{file}",u._url),r=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:o,queryParams:r,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions}).then(l=>l.json()),i.then(l=>Xt(this.apiClient,l))}}async delete(e){var t;let i,o="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=Or(this.apiClient,e);return o=k("files/{file}",u._url),r=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:o,queryParams:r,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions}).then(l=>l.json()),i.then(()=>{const l=Wr(),c=new Pr;return Object.assign(c,l),c})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Zr(n,e){const t={};if(a(e,["videoMetadata"])!==void 0)throw new Error("videoMetadata parameter is not supported in Gemini API.");const i=a(e,["thought"]);i!=null&&s(t,["thought"],i);const o=a(e,["codeExecutionResult"]);o!=null&&s(t,["codeExecutionResult"],o);const r=a(e,["executableCode"]);r!=null&&s(t,["executableCode"],r);const u=a(e,["fileData"]);u!=null&&s(t,["fileData"],u);const l=a(e,["functionCall"]);l!=null&&s(t,["functionCall"],l);const c=a(e,["functionResponse"]);c!=null&&s(t,["functionResponse"],c);const d=a(e,["inlineData"]);d!=null&&s(t,["inlineData"],d);const p=a(e,["text"]);return p!=null&&s(t,["text"],p),t}function et(n,e){const t={},i=a(e,["parts"]);i!=null&&(Array.isArray(i)?s(t,["parts"],i.map(r=>Zr(n,r))):s(t,["parts"],i));const o=a(e,["role"]);return o!=null&&s(t,["role"],o),t}function Xr(n,e){const t={};if(a(e,["example"])!==void 0)throw new Error("example parameter is not supported in Gemini API.");if(a(e,["pattern"])!==void 0)throw new Error("pattern parameter is not supported in Gemini API.");if(a(e,["default"])!==void 0)throw new Error("default parameter is not supported in Gemini API.");if(a(e,["maxLength"])!==void 0)throw new Error("maxLength parameter is not supported in Gemini API.");if(a(e,["minLength"])!==void 0)throw new Error("minLength parameter is not supported in Gemini API.");if(a(e,["minProperties"])!==void 0)throw new Error("minProperties parameter is not supported in Gemini API.");if(a(e,["maxProperties"])!==void 0)throw new Error("maxProperties parameter is not supported in Gemini API.");const i=a(e,["anyOf"]);i!=null&&s(t,["anyOf"],i);const o=a(e,["description"]);o!=null&&s(t,["description"],o);const r=a(e,["enum"]);r!=null&&s(t,["enum"],r);const u=a(e,["format"]);u!=null&&s(t,["format"],u);const l=a(e,["items"]);l!=null&&s(t,["items"],l);const c=a(e,["maxItems"]);c!=null&&s(t,["maxItems"],c);const d=a(e,["maximum"]);d!=null&&s(t,["maximum"],d);const p=a(e,["minItems"]);p!=null&&s(t,["minItems"],p);const f=a(e,["minimum"]);f!=null&&s(t,["minimum"],f);const h=a(e,["nullable"]);h!=null&&s(t,["nullable"],h);const m=a(e,["properties"]);m!=null&&s(t,["properties"],m);const g=a(e,["propertyOrdering"]);g!=null&&s(t,["propertyOrdering"],g);const y=a(e,["required"]);y!=null&&s(t,["required"],y);const C=a(e,["title"]);C!=null&&s(t,["title"],C);const E=a(e,["type"]);return E!=null&&s(t,["type"],E),t}function jr(n,e){const t={};if(a(e,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const i=a(e,["category"]);i!=null&&s(t,["category"],i);const o=a(e,["threshold"]);return o!=null&&s(t,["threshold"],o),t}function es(n,e){const t={};if(a(e,["response"])!==void 0)throw new Error("response parameter is not supported in Gemini API.");const i=a(e,["description"]);i!=null&&s(t,["description"],i);const o=a(e,["name"]);o!=null&&s(t,["name"],o);const r=a(e,["parameters"]);return r!=null&&s(t,["parameters"],r),t}function ts(){return{}}function ns(n,e){const t={},i=a(e,["mode"]);i!=null&&s(t,["mode"],i);const o=a(e,["dynamicThreshold"]);return o!=null&&s(t,["dynamicThreshold"],o),t}function is(n,e){const t={},i=a(e,["dynamicRetrievalConfig"]);return i!=null&&s(t,["dynamicRetrievalConfig"],ns(n,i)),t}function so(n,e){const t={},i=a(e,["functionDeclarations"]);if(i!=null&&(Array.isArray(i)?s(t,["functionDeclarations"],i.map(l=>es(n,l))):s(t,["functionDeclarations"],i)),a(e,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");a(e,["googleSearch"])!=null&&s(t,["googleSearch"],ts());const r=a(e,["googleSearchRetrieval"]);r!=null&&s(t,["googleSearchRetrieval"],is(n,r));const u=a(e,["codeExecution"]);return u!=null&&s(t,["codeExecution"],u),t}function os(n,e){const t={},i=a(e,["mode"]);i!=null&&s(t,["mode"],i);const o=a(e,["allowedFunctionNames"]);return o!=null&&s(t,["allowedFunctionNames"],o),t}function rs(n,e){const t={},i=a(e,["functionCallingConfig"]);return i!=null&&s(t,["functionCallingConfig"],os(n,i)),t}function ss(n,e){const t={},i=a(e,["voiceName"]);return i!=null&&s(t,["voiceName"],i),t}function as(n,e){const t={},i=a(e,["prebuiltVoiceConfig"]);return i!=null&&s(t,["prebuiltVoiceConfig"],ss(n,i)),t}function ls(n,e){const t={},i=a(e,["voiceConfig"]);return i!=null&&s(t,["voiceConfig"],as(n,i)),t}function us(n,e){const t={},i=a(e,["includeThoughts"]);return i!=null&&s(t,["includeThoughts"],i),t}function cs(n,e,t){const i={},o=a(e,["systemInstruction"]);t!==void 0&&o!=null&&s(t,["systemInstruction"],et(n,Z(n,o)));const r=a(e,["temperature"]);r!=null&&s(i,["temperature"],r);const u=a(e,["topP"]);u!=null&&s(i,["topP"],u);const l=a(e,["topK"]);l!=null&&s(i,["topK"],l);const c=a(e,["candidateCount"]);c!=null&&s(i,["candidateCount"],c);const d=a(e,["maxOutputTokens"]);d!=null&&s(i,["maxOutputTokens"],d);const p=a(e,["stopSequences"]);p!=null&&s(i,["stopSequences"],p);const f=a(e,["responseLogprobs"]);f!=null&&s(i,["responseLogprobs"],f);const h=a(e,["logprobs"]);h!=null&&s(i,["logprobs"],h);const m=a(e,["presencePenalty"]);m!=null&&s(i,["presencePenalty"],m);const g=a(e,["frequencyPenalty"]);g!=null&&s(i,["frequencyPenalty"],g);const y=a(e,["seed"]);y!=null&&s(i,["seed"],y);const C=a(e,["responseMimeType"]);C!=null&&s(i,["responseMimeType"],C);const E=a(e,["responseSchema"]);if(E!=null&&s(i,["responseSchema"],Xr(n,ji(n,E))),a(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");const x=a(e,["safetySettings"]);t!==void 0&&x!=null&&(Array.isArray(x)?s(t,["safetySettings"],x.map(B=>jr(n,B))):s(t,["safetySettings"],x));const w=a(e,["tools"]);t!==void 0&&w!=null&&(Array.isArray(w)?s(t,["tools"],qe(n,qe(n,w).map(B=>so(n,to(n,B))))):s(t,["tools"],qe(n,w)));const P=a(e,["toolConfig"]);if(t!==void 0&&P!=null&&s(t,["toolConfig"],rs(n,P)),a(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const q=a(e,["cachedContent"]);t!==void 0&&q!=null&&s(t,["cachedContent"],Ce(n,q));const A=a(e,["responseModalities"]);A!=null&&s(i,["responseModalities"],A);const R=a(e,["mediaResolution"]);R!=null&&s(i,["mediaResolution"],R);const $=a(e,["speechConfig"]);if($!=null&&s(i,["speechConfig"],ls(n,eo(n,$))),a(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const V=a(e,["thinkingConfig"]);return V!=null&&s(i,["thinkingConfig"],us(n,V)),i}function ki(n,e){const t={},i=a(e,["model"]);i!=null&&s(t,["_url","model"],J(n,i));const o=a(e,["contents"]);o!=null&&(Array.isArray(o)?s(t,["contents"],N(n,N(n,o).map(u=>et(n,u)))):s(t,["contents"],N(n,o)));const r=a(e,["config"]);return r!=null&&s(t,["generationConfig"],cs(n,r,t)),t}function ds(n,e,t){const i={},o=a(e,["taskType"]);t!==void 0&&o!=null&&s(t,["requests[]","taskType"],o);const r=a(e,["title"]);t!==void 0&&r!=null&&s(t,["requests[]","title"],r);const u=a(e,["outputDimensionality"]);if(t!==void 0&&u!=null&&s(t,["requests[]","outputDimensionality"],u),a(e,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(a(e,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return i}function ps(n,e){const t={},i=a(e,["model"]);i!=null&&s(t,["_url","model"],J(n,i));const o=a(e,["contents"]);o!=null&&s(t,["requests[]","content"],Xi(n,o));const r=a(e,["config"]);r!=null&&s(t,["config"],ds(n,r,t));const u=a(e,["model"]);return u!==void 0&&s(t,["requests[]","model"],J(n,u)),t}function fs(n,e,t){const i={};if(a(e,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(a(e,["negativePrompt"])!==void 0)throw new Error("negativePrompt parameter is not supported in Gemini API.");const o=a(e,["numberOfImages"]);t!==void 0&&o!=null&&s(t,["parameters","sampleCount"],o);const r=a(e,["aspectRatio"]);t!==void 0&&r!=null&&s(t,["parameters","aspectRatio"],r);const u=a(e,["guidanceScale"]);if(t!==void 0&&u!=null&&s(t,["parameters","guidanceScale"],u),a(e,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const l=a(e,["safetyFilterLevel"]);t!==void 0&&l!=null&&s(t,["parameters","safetySetting"],l);const c=a(e,["personGeneration"]);t!==void 0&&c!=null&&s(t,["parameters","personGeneration"],c);const d=a(e,["includeSafetyAttributes"]);t!==void 0&&d!=null&&s(t,["parameters","includeSafetyAttributes"],d);const p=a(e,["includeRaiReason"]);t!==void 0&&p!=null&&s(t,["parameters","includeRaiReason"],p);const f=a(e,["language"]);t!==void 0&&f!=null&&s(t,["parameters","language"],f);const h=a(e,["outputMimeType"]);t!==void 0&&h!=null&&s(t,["parameters","outputOptions","mimeType"],h);const m=a(e,["outputCompressionQuality"]);if(t!==void 0&&m!=null&&s(t,["parameters","outputOptions","compressionQuality"],m),a(e,["addWatermark"])!==void 0)throw new Error("addWatermark parameter is not supported in Gemini API.");if(a(e,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return i}function hs(n,e){const t={},i=a(e,["model"]);i!=null&&s(t,["_url","model"],J(n,i));const o=a(e,["prompt"]);o!=null&&s(t,["instances[0]","prompt"],o);const r=a(e,["config"]);return r!=null&&s(t,["config"],fs(n,r,t)),t}function ms(n,e){const t={};if(a(e,["systemInstruction"])!==void 0)throw new Error("systemInstruction parameter is not supported in Gemini API.");if(a(e,["tools"])!==void 0)throw new Error("tools parameter is not supported in Gemini API.");if(a(e,["generationConfig"])!==void 0)throw new Error("generationConfig parameter is not supported in Gemini API.");return t}function gs(n,e){const t={},i=a(e,["model"]);i!=null&&s(t,["_url","model"],J(n,i));const o=a(e,["contents"]);o!=null&&(Array.isArray(o)?s(t,["contents"],N(n,N(n,o).map(u=>et(n,u)))):s(t,["contents"],N(n,o)));const r=a(e,["config"]);return r!=null&&s(t,["config"],ms(n,r)),t}function ys(n,e){const t={};if(a(e,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");const i=a(e,["imageBytes"]);i!=null&&s(t,["bytesBase64Encoded"],Ee(n,i));const o=a(e,["mimeType"]);return o!=null&&s(t,["mimeType"],o),t}function vs(n,e,t){const i={},o=a(e,["numberOfVideos"]);if(t!==void 0&&o!=null&&s(t,["parameters","sampleCount"],o),a(e,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(a(e,["fps"])!==void 0)throw new Error("fps parameter is not supported in Gemini API.");const r=a(e,["durationSeconds"]);if(t!==void 0&&r!=null&&s(t,["parameters","durationSeconds"],r),a(e,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const u=a(e,["aspectRatio"]);if(t!==void 0&&u!=null&&s(t,["parameters","aspectRatio"],u),a(e,["resolution"])!==void 0)throw new Error("resolution parameter is not supported in Gemini API.");const l=a(e,["personGeneration"]);if(t!==void 0&&l!=null&&s(t,["parameters","personGeneration"],l),a(e,["pubsubTopic"])!==void 0)throw new Error("pubsubTopic parameter is not supported in Gemini API.");const c=a(e,["negativePrompt"]);if(t!==void 0&&c!=null&&s(t,["parameters","negativePrompt"],c),a(e,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return i}function Ts(n,e){const t={},i=a(e,["model"]);i!=null&&s(t,["_url","model"],J(n,i));const o=a(e,["prompt"]);o!=null&&s(t,["instances[0]","prompt"],o);const r=a(e,["image"]);r!=null&&s(t,["instances[0]","image"],ys(n,r));const u=a(e,["config"]);return u!=null&&s(t,["config"],vs(n,u,t)),t}function Cs(n,e){const t={},i=a(e,["videoMetadata"]);i!=null&&s(t,["videoMetadata"],i);const o=a(e,["thought"]);o!=null&&s(t,["thought"],o);const r=a(e,["codeExecutionResult"]);r!=null&&s(t,["codeExecutionResult"],r);const u=a(e,["executableCode"]);u!=null&&s(t,["executableCode"],u);const l=a(e,["fileData"]);l!=null&&s(t,["fileData"],l);const c=a(e,["functionCall"]);c!=null&&s(t,["functionCall"],c);const d=a(e,["functionResponse"]);d!=null&&s(t,["functionResponse"],d);const p=a(e,["inlineData"]);p!=null&&s(t,["inlineData"],p);const f=a(e,["text"]);return f!=null&&s(t,["text"],f),t}function Le(n,e){const t={},i=a(e,["parts"]);i!=null&&(Array.isArray(i)?s(t,["parts"],i.map(r=>Cs(n,r))):s(t,["parts"],i));const o=a(e,["role"]);return o!=null&&s(t,["role"],o),t}function ao(n,e){const t={},i=a(e,["example"]);i!=null&&s(t,["example"],i);const o=a(e,["pattern"]);o!=null&&s(t,["pattern"],o);const r=a(e,["default"]);r!=null&&s(t,["default"],r);const u=a(e,["maxLength"]);u!=null&&s(t,["maxLength"],u);const l=a(e,["minLength"]);l!=null&&s(t,["minLength"],l);const c=a(e,["minProperties"]);c!=null&&s(t,["minProperties"],c);const d=a(e,["maxProperties"]);d!=null&&s(t,["maxProperties"],d);const p=a(e,["anyOf"]);p!=null&&s(t,["anyOf"],p);const f=a(e,["description"]);f!=null&&s(t,["description"],f);const h=a(e,["enum"]);h!=null&&s(t,["enum"],h);const m=a(e,["format"]);m!=null&&s(t,["format"],m);const g=a(e,["items"]);g!=null&&s(t,["items"],g);const y=a(e,["maxItems"]);y!=null&&s(t,["maxItems"],y);const C=a(e,["maximum"]);C!=null&&s(t,["maximum"],C);const E=a(e,["minItems"]);E!=null&&s(t,["minItems"],E);const x=a(e,["minimum"]);x!=null&&s(t,["minimum"],x);const w=a(e,["nullable"]);w!=null&&s(t,["nullable"],w);const P=a(e,["properties"]);P!=null&&s(t,["properties"],P);const q=a(e,["propertyOrdering"]);q!=null&&s(t,["propertyOrdering"],q);const A=a(e,["required"]);A!=null&&s(t,["required"],A);const R=a(e,["title"]);R!=null&&s(t,["title"],R);const $=a(e,["type"]);return $!=null&&s(t,["type"],$),t}function Es(n,e){const t={},i=a(e,["method"]);i!=null&&s(t,["method"],i);const o=a(e,["category"]);o!=null&&s(t,["category"],o);const r=a(e,["threshold"]);return r!=null&&s(t,["threshold"],r),t}function xs(n,e){const t={},i=a(e,["response"]);i!=null&&s(t,["response"],ao(n,i));const o=a(e,["description"]);o!=null&&s(t,["description"],o);const r=a(e,["name"]);r!=null&&s(t,["name"],r);const u=a(e,["parameters"]);return u!=null&&s(t,["parameters"],u),t}function Ss(){return{}}function ws(n,e){const t={},i=a(e,["mode"]);i!=null&&s(t,["mode"],i);const o=a(e,["dynamicThreshold"]);return o!=null&&s(t,["dynamicThreshold"],o),t}function ks(n,e){const t={},i=a(e,["dynamicRetrievalConfig"]);return i!=null&&s(t,["dynamicRetrievalConfig"],ws(n,i)),t}function wn(n,e){const t={},i=a(e,["functionDeclarations"]);i!=null&&(Array.isArray(i)?s(t,["functionDeclarations"],i.map(c=>xs(n,c))):s(t,["functionDeclarations"],i));const o=a(e,["retrieval"]);o!=null&&s(t,["retrieval"],o),a(e,["googleSearch"])!=null&&s(t,["googleSearch"],Ss());const u=a(e,["googleSearchRetrieval"]);u!=null&&s(t,["googleSearchRetrieval"],ks(n,u));const l=a(e,["codeExecution"]);return l!=null&&s(t,["codeExecution"],l),t}function bs(n,e){const t={},i=a(e,["mode"]);i!=null&&s(t,["mode"],i);const o=a(e,["allowedFunctionNames"]);return o!=null&&s(t,["allowedFunctionNames"],o),t}function As(n,e){const t={},i=a(e,["functionCallingConfig"]);return i!=null&&s(t,["functionCallingConfig"],bs(n,i)),t}function Is(n,e){const t={},i=a(e,["voiceName"]);return i!=null&&s(t,["voiceName"],i),t}function Ls(n,e){const t={},i=a(e,["prebuiltVoiceConfig"]);return i!=null&&s(t,["prebuiltVoiceConfig"],Is(n,i)),t}function Ms(n,e){const t={},i=a(e,["voiceConfig"]);return i!=null&&s(t,["voiceConfig"],Ls(n,i)),t}function Rs(n,e){const t={},i=a(e,["includeThoughts"]);return i!=null&&s(t,["includeThoughts"],i),t}function Ps(n,e,t){const i={},o=a(e,["systemInstruction"]);t!==void 0&&o!=null&&s(t,["systemInstruction"],Le(n,Z(n,o)));const r=a(e,["temperature"]);r!=null&&s(i,["temperature"],r);const u=a(e,["topP"]);u!=null&&s(i,["topP"],u);const l=a(e,["topK"]);l!=null&&s(i,["topK"],l);const c=a(e,["candidateCount"]);c!=null&&s(i,["candidateCount"],c);const d=a(e,["maxOutputTokens"]);d!=null&&s(i,["maxOutputTokens"],d);const p=a(e,["stopSequences"]);p!=null&&s(i,["stopSequences"],p);const f=a(e,["responseLogprobs"]);f!=null&&s(i,["responseLogprobs"],f);const h=a(e,["logprobs"]);h!=null&&s(i,["logprobs"],h);const m=a(e,["presencePenalty"]);m!=null&&s(i,["presencePenalty"],m);const g=a(e,["frequencyPenalty"]);g!=null&&s(i,["frequencyPenalty"],g);const y=a(e,["seed"]);y!=null&&s(i,["seed"],y);const C=a(e,["responseMimeType"]);C!=null&&s(i,["responseMimeType"],C);const E=a(e,["responseSchema"]);E!=null&&s(i,["responseSchema"],ao(n,ji(n,E)));const x=a(e,["routingConfig"]);x!=null&&s(i,["routingConfig"],x);const w=a(e,["safetySettings"]);t!==void 0&&w!=null&&(Array.isArray(w)?s(t,["safetySettings"],w.map(Ot=>Es(n,Ot))):s(t,["safetySettings"],w));const P=a(e,["tools"]);t!==void 0&&P!=null&&(Array.isArray(P)?s(t,["tools"],qe(n,qe(n,P).map(Ot=>wn(n,to(n,Ot))))):s(t,["tools"],qe(n,P)));const q=a(e,["toolConfig"]);t!==void 0&&q!=null&&s(t,["toolConfig"],As(n,q));const A=a(e,["labels"]);t!==void 0&&A!=null&&s(t,["labels"],A);const R=a(e,["cachedContent"]);t!==void 0&&R!=null&&s(t,["cachedContent"],Ce(n,R));const $=a(e,["responseModalities"]);$!=null&&s(i,["responseModalities"],$);const V=a(e,["mediaResolution"]);V!=null&&s(i,["mediaResolution"],V);const B=a(e,["speechConfig"]);B!=null&&s(i,["speechConfig"],Ms(n,eo(n,B)));const ne=a(e,["audioTimestamp"]);ne!=null&&s(i,["audioTimestamp"],ne);const U=a(e,["thinkingConfig"]);return U!=null&&s(i,["thinkingConfig"],Rs(n,U)),i}function bi(n,e){const t={},i=a(e,["model"]);i!=null&&s(t,["_url","model"],J(n,i));const o=a(e,["contents"]);o!=null&&(Array.isArray(o)?s(t,["contents"],N(n,N(n,o).map(u=>Le(n,u)))):s(t,["contents"],N(n,o)));const r=a(e,["config"]);return r!=null&&s(t,["generationConfig"],Ps(n,r,t)),t}function _s(n,e,t){const i={},o=a(e,["taskType"]);t!==void 0&&o!=null&&s(t,["instances[]","task_type"],o);const r=a(e,["title"]);t!==void 0&&r!=null&&s(t,["instances[]","title"],r);const u=a(e,["outputDimensionality"]);t!==void 0&&u!=null&&s(t,["parameters","outputDimensionality"],u);const l=a(e,["mimeType"]);t!==void 0&&l!=null&&s(t,["instances[]","mimeType"],l);const c=a(e,["autoTruncate"]);return t!==void 0&&c!=null&&s(t,["parameters","autoTruncate"],c),i}function Ns(n,e){const t={},i=a(e,["model"]);i!=null&&s(t,["_url","model"],J(n,i));const o=a(e,["contents"]);o!=null&&s(t,["instances[]","content"],Xi(n,o));const r=a(e,["config"]);return r!=null&&s(t,["config"],_s(n,r,t)),t}function qs(n,e,t){const i={},o=a(e,["outputGcsUri"]);t!==void 0&&o!=null&&s(t,["parameters","storageUri"],o);const r=a(e,["negativePrompt"]);t!==void 0&&r!=null&&s(t,["parameters","negativePrompt"],r);const u=a(e,["numberOfImages"]);t!==void 0&&u!=null&&s(t,["parameters","sampleCount"],u);const l=a(e,["aspectRatio"]);t!==void 0&&l!=null&&s(t,["parameters","aspectRatio"],l);const c=a(e,["guidanceScale"]);t!==void 0&&c!=null&&s(t,["parameters","guidanceScale"],c);const d=a(e,["seed"]);t!==void 0&&d!=null&&s(t,["parameters","seed"],d);const p=a(e,["safetyFilterLevel"]);t!==void 0&&p!=null&&s(t,["parameters","safetySetting"],p);const f=a(e,["personGeneration"]);t!==void 0&&f!=null&&s(t,["parameters","personGeneration"],f);const h=a(e,["includeSafetyAttributes"]);t!==void 0&&h!=null&&s(t,["parameters","includeSafetyAttributes"],h);const m=a(e,["includeRaiReason"]);t!==void 0&&m!=null&&s(t,["parameters","includeRaiReason"],m);const g=a(e,["language"]);t!==void 0&&g!=null&&s(t,["parameters","language"],g);const y=a(e,["outputMimeType"]);t!==void 0&&y!=null&&s(t,["parameters","outputOptions","mimeType"],y);const C=a(e,["outputCompressionQuality"]);t!==void 0&&C!=null&&s(t,["parameters","outputOptions","compressionQuality"],C);const E=a(e,["addWatermark"]);t!==void 0&&E!=null&&s(t,["parameters","addWatermark"],E);const x=a(e,["enhancePrompt"]);return t!==void 0&&x!=null&&s(t,["parameters","enhancePrompt"],x),i}function $s(n,e){const t={},i=a(e,["model"]);i!=null&&s(t,["_url","model"],J(n,i));const o=a(e,["prompt"]);o!=null&&s(t,["instances[0]","prompt"],o);const r=a(e,["config"]);return r!=null&&s(t,["config"],qs(n,r,t)),t}function Fs(n,e,t){const i={},o=a(e,["systemInstruction"]);t!==void 0&&o!=null&&s(t,["systemInstruction"],Le(n,Z(n,o)));const r=a(e,["tools"]);t!==void 0&&r!=null&&(Array.isArray(r)?s(t,["tools"],r.map(l=>wn(n,l))):s(t,["tools"],r));const u=a(e,["generationConfig"]);return t!==void 0&&u!=null&&s(t,["generationConfig"],u),i}function Ds(n,e){const t={},i=a(e,["model"]);i!=null&&s(t,["_url","model"],J(n,i));const o=a(e,["contents"]);o!=null&&(Array.isArray(o)?s(t,["contents"],N(n,N(n,o).map(u=>Le(n,u)))):s(t,["contents"],N(n,o)));const r=a(e,["config"]);return r!=null&&s(t,["config"],Fs(n,r,t)),t}function Vs(n,e){const t={},i=a(e,["model"]);i!=null&&s(t,["_url","model"],J(n,i));const o=a(e,["contents"]);o!=null&&(Array.isArray(o)?s(t,["contents"],N(n,N(n,o).map(u=>Le(n,u)))):s(t,["contents"],N(n,o)));const r=a(e,["config"]);return r!=null&&s(t,["config"],r),t}function Bs(n,e){const t={},i=a(e,["gcsUri"]);i!=null&&s(t,["gcsUri"],i);const o=a(e,["imageBytes"]);o!=null&&s(t,["bytesBase64Encoded"],Ee(n,o));const r=a(e,["mimeType"]);return r!=null&&s(t,["mimeType"],r),t}function zs(n,e,t){const i={},o=a(e,["numberOfVideos"]);t!==void 0&&o!=null&&s(t,["parameters","sampleCount"],o);const r=a(e,["outputGcsUri"]);t!==void 0&&r!=null&&s(t,["parameters","storageUri"],r);const u=a(e,["fps"]);t!==void 0&&u!=null&&s(t,["parameters","fps"],u);const l=a(e,["durationSeconds"]);t!==void 0&&l!=null&&s(t,["parameters","durationSeconds"],l);const c=a(e,["seed"]);t!==void 0&&c!=null&&s(t,["parameters","seed"],c);const d=a(e,["aspectRatio"]);t!==void 0&&d!=null&&s(t,["parameters","aspectRatio"],d);const p=a(e,["resolution"]);t!==void 0&&p!=null&&s(t,["parameters","resolution"],p);const f=a(e,["personGeneration"]);t!==void 0&&f!=null&&s(t,["parameters","personGeneration"],f);const h=a(e,["pubsubTopic"]);t!==void 0&&h!=null&&s(t,["parameters","pubsubTopic"],h);const m=a(e,["negativePrompt"]);t!==void 0&&m!=null&&s(t,["parameters","negativePrompt"],m);const g=a(e,["enhancePrompt"]);return t!==void 0&&g!=null&&s(t,["parameters","enhancePrompt"],g),i}function Hs(n,e){const t={},i=a(e,["model"]);i!=null&&s(t,["_url","model"],J(n,i));const o=a(e,["prompt"]);o!=null&&s(t,["instances[0]","prompt"],o);const r=a(e,["image"]);r!=null&&s(t,["instances[0]","image"],Bs(n,r));const u=a(e,["config"]);return u!=null&&s(t,["config"],zs(n,u,t)),t}function Gs(n,e){const t={},i=a(e,["thought"]);i!=null&&s(t,["thought"],i);const o=a(e,["codeExecutionResult"]);o!=null&&s(t,["codeExecutionResult"],o);const r=a(e,["executableCode"]);r!=null&&s(t,["executableCode"],r);const u=a(e,["fileData"]);u!=null&&s(t,["fileData"],u);const l=a(e,["functionCall"]);l!=null&&s(t,["functionCall"],l);const c=a(e,["functionResponse"]);c!=null&&s(t,["functionResponse"],c);const d=a(e,["inlineData"]);d!=null&&s(t,["inlineData"],d);const p=a(e,["text"]);return p!=null&&s(t,["text"],p),t}function lo(n,e){const t={},i=a(e,["parts"]);i!=null&&(Array.isArray(i)?s(t,["parts"],i.map(r=>Gs(n,r))):s(t,["parts"],i));const o=a(e,["role"]);return o!=null&&s(t,["role"],o),t}function Us(n,e){const t={},i=a(e,["citationSources"]);return i!=null&&s(t,["citations"],i),t}function Os(n,e){const t={},i=a(e,["content"]);i!=null&&s(t,["content"],lo(n,i));const o=a(e,["citationMetadata"]);o!=null&&s(t,["citationMetadata"],Us(n,o));const r=a(e,["tokenCount"]);r!=null&&s(t,["tokenCount"],r);const u=a(e,["finishReason"]);u!=null&&s(t,["finishReason"],u);const l=a(e,["avgLogprobs"]);l!=null&&s(t,["avgLogprobs"],l);const c=a(e,["groundingMetadata"]);c!=null&&s(t,["groundingMetadata"],c);const d=a(e,["index"]);d!=null&&s(t,["index"],d);const p=a(e,["logprobsResult"]);p!=null&&s(t,["logprobsResult"],p);const f=a(e,["safetyRatings"]);return f!=null&&s(t,["safetyRatings"],f),t}function Ai(n,e){const t={},i=a(e,["candidates"]);i!=null&&(Array.isArray(i)?s(t,["candidates"],i.map(l=>Os(n,l))):s(t,["candidates"],i));const o=a(e,["modelVersion"]);o!=null&&s(t,["modelVersion"],o);const r=a(e,["promptFeedback"]);r!=null&&s(t,["promptFeedback"],r);const u=a(e,["usageMetadata"]);return u!=null&&s(t,["usageMetadata"],u),t}function Ks(n,e){const t={},i=a(e,["values"]);return i!=null&&s(t,["values"],i),t}function Ys(){return{}}function Js(n,e){const t={},i=a(e,["embeddings"]);return i!=null&&(Array.isArray(i)?s(t,["embeddings"],i.map(r=>Ks(n,r))):s(t,["embeddings"],i)),a(e,["metadata"])!=null&&s(t,["metadata"],Ys()),t}function Ws(n,e){const t={},i=a(e,["bytesBase64Encoded"]);i!=null&&s(t,["imageBytes"],Ee(n,i));const o=a(e,["mimeType"]);return o!=null&&s(t,["mimeType"],o),t}function uo(n,e){const t={},i=a(e,["safetyAttributes","categories"]);i!=null&&s(t,["categories"],i);const o=a(e,["safetyAttributes","scores"]);o!=null&&s(t,["scores"],o);const r=a(e,["contentType"]);return r!=null&&s(t,["contentType"],r),t}function Qs(n,e){const t={},i=a(e,["_self"]);i!=null&&s(t,["image"],Ws(n,i));const o=a(e,["raiFilteredReason"]);o!=null&&s(t,["raiFilteredReason"],o);const r=a(e,["_self"]);return r!=null&&s(t,["safetyAttributes"],uo(n,r)),t}function Zs(n,e){const t={},i=a(e,["predictions"]);i!=null&&(Array.isArray(i)?s(t,["generatedImages"],i.map(r=>Qs(n,r))):s(t,["generatedImages"],i));const o=a(e,["positivePromptSafetyAttributes"]);return o!=null&&s(t,["positivePromptSafetyAttributes"],uo(n,o)),t}function Xs(n,e){const t={},i=a(e,["totalTokens"]);i!=null&&s(t,["totalTokens"],i);const o=a(e,["cachedContentTokenCount"]);return o!=null&&s(t,["cachedContentTokenCount"],o),t}function js(n,e){const t={},i=a(e,["video","uri"]);i!=null&&s(t,["uri"],i);const o=a(e,["video","encodedVideo"]);o!=null&&s(t,["videoBytes"],Ee(n,o));const r=a(e,["encoding"]);return r!=null&&s(t,["mimeType"],r),t}function ea(n,e){const t={},i=a(e,["_self"]);return i!=null&&s(t,["video"],js(n,i)),t}function ta(n,e){const t={},i=a(e,["generatedSamples"]);i!=null&&(Array.isArray(i)?s(t,["generatedVideos"],i.map(u=>ea(n,u))):s(t,["generatedVideos"],i));const o=a(e,["raiMediaFilteredCount"]);o!=null&&s(t,["raiMediaFilteredCount"],o);const r=a(e,["raiMediaFilteredReasons"]);return r!=null&&s(t,["raiMediaFilteredReasons"],r),t}function na(n,e){const t={},i=a(e,["name"]);i!=null&&s(t,["name"],i);const o=a(e,["metadata"]);o!=null&&s(t,["metadata"],o);const r=a(e,["done"]);r!=null&&s(t,["done"],r);const u=a(e,["error"]);u!=null&&s(t,["error"],u);const l=a(e,["response"]);l!=null&&s(t,["response"],l);const c=a(e,["response","generateVideoResponse"]);return c!=null&&s(t,["result"],ta(n,c)),t}function ia(n,e){const t={},i=a(e,["videoMetadata"]);i!=null&&s(t,["videoMetadata"],i);const o=a(e,["thought"]);o!=null&&s(t,["thought"],o);const r=a(e,["codeExecutionResult"]);r!=null&&s(t,["codeExecutionResult"],r);const u=a(e,["executableCode"]);u!=null&&s(t,["executableCode"],u);const l=a(e,["fileData"]);l!=null&&s(t,["fileData"],l);const c=a(e,["functionCall"]);c!=null&&s(t,["functionCall"],c);const d=a(e,["functionResponse"]);d!=null&&s(t,["functionResponse"],d);const p=a(e,["inlineData"]);p!=null&&s(t,["inlineData"],p);const f=a(e,["text"]);return f!=null&&s(t,["text"],f),t}function co(n,e){const t={},i=a(e,["parts"]);i!=null&&(Array.isArray(i)?s(t,["parts"],i.map(r=>ia(n,r))):s(t,["parts"],i));const o=a(e,["role"]);return o!=null&&s(t,["role"],o),t}function oa(n,e){const t={},i=a(e,["citations"]);return i!=null&&s(t,["citations"],i),t}function ra(n,e){const t={},i=a(e,["content"]);i!=null&&s(t,["content"],co(n,i));const o=a(e,["citationMetadata"]);o!=null&&s(t,["citationMetadata"],oa(n,o));const r=a(e,["finishMessage"]);r!=null&&s(t,["finishMessage"],r);const u=a(e,["finishReason"]);u!=null&&s(t,["finishReason"],u);const l=a(e,["avgLogprobs"]);l!=null&&s(t,["avgLogprobs"],l);const c=a(e,["groundingMetadata"]);c!=null&&s(t,["groundingMetadata"],c);const d=a(e,["index"]);d!=null&&s(t,["index"],d);const p=a(e,["logprobsResult"]);p!=null&&s(t,["logprobsResult"],p);const f=a(e,["safetyRatings"]);return f!=null&&s(t,["safetyRatings"],f),t}function Ii(n,e){const t={},i=a(e,["candidates"]);i!=null&&(Array.isArray(i)?s(t,["candidates"],i.map(d=>ra(n,d))):s(t,["candidates"],i));const o=a(e,["createTime"]);o!=null&&s(t,["createTime"],o);const r=a(e,["responseId"]);r!=null&&s(t,["responseId"],r);const u=a(e,["modelVersion"]);u!=null&&s(t,["modelVersion"],u);const l=a(e,["promptFeedback"]);l!=null&&s(t,["promptFeedback"],l);const c=a(e,["usageMetadata"]);return c!=null&&s(t,["usageMetadata"],c),t}function sa(n,e){const t={},i=a(e,["truncated"]);i!=null&&s(t,["truncated"],i);const o=a(e,["token_count"]);return o!=null&&s(t,["tokenCount"],o),t}function aa(n,e){const t={},i=a(e,["values"]);i!=null&&s(t,["values"],i);const o=a(e,["statistics"]);return o!=null&&s(t,["statistics"],sa(n,o)),t}function la(n,e){const t={},i=a(e,["billableCharacterCount"]);return i!=null&&s(t,["billableCharacterCount"],i),t}function ua(n,e){const t={},i=a(e,["predictions[]","embeddings"]);i!=null&&(Array.isArray(i)?s(t,["embeddings"],i.map(r=>aa(n,r))):s(t,["embeddings"],i));const o=a(e,["metadata"]);return o!=null&&s(t,["metadata"],la(n,o)),t}function ca(n,e){const t={},i=a(e,["gcsUri"]);i!=null&&s(t,["gcsUri"],i);const o=a(e,["bytesBase64Encoded"]);o!=null&&s(t,["imageBytes"],Ee(n,o));const r=a(e,["mimeType"]);return r!=null&&s(t,["mimeType"],r),t}function po(n,e){const t={},i=a(e,["safetyAttributes","categories"]);i!=null&&s(t,["categories"],i);const o=a(e,["safetyAttributes","scores"]);o!=null&&s(t,["scores"],o);const r=a(e,["contentType"]);return r!=null&&s(t,["contentType"],r),t}function da(n,e){const t={},i=a(e,["_self"]);i!=null&&s(t,["image"],ca(n,i));const o=a(e,["raiFilteredReason"]);o!=null&&s(t,["raiFilteredReason"],o);const r=a(e,["_self"]);r!=null&&s(t,["safetyAttributes"],po(n,r));const u=a(e,["prompt"]);return u!=null&&s(t,["enhancedPrompt"],u),t}function pa(n,e){const t={},i=a(e,["predictions"]);i!=null&&(Array.isArray(i)?s(t,["generatedImages"],i.map(r=>da(n,r))):s(t,["generatedImages"],i));const o=a(e,["positivePromptSafetyAttributes"]);return o!=null&&s(t,["positivePromptSafetyAttributes"],po(n,o)),t}function fa(n,e){const t={},i=a(e,["totalTokens"]);return i!=null&&s(t,["totalTokens"],i),t}function ha(n,e){const t={},i=a(e,["tokensInfo"]);return i!=null&&s(t,["tokensInfo"],i),t}function ma(n,e){const t={},i=a(e,["gcsUri"]);i!=null&&s(t,["uri"],i);const o=a(e,["bytesBase64Encoded"]);o!=null&&s(t,["videoBytes"],Ee(n,o));const r=a(e,["mimeType"]);return r!=null&&s(t,["mimeType"],r),t}function ga(n,e){const t={},i=a(e,["_self"]);return i!=null&&s(t,["video"],ma(n,i)),t}function ya(n,e){const t={},i=a(e,["videos"]);i!=null&&(Array.isArray(i)?s(t,["generatedVideos"],i.map(u=>ga(n,u))):s(t,["generatedVideos"],i));const o=a(e,["raiMediaFilteredCount"]);o!=null&&s(t,["raiMediaFilteredCount"],o);const r=a(e,["raiMediaFilteredReasons"]);return r!=null&&s(t,["raiMediaFilteredReasons"],r),t}function va(n,e){const t={},i=a(e,["name"]);i!=null&&s(t,["name"],i);const o=a(e,["metadata"]);o!=null&&s(t,["metadata"],o);const r=a(e,["done"]);r!=null&&s(t,["done"],r);const u=a(e,["error"]);u!=null&&s(t,["error"],u);const l=a(e,["response"]);l!=null&&s(t,["response"],l);const c=a(e,["response"]);return c!=null&&s(t,["result"],ya(n,c)),t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Ta(n,e){const t={},i=a(e,["config"]);i!=null&&s(t,["setup"],Sa(n,i));const o=a(e,["model"]);return o!==void 0&&s(t,["setup","model"],o),t}function Ca(n,e){const t={},i=a(e,["config"]);i!=null&&s(t,["setup"],wa(n,i));const o=a(e,["model"]);return o!==void 0&&s(t,["setup","model"],o),t}function Ea(n,e){const t={},i=a(e,["setupComplete"]);i!==void 0&&s(t,["setupComplete"],i);const o=a(e,["serverContent"]);o!=null&&s(t,["serverContent"],ka(n,o));const r=a(e,["toolCall"]);r!=null&&s(t,["toolCall"],La(n,r));const u=a(e,["toolCallCancellation"]);return u!=null&&s(t,["toolCallCancellation"],Ra(n,u)),t}function xa(n,e){const t={},i=a(e,["setupComplete"]);i!==void 0&&s(t,["setupComplete"],i);const o=a(e,["serverContent"]);o!=null&&s(t,["serverContent"],ba(n,o));const r=a(e,["toolCall"]);r!=null&&s(t,["toolCall"],Ma(n,r));const u=a(e,["toolCallCancellation"]);return u!=null&&s(t,["toolCallCancellation"],Pa(n,u)),t}function Sa(n,e){const t={},i=a(e,["generationConfig"]);i!==void 0&&s(t,["generationConfig"],i);const o=a(e,["responseModalities"]);o!==void 0&&s(t,["generationConfig","responseModalities"],o);const r=a(e,["speechConfig"]);r!==void 0&&s(t,["generationConfig","speechConfig"],r);const u=a(e,["systemInstruction"]);u!=null&&s(t,["systemInstruction"],et(n,u));const l=a(e,["tools"]);return l!=null&&Array.isArray(l)&&s(t,["tools"],l.map(c=>so(n,c))),t}function wa(n,e){const t={},i=a(e,["generationConfig"]);i!==void 0&&s(t,["generationConfig"],i);const o=a(e,["responseModalities"]);o!==void 0?s(t,["generationConfig","responseModalities"],o):s(t,["generationConfig","responseModalities"],["AUDIO"]);const r=a(e,["speechConfig"]);r!==void 0&&s(t,["generationConfig","speechConfig"],r);const u=a(e,["systemInstruction"]);u!=null&&s(t,["systemInstruction"],Le(n,u));const l=a(e,["tools"]);return l!=null&&Array.isArray(l)&&s(t,["tools"],l.map(c=>wn(n,c))),t}function ka(n,e){const t={},i=a(e,["modelTurn"]);i!=null&&s(t,["modelTurn"],lo(n,i));const o=a(e,["turnComplete"]);o!==void 0&&s(t,["turnComplete"],o);const r=a(e,["interrupted"]);return r!==void 0&&s(t,["interrupted"],r),t}function ba(n,e){const t={},i=a(e,["modelTurn"]);i!=null&&s(t,["modelTurn"],co(n,i));const o=a(e,["turnComplete"]);o!==void 0&&s(t,["turnComplete"],o);const r=a(e,["interrupted"]);return r!==void 0&&s(t,["interrupted"],r),t}function Aa(n,e){const t={},i=a(e,["id"]);i!==void 0&&s(t,["id"],i);const o=a(e,["args"]);o!==void 0&&s(t,["args"],o);const r=a(e,["name"]);return r!==void 0&&s(t,["name"],r),t}function Ia(n,e){const t={},i=a(e,["args"]);i!==void 0&&s(t,["args"],i);const o=a(e,["name"]);return o!==void 0&&s(t,["name"],o),t}function La(n,e){const t={},i=a(e,["functionCalls"]);return i!=null&&Array.isArray(i)&&s(t,["functionCalls"],i.map(o=>Aa(n,o))),t}function Ma(n,e){const t={},i=a(e,["functionCalls"]);return i!=null&&Array.isArray(i)&&s(t,["functionCalls"],i.map(o=>Ia(n,o))),t}function Ra(n,e){const t={},i=a(e,["ids"]);return i!==void 0&&s(t,["ids"],i),t}function Pa(n,e){const t={},i=a(e,["ids"]);return i!==void 0&&s(t,["ids"],i),t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const _a="FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.";async function Na(n,e,t){let i,o;t.data instanceof Blob?o=JSON.parse(await t.data.text()):o=JSON.parse(t.data),n.isVertexAI()?i=xa(n,o):i=Ea(n,o),e(i)}class qa{constructor(e,t,i){this.apiClient=e,this.auth=t,this.webSocketFactory=i}async connect(e){var t,i;const o=this.apiClient.getWebsocketBaseUrl(),r=this.apiClient.getApiVersion();let u;const l=Va(this.apiClient.getDefaultHeaders());if(this.apiClient.isVertexAI())u=`${o}/ws/google.cloud.aiplatform.${r}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(l);else{const x=this.apiClient.getApiKey();u=`${o}/ws/google.ai.generativelanguage.${r}.GenerativeService.BidiGenerateContent?key=${x}`}let c=()=>{};const d=new Promise(x=>{c=x}),p=e.callbacks,f=function(){var x;(x=p==null?void 0:p.onopen)===null||x===void 0||x.call(p),c({})},h=this.apiClient,m={onopen:f,onmessage:x=>{Na(h,p.onmessage,x)},onerror:(t=p==null?void 0:p.onerror)!==null&&t!==void 0?t:function(x){},onclose:(i=p==null?void 0:p.onclose)!==null&&i!==void 0?i:function(x){}},g=this.webSocketFactory.create(u,Da(l),m);g.connect(),await d;let y=J(this.apiClient,e.model);if(this.apiClient.isVertexAI()&&y.startsWith("publishers/")){const x=this.apiClient.getProject(),w=this.apiClient.getLocation();y=`projects/${x}/locations/${w}/`+y}let C={};const E={model:y,config:e.config,callbacks:e.callbacks};return this.apiClient.isVertexAI()?C=Ca(this.apiClient,E):C=Ta(this.apiClient,E),g.send(JSON.stringify(C)),new Fa(g,this.apiClient)}}const $a={turnComplete:!0};class Fa{constructor(e,t){this.conn=e,this.apiClient=t}tLiveClientContent(e,t){if(t.turns!==null&&t.turns!==void 0){let i=[];try{i=N(e,t.turns),e.isVertexAI()?i=i.map(o=>Le(e,o)):i=i.map(o=>et(e,o))}catch{throw new Error(`Failed to parse client content "turns", type: '${typeof t.turns}'`)}return{clientContent:{turns:i,turnComplete:t.turnComplete}}}return{clientContent:{turnComplete:t.turnComplete}}}tLiveClientRealtimeInput(e,t){let i={};if(!("media"in t)||!t.media)throw new Error(`Failed to convert realtime input "media", type: '${typeof t.media}'`);return i={realtimeInput:{mediaChunks:[t.media]}},i}tLiveClienttToolResponse(e,t){let i=[];if(t.functionResponses==null)throw new Error("functionResponses is required.");if(Array.isArray(t.functionResponses)?i=t.functionResponses:i=[t.functionResponses],i.length===0)throw new Error("functionResponses is required.");for(const r of i){if(typeof r!="object"||r===null||!("name"in r)||!("response"in r))throw new Error(`Could not parse function response, type '${typeof r}'.`);if(!e.isVertexAI()&&!("id"in r))throw new Error(_a)}return{toolResponse:{functionResponses:i}}}sendClientContent(e){e=Object.assign(Object.assign({},$a),e);const t=this.tLiveClientContent(this.apiClient,e);this.conn.send(JSON.stringify(t))}sendRealtimeInput(e){if(e.media==null)throw new Error("Media is required.");const t=this.tLiveClientRealtimeInput(this.apiClient,e);this.conn.send(JSON.stringify(t))}sendToolResponse(e){if(e.functionResponses==null)throw new Error("Tool response parameters are required.");const t=this.tLiveClienttToolResponse(this.apiClient,e);this.conn.send(JSON.stringify(t))}close(){this.conn.close()}}function Da(n){const e={};return n.forEach((t,i)=>{e[i]=t}),e}function Va(n){const e=new Headers;for(const[t,i]of Object.entries(n))e.append(t,i);return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Ba extends Bt{constructor(e){super(),this.apiClient=e,this.generateContent=async t=>await this.generateContentInternal(t),this.generateContentStream=async t=>await this.generateContentStreamInternal(t),this.generateImages=async t=>await this.generateImagesInternal(t).then(i=>{var o;let r;const u=[];if(i!=null&&i.generatedImages)for(const c of i.generatedImages)c&&(c!=null&&c.safetyAttributes)&&((o=c==null?void 0:c.safetyAttributes)===null||o===void 0?void 0:o.contentType)==="Positive Prompt"?r=c==null?void 0:c.safetyAttributes:u.push(c);let l;return r?l={generatedImages:u,positivePromptSafetyAttributes:r}:l={generatedImages:u},l})}async generateContentInternal(e){var t,i;let o,r="",u={};if(this.apiClient.isVertexAI()){const l=bi(this.apiClient,e);return r=k("{model}:generateContent",l._url),u=l._query,delete l.config,delete l._url,delete l._query,o=this.apiClient.request({path:r,queryParams:u,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions}).then(c=>c.json()),o.then(c=>{const d=Ii(this.apiClient,c),p=new ot;return Object.assign(p,d),p})}else{const l=ki(this.apiClient,e);return r=k("{model}:generateContent",l._url),u=l._query,delete l.config,delete l._url,delete l._query,o=this.apiClient.request({path:r,queryParams:u,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions}).then(c=>c.json()),o.then(c=>{const d=Ai(this.apiClient,c),p=new ot;return Object.assign(p,d),p})}}async generateContentStreamInternal(e){var t,i;let o,r="",u={};if(this.apiClient.isVertexAI()){const l=bi(this.apiClient,e);r=k("{model}:streamGenerateContent?alt=sse",l._url),u=l._query,delete l.config,delete l._url,delete l._query;const c=this.apiClient;return o=c.requestStream({path:r,queryParams:u,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions}),o.then(function(d){return vt(this,arguments,function*(){var p,f,h,m;try{for(var g=!0,y=Zt(d),C;C=yield O(y.next()),p=C.done,!p;g=!0){m=C.value,g=!1;const x=Ii(c,m),w=new ot;Object.assign(w,x),yield yield O(w)}}catch(E){f={error:E}}finally{try{!g&&!p&&(h=y.return)&&(yield O(h.call(y)))}finally{if(f)throw f.error}}})})}else{const l=ki(this.apiClient,e);r=k("{model}:streamGenerateContent?alt=sse",l._url),u=l._query,delete l.config,delete l._url,delete l._query;const c=this.apiClient;return o=c.requestStream({path:r,queryParams:u,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions}),o.then(function(d){return vt(this,arguments,function*(){var p,f,h,m;try{for(var g=!0,y=Zt(d),C;C=yield O(y.next()),p=C.done,!p;g=!0){m=C.value,g=!1;const x=Ai(c,m),w=new ot;Object.assign(w,x),yield yield O(w)}}catch(E){f={error:E}}finally{try{!g&&!p&&(h=y.return)&&(yield O(h.call(y)))}finally{if(f)throw f.error}}})})}}async embedContent(e){var t,i;let o,r="",u={};if(this.apiClient.isVertexAI()){const l=Ns(this.apiClient,e);return r=k("{model}:predict",l._url),u=l._query,delete l.config,delete l._url,delete l._query,o=this.apiClient.request({path:r,queryParams:u,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions}).then(c=>c.json()),o.then(c=>{const d=ua(this.apiClient,c),p=new Ti;return Object.assign(p,d),p})}else{const l=ps(this.apiClient,e);return r=k("{model}:batchEmbedContents",l._url),u=l._query,delete l.config,delete l._url,delete l._query,o=this.apiClient.request({path:r,queryParams:u,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions}).then(c=>c.json()),o.then(c=>{const d=Js(this.apiClient,c),p=new Ti;return Object.assign(p,d),p})}}async generateImagesInternal(e){var t,i;let o,r="",u={};if(this.apiClient.isVertexAI()){const l=$s(this.apiClient,e);return r=k("{model}:predict",l._url),u=l._query,delete l.config,delete l._url,delete l._query,o=this.apiClient.request({path:r,queryParams:u,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions}).then(c=>c.json()),o.then(c=>{const d=pa(this.apiClient,c),p=new Ci;return Object.assign(p,d),p})}else{const l=hs(this.apiClient,e);return r=k("{model}:predict",l._url),u=l._query,delete l.config,delete l._url,delete l._query,o=this.apiClient.request({path:r,queryParams:u,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions}).then(c=>c.json()),o.then(c=>{const d=Zs(this.apiClient,c),p=new Ci;return Object.assign(p,d),p})}}async countTokens(e){var t,i;let o,r="",u={};if(this.apiClient.isVertexAI()){const l=Ds(this.apiClient,e);return r=k("{model}:countTokens",l._url),u=l._query,delete l.config,delete l._url,delete l._query,o=this.apiClient.request({path:r,queryParams:u,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions}).then(c=>c.json()),o.then(c=>{const d=fa(this.apiClient,c),p=new Ei;return Object.assign(p,d),p})}else{const l=gs(this.apiClient,e);return r=k("{model}:countTokens",l._url),u=l._query,delete l.config,delete l._url,delete l._query,o=this.apiClient.request({path:r,queryParams:u,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions}).then(c=>c.json()),o.then(c=>{const d=Xs(this.apiClient,c),p=new Ei;return Object.assign(p,d),p})}}async computeTokens(e){var t;let i,o="",r={};if(this.apiClient.isVertexAI()){const u=Vs(this.apiClient,e);return o=k("{model}:computeTokens",u._url),r=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:o,queryParams:r,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions}).then(l=>l.json()),i.then(l=>{const c=ha(this.apiClient,l),d=new Lr;return Object.assign(d,c),d})}else throw new Error("This method is only supported by the Vertex AI.")}async generateVideos(e){var t,i;let o,r="",u={};if(this.apiClient.isVertexAI()){const l=Hs(this.apiClient,e);return r=k("{model}:predictLongRunning",l._url),u=l._query,delete l.config,delete l._url,delete l._query,o=this.apiClient.request({path:r,queryParams:u,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions}).then(c=>c.json()),o.then(c=>va(this.apiClient,c))}else{const l=Ts(this.apiClient,e);return r=k("{model}:predictLongRunning",l._url),u=l._query,delete l.config,delete l._url,delete l._query,o=this.apiClient.request({path:r,queryParams:u,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions}).then(c=>c.json()),o.then(c=>na(this.apiClient,c))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function za(n,e){const t={},i=a(e,["operationName"]);i!=null&&s(t,["_url","operationName"],i);const o=a(e,["config"]);return o!=null&&s(t,["config"],o),t}function Ha(n,e){const t={},i=a(e,["operationName"]);i!=null&&s(t,["_url","operationName"],i);const o=a(e,["config"]);return o!=null&&s(t,["config"],o),t}function Ga(n,e){const t={},i=a(e,["operationName"]);i!=null&&s(t,["operationName"],i);const o=a(e,["resourceName"]);o!=null&&s(t,["_url","resourceName"],o);const r=a(e,["config"]);return r!=null&&s(t,["config"],r),t}function Ua(n,e){const t={},i=a(e,["video","uri"]);i!=null&&s(t,["uri"],i);const o=a(e,["video","encodedVideo"]);o!=null&&s(t,["videoBytes"],Ee(n,o));const r=a(e,["encoding"]);return r!=null&&s(t,["mimeType"],r),t}function Oa(n,e){const t={},i=a(e,["_self"]);return i!=null&&s(t,["video"],Ua(n,i)),t}function Ka(n,e){const t={},i=a(e,["generatedSamples"]);i!=null&&(Array.isArray(i)?s(t,["generatedVideos"],i.map(u=>Oa(n,u))):s(t,["generatedVideos"],i));const o=a(e,["raiMediaFilteredCount"]);o!=null&&s(t,["raiMediaFilteredCount"],o);const r=a(e,["raiMediaFilteredReasons"]);return r!=null&&s(t,["raiMediaFilteredReasons"],r),t}function Ya(n,e){const t={},i=a(e,["name"]);i!=null&&s(t,["name"],i);const o=a(e,["metadata"]);o!=null&&s(t,["metadata"],o);const r=a(e,["done"]);r!=null&&s(t,["done"],r);const u=a(e,["error"]);u!=null&&s(t,["error"],u);const l=a(e,["response"]);l!=null&&s(t,["response"],l);const c=a(e,["response","generateVideoResponse"]);return c!=null&&s(t,["result"],Ka(n,c)),t}function Ja(n,e){const t={},i=a(e,["gcsUri"]);i!=null&&s(t,["uri"],i);const o=a(e,["bytesBase64Encoded"]);o!=null&&s(t,["videoBytes"],Ee(n,o));const r=a(e,["mimeType"]);return r!=null&&s(t,["mimeType"],r),t}function Wa(n,e){const t={},i=a(e,["_self"]);return i!=null&&s(t,["video"],Ja(n,i)),t}function Qa(n,e){const t={},i=a(e,["videos"]);i!=null&&(Array.isArray(i)?s(t,["generatedVideos"],i.map(u=>Wa(n,u))):s(t,["generatedVideos"],i));const o=a(e,["raiMediaFilteredCount"]);o!=null&&s(t,["raiMediaFilteredCount"],o);const r=a(e,["raiMediaFilteredReasons"]);return r!=null&&s(t,["raiMediaFilteredReasons"],r),t}function Li(n,e){const t={},i=a(e,["name"]);i!=null&&s(t,["name"],i);const o=a(e,["metadata"]);o!=null&&s(t,["metadata"],o);const r=a(e,["done"]);r!=null&&s(t,["done"],r);const u=a(e,["error"]);u!=null&&s(t,["error"],u);const l=a(e,["response"]);l!=null&&s(t,["response"],l);const c=a(e,["response"]);return c!=null&&s(t,["result"],Qa(n,c)),t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Za extends Bt{constructor(e){super(),this.apiClient=e}async get(e){const t=e.operation,i=e.config;if(t.name===void 0||t.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const r=t.name.split("/operations/")[0];var o=void 0;return i&&"httpOptions"in i&&(o=i.httpOptions),this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:r,config:{httpOptions:o}})}else return this.getVideosOperationInternal({operationName:t.name,config:i})}async getVideosOperationInternal(e){var t,i;let o,r="",u={};if(this.apiClient.isVertexAI()){const l=Ha(this.apiClient,e);return r=k("{operationName}",l._url),u=l._query,delete l.config,delete l._url,delete l._query,o=this.apiClient.request({path:r,queryParams:u,body:JSON.stringify(l),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions}).then(c=>c.json()),o.then(c=>Li(this.apiClient,c))}else{const l=za(this.apiClient,e);return r=k("{operationName}",l._url),u=l._query,delete l.config,delete l._url,delete l._query,o=this.apiClient.request({path:r,queryParams:u,body:JSON.stringify(l),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions}).then(c=>c.json()),o.then(c=>Ya(this.apiClient,c))}}async fetchPredictVideosOperationInternal(e){var t;let i,o="",r={};if(this.apiClient.isVertexAI()){const u=Ga(this.apiClient,e);return o=k("{resourceName}:fetchPredictOperation",u._url),r=u._query,delete u.config,delete u._url,delete u._query,i=this.apiClient.request({path:o,queryParams:r,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions}).then(l=>l.json()),i.then(l=>Li(this.apiClient,l))}else throw new Error("This method is only supported by the Vertex AI.")}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Xa="Content-Type",ja="User-Agent",el="x-goog-api-client",tl="0.7.0",nl=`google-genai-sdk/${tl}`,il="v1beta1",ol="v1beta",Mi=/^data: (.*)(?:\n\n|\r\r|\r\n\r\n)/;class rl extends Error{constructor(e,t){t?super(e,{cause:t}):super(e,{cause:new Error().stack}),this.message=e,this.name="ClientError"}}class Ri extends Error{constructor(e,t){t?super(e,{cause:t}):super(e,{cause:new Error().stack}),this.message=e,this.name="ServerError"}}class sl{constructor(e){var t,i;this.clientOptions=Object.assign(Object.assign({},e),{project:e.project,location:e.location,apiKey:e.apiKey,vertexai:e.vertexai});const o={};this.clientOptions.vertexai?(o.apiVersion=(t=this.clientOptions.apiVersion)!==null&&t!==void 0?t:il,this.getProject()||this.getLocation()?(o.baseUrl=`https://${this.clientOptions.location}-aiplatform.googleapis.com/`,this.clientOptions.apiKey=void 0):(o.baseUrl="https://aiplatform.googleapis.com/",this.clientOptions.project=void 0,this.clientOptions.location=void 0)):(o.apiVersion=(i=this.clientOptions.apiVersion)!==null&&i!==void 0?i:ol,o.baseUrl="https://generativelanguage.googleapis.com/"),o.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=o,e.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(o,e.httpOptions))}isVertexAI(){var e;return(e=this.clientOptions.vertexai)!==null&&e!==void 0?e:!1}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}getApiVersion(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.apiVersion!==void 0)return this.clientOptions.httpOptions.apiVersion;throw new Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.baseUrl!==void 0)return this.clientOptions.httpOptions.baseUrl;throw new Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.headers!==void 0)return this.clientOptions.httpOptions.headers;throw new Error("Headers are not set.")}getRequestUrlInternal(e){if(!e||e.baseUrl===void 0||e.apiVersion===void 0)throw new Error("HTTP options are not correctly set.");const i=[e.baseUrl.endsWith("/")?e.baseUrl.slice(0,-1):e.baseUrl];return e.apiVersion&&e.apiVersion!==""&&i.push(e.apiVersion),i.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){const e=this.getBaseUrl(),t=new URL(e);return t.protocol="wss",t.toString()}setBaseUrl(e){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=e;else throw new Error("HTTP options are not correctly set.")}constructUrl(e,t){const i=[this.getRequestUrlInternal(t)];return this.clientOptions.vertexai&&!this.clientOptions.apiKey&&!e.startsWith("projects/")&&i.push(this.getBaseResourcePath()),e!==""&&i.push(e),new URL(`${i.join("/")}`)}async request(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const i=this.constructUrl(e.path,t);if(e.queryParams)for(const[r,u]of Object.entries(e.queryParams))i.searchParams.append(r,String(u));let o={};if(e.httpMethod==="GET"){if(e.body&&e.body!=="{}")throw new Error("Request body should be empty for GET request, but got non empty request body")}else o.body=e.body;return o=await this.includeExtraHttpOptionsToRequestInit(o,t),this.unaryApiCall(i,o,e.httpMethod)}patchHttpOptions(e,t){const i=JSON.parse(JSON.stringify(e));for(const[o,r]of Object.entries(t))typeof r=="object"?i[o]=Object.assign(Object.assign({},i[o]),r):r!==void 0&&(i[o]=r);return i}async requestStream(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const i=this.constructUrl(e.path,t);(!i.searchParams.has("alt")||i.searchParams.get("alt")!=="sse")&&i.searchParams.set("alt","sse");let o={};return o.body=e.body,o=await this.includeExtraHttpOptionsToRequestInit(o,t),this.streamApiCall(i,o,e.httpMethod)}async includeExtraHttpOptionsToRequestInit(e,t){if(t&&t.timeout&&t.timeout>0){const i=new AbortController,o=i.signal;setTimeout(()=>i.abort(),t.timeout),e.signal=o}return e.headers=await this.getHeadersInternal(t),e}async unaryApiCall(e,t,i){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:i})).then(async o=>(await Pi(o),new oo(o))).catch(o=>{throw o instanceof Error?o:new Error(JSON.stringify(o))})}async streamApiCall(e,t,i){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:i})).then(async o=>(await Pi(o),this.processStreamResponse(o))).catch(o=>{throw o instanceof Error?o:new Error(JSON.stringify(o))})}processStreamResponse(e){var t;return vt(this,arguments,function*(){const o=(t=e==null?void 0:e.body)===null||t===void 0?void 0:t.getReader(),r=new TextDecoder("utf-8");if(!o)throw new Error("Response body is empty");try{let u="";for(;;){const{done:l,value:c}=yield O(o.read());if(l){if(u.trim().length>0)throw new Error("Incomplete JSON segment at the end");break}const d=r.decode(c);u+=d;let p=u.match(Mi);for(;p;){const f=p[1];try{const h=JSON.parse(f);yield yield O(h),u=u.slice(p[0].length),p=u.match(Mi)}catch(h){throw new Error(`exception parsing stream chunk ${f}. ${h}`)}}}}finally{o.releaseLock()}})}async apiCall(e,t){return fetch(e,t).catch(i=>{throw new Error(`exception ${i} sending request`)})}getDefaultHeaders(){const e={},t=nl+" "+this.clientOptions.userAgentExtra;return e[ja]=t,e[el]=t,e[Xa]="application/json",e}async getHeadersInternal(e){const t=new Headers;if(e&&e.headers)for(const[i,o]of Object.entries(e.headers))t.append(i,o);return await this.clientOptions.auth.addAuthHeaders(t),t}async uploadFile(e,t){var i;const o={};t!=null&&(o.mimeType=t.mimeType,o.name=t.name,o.displayName=t.displayName),o.name&&!o.name.startsWith("files/")&&(o.name=`files/${o.name}`);const r=this.clientOptions.uploader,u=await r.stat(e);o.sizeBytes=String(u.size);const l=(i=t==null?void 0:t.mimeType)!==null&&i!==void 0?i:u.type;if(l===void 0||l==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");o.mimeType=l;const c=await this.fetchUploadUrl(o,t);return r.upload(e,c,this)}async fetchUploadUrl(e,t){var i;let o={};t!=null&&t.httpOptions?o=t.httpOptions:o={apiVersion:"",headers:{"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${e.sizeBytes}`,"X-Goog-Upload-Header-Content-Type":`${e.mimeType}`}};const r={file:e},u=await this.request({path:k("upload/v1beta/files",r._url),body:JSON.stringify(r),httpMethod:"POST",httpOptions:o});if(!u||!(u!=null&&u.headers))throw new Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");const l=(i=u==null?void 0:u.headers)===null||i===void 0?void 0:i["x-goog-upload-url"];if(l===void 0)throw new Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return l}}async function Pi(n){var e;if(n===void 0)throw new Ri("response is undefined");if(!n.ok){const t=n.status,i=n.statusText;let o;!((e=n.headers.get("content-type"))===null||e===void 0)&&e.includes("application/json")?o=await n.json():o={error:{message:"exception parsing response",code:n.status,status:n.statusText}};const r=`got status: ${t} ${i}. ${JSON.stringify(o)}`;throw t>=400&&t<500?new rl(r):t>=500&&t<600?new Ri(r):new Error(r)}}const al=1024*1024*8;async function ll(n,e,t){var i,o;let r=0,u=0,l=new oo(new Response),c="upload";for(r=n.size;u<r;){const p=Math.min(al,r-u),f=n.slice(u,u+p);if(u+p>=r&&(c+=", finalize"),l=await t.request({path:"",body:f,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:e,headers:{"X-Goog-Upload-Command":c,"X-Goog-Upload-Offset":String(u),"Content-Length":String(p)}}}),u+=p,((i=l==null?void 0:l.headers)===null||i===void 0?void 0:i["x-goog-upload-status"])!=="active")break;if(r<=u)throw new Error("All content has been uploaded, but the upload status is not finalized.")}const d=await(l==null?void 0:l.json());if(((o=l==null?void 0:l.headers)===null||o===void 0?void 0:o["x-goog-upload-status"])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");return d.file}async function ul(n){return{size:n.size,type:n.type}}class cl{async upload(e,t,i){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await ll(e,t,i)}async stat(e){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await ul(e)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class dl{create(e,t,i){return new pl(e,t,i)}}class pl{constructor(e,t,i){this.url=e,this.headers=t,this.callbacks=i}connect(){this.ws=new WebSocket(this.url),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(e){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.send(e)}close(){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.close()}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const _i="x-goog-api-key";class fl{constructor(e){this.apiKey=e}async addAuthHeaders(e){e.get(_i)===null&&e.append(_i,this.apiKey)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const hl="gl-node/";class fo{constructor(e){var t;if(e.apiKey==null)throw new Error("An API Key must be set when running in a browser");if(e.project||e.location)throw new Error("Vertex AI project based authentication is not supported on browser runtimes. Please do not provide a project or location.");this.vertexai=(t=e.vertexai)!==null&&t!==void 0?t:!1,this.apiKey=e.apiKey,this.apiVersion=e.apiVersion;const i=new fl(this.apiKey);this.apiClient=new sl({auth:i,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:e.httpOptions,userAgentExtra:hl+"web",uploader:new cl}),this.models=new Ba(this.apiClient),this.live=new qa(this.apiClient,i,new dl),this.chats=new Fr(this.models,this.apiClient),this.caches=new _r(this.apiClient),this.files=new Qr(this.apiClient),this.operations=new Za(this.apiClient)}}function kn(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}var Me=kn();function ho(n){Me=n}var Ke={exec:()=>null};function b(n,e=""){let t=typeof n=="string"?n:n.source;const i={replace:(o,r)=>{let u=typeof r=="string"?r:r.source;return u=u.replace(G.caret,"$1"),t=t.replace(o,u),i},getRegex:()=>new RegExp(t,e)};return i}var G={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceTabs:/^\t+/,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] /,listReplaceTask:/^\[[ xX]\] +/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:n=>new RegExp(`^( {0,3}${n})((?:[	 ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:n=>new RegExp(`^ {0,${Math.min(3,n-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),hrRegex:n=>new RegExp(`^ {0,${Math.min(3,n-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:n=>new RegExp(`^ {0,${Math.min(3,n-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:n=>new RegExp(`^ {0,${Math.min(3,n-1)}}#`),htmlBeginRegex:n=>new RegExp(`^ {0,${Math.min(3,n-1)}}<(?:[a-z].*>|!--)`,"i")},ml=/^(?:[ \t]*(?:\n|$))+/,gl=/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,yl=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,tt=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,vl=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,bn=/(?:[*+-]|\d{1,9}[.)])/,mo=/^(?!bull |blockCode|fences|blockquote|heading|html|table)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html|table))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,go=b(mo).replace(/bull/g,bn).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/\|table/g,"").getRegex(),Tl=b(mo).replace(/bull/g,bn).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/table/g,/ {0,3}\|?(?:[:\- ]*\|)+[\:\- ]*\n/).getRegex(),An=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,Cl=/^[^\n]+/,In=/(?!\s*\])(?:\\.|[^\[\]\\])+/,El=b(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",In).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),xl=b(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,bn).getRegex(),zt="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",Ln=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,Sl=b("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$))","i").replace("comment",Ln).replace("tag",zt).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),yo=b(An).replace("hr",tt).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",zt).getRegex(),wl=b(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",yo).getRegex(),Mn={blockquote:wl,code:gl,def:El,fences:yl,heading:vl,hr:tt,html:Sl,lheading:go,list:xl,newline:ml,paragraph:yo,table:Ke,text:Cl},Ni=b("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",tt).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}	)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",zt).getRegex(),kl={...Mn,lheading:Tl,table:Ni,paragraph:b(An).replace("hr",tt).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",Ni).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",zt).getRegex()},bl={...Mn,html:b(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",Ln).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:Ke,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:b(An).replace("hr",tt).replace("heading",` *#{1,6} *[^
]`).replace("lheading",go).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},Al=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,Il=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,vo=/^( {2,}|\\)\n(?!\s*$)/,Ll=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,Ht=/[\p{P}\p{S}]/u,Rn=/[\s\p{P}\p{S}]/u,To=/[^\s\p{P}\p{S}]/u,Ml=b(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,Rn).getRegex(),Co=/(?!~)[\p{P}\p{S}]/u,Rl=/(?!~)[\s\p{P}\p{S}]/u,Pl=/(?:[^\s\p{P}\p{S}]|~)/u,_l=/\[[^[\]]*?\]\((?:\\.|[^\\\(\)]|\((?:\\.|[^\\\(\)])*\))*\)|`[^`]*?`|<[^<>]*?>/g,Eo=/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,Nl=b(Eo,"u").replace(/punct/g,Ht).getRegex(),ql=b(Eo,"u").replace(/punct/g,Co).getRegex(),xo="^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)punct(\\*+)(?=[\\s]|$)|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)|[\\s](\\*+)(?!\\*)(?=punct)|(?!\\*)punct(\\*+)(?!\\*)(?=punct)|notPunctSpace(\\*+)(?=notPunctSpace)",$l=b(xo,"gu").replace(/notPunctSpace/g,To).replace(/punctSpace/g,Rn).replace(/punct/g,Ht).getRegex(),Fl=b(xo,"gu").replace(/notPunctSpace/g,Pl).replace(/punctSpace/g,Rl).replace(/punct/g,Co).getRegex(),Dl=b("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,To).replace(/punctSpace/g,Rn).replace(/punct/g,Ht).getRegex(),Vl=b(/\\(punct)/,"gu").replace(/punct/g,Ht).getRegex(),Bl=b(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),zl=b(Ln).replace("(?:-->|$)","-->").getRegex(),Hl=b("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",zl).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),Tt=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/,Gl=b(/^!?\[(label)\]\(\s*(href)(?:(?:[ \t]*(?:\n[ \t]*)?)(title))?\s*\)/).replace("label",Tt).replace("href",/<(?:\\.|[^\n<>\\])+>|[^ \t\n\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),So=b(/^!?\[(label)\]\[(ref)\]/).replace("label",Tt).replace("ref",In).getRegex(),wo=b(/^!?\[(ref)\](?:\[\])?/).replace("ref",In).getRegex(),Ul=b("reflink|nolink(?!\\()","g").replace("reflink",So).replace("nolink",wo).getRegex(),Pn={_backpedal:Ke,anyPunctuation:Vl,autolink:Bl,blockSkip:_l,br:vo,code:Il,del:Ke,emStrongLDelim:Nl,emStrongRDelimAst:$l,emStrongRDelimUnd:Dl,escape:Al,link:Gl,nolink:wo,punctuation:Ml,reflink:So,reflinkSearch:Ul,tag:Hl,text:Ll,url:Ke},Ol={...Pn,link:b(/^!?\[(label)\]\((.*?)\)/).replace("label",Tt).getRegex(),reflink:b(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",Tt).getRegex()},jt={...Pn,emStrongRDelimAst:Fl,emStrongLDelim:ql,url:b(/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,"i").replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\.|[^\\])*?(?:\\.|[^\s~\\]))\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/},Kl={...jt,br:b(vo).replace("{2,}","*").getRegex(),text:b(jt.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},rt={normal:Mn,gfm:kl,pedantic:bl},Be={normal:Pn,gfm:jt,breaks:Kl,pedantic:Ol},Yl={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},qi=n=>Yl[n];function ie(n,e){if(e){if(G.escapeTest.test(n))return n.replace(G.escapeReplace,qi)}else if(G.escapeTestNoEncode.test(n))return n.replace(G.escapeReplaceNoEncode,qi);return n}function $i(n){try{n=encodeURI(n).replace(G.percentDecode,"%")}catch{return null}return n}function Fi(n,e){var r;const t=n.replace(G.findPipe,(u,l,c)=>{let d=!1,p=l;for(;--p>=0&&c[p]==="\\";)d=!d;return d?"|":" |"}),i=t.split(G.splitPipe);let o=0;if(i[0].trim()||i.shift(),i.length>0&&!((r=i.at(-1))!=null&&r.trim())&&i.pop(),e)if(i.length>e)i.splice(e);else for(;i.length<e;)i.push("");for(;o<i.length;o++)i[o]=i[o].trim().replace(G.slashPipe,"|");return i}function ze(n,e,t){const i=n.length;if(i===0)return"";let o=0;for(;o<i&&n.charAt(i-o-1)===e;)o++;return n.slice(0,i-o)}function Jl(n,e){if(n.indexOf(e[1])===-1)return-1;let t=0;for(let i=0;i<n.length;i++)if(n[i]==="\\")i++;else if(n[i]===e[0])t++;else if(n[i]===e[1]&&(t--,t<0))return i;return t>0?-2:-1}function Di(n,e,t,i,o){const r=e.href,u=e.title||null,l=n[1].replace(o.other.outputLinkReplace,"$1");i.state.inLink=!0;const c={type:n[0].charAt(0)==="!"?"image":"link",raw:t,href:r,title:u,text:l,tokens:i.inlineTokens(l)};return i.state.inLink=!1,c}function Wl(n,e,t){const i=n.match(t.other.indentCodeCompensation);if(i===null)return e;const o=i[1];return e.split(`
`).map(r=>{const u=r.match(t.other.beginningSpace);if(u===null)return r;const[l]=u;return l.length>=o.length?r.slice(o.length):r}).join(`
`)}var Ct=class{constructor(n){I(this,"options");I(this,"rules");I(this,"lexer");this.options=n||Me}space(n){const e=this.rules.block.newline.exec(n);if(e&&e[0].length>0)return{type:"space",raw:e[0]}}code(n){const e=this.rules.block.code.exec(n);if(e){const t=e[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:e[0],codeBlockStyle:"indented",text:this.options.pedantic?t:ze(t,`
`)}}}fences(n){const e=this.rules.block.fences.exec(n);if(e){const t=e[0],i=Wl(t,e[3]||"",this.rules);return{type:"code",raw:t,lang:e[2]?e[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):e[2],text:i}}}heading(n){const e=this.rules.block.heading.exec(n);if(e){let t=e[2].trim();if(this.rules.other.endingHash.test(t)){const i=ze(t,"#");(this.options.pedantic||!i||this.rules.other.endingSpaceChar.test(i))&&(t=i.trim())}return{type:"heading",raw:e[0],depth:e[1].length,text:t,tokens:this.lexer.inline(t)}}}hr(n){const e=this.rules.block.hr.exec(n);if(e)return{type:"hr",raw:ze(e[0],`
`)}}blockquote(n){const e=this.rules.block.blockquote.exec(n);if(e){let t=ze(e[0],`
`).split(`
`),i="",o="";const r=[];for(;t.length>0;){let u=!1;const l=[];let c;for(c=0;c<t.length;c++)if(this.rules.other.blockquoteStart.test(t[c]))l.push(t[c]),u=!0;else if(!u)l.push(t[c]);else break;t=t.slice(c);const d=l.join(`
`),p=d.replace(this.rules.other.blockquoteSetextReplace,`
    $1`).replace(this.rules.other.blockquoteSetextReplace2,"");i=i?`${i}
${d}`:d,o=o?`${o}
${p}`:p;const f=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(p,r,!0),this.lexer.state.top=f,t.length===0)break;const h=r.at(-1);if((h==null?void 0:h.type)==="code")break;if((h==null?void 0:h.type)==="blockquote"){const m=h,g=m.raw+`
`+t.join(`
`),y=this.blockquote(g);r[r.length-1]=y,i=i.substring(0,i.length-m.raw.length)+y.raw,o=o.substring(0,o.length-m.text.length)+y.text;break}else if((h==null?void 0:h.type)==="list"){const m=h,g=m.raw+`
`+t.join(`
`),y=this.list(g);r[r.length-1]=y,i=i.substring(0,i.length-h.raw.length)+y.raw,o=o.substring(0,o.length-m.raw.length)+y.raw,t=g.substring(r.at(-1).raw.length).split(`
`);continue}}return{type:"blockquote",raw:i,tokens:r,text:o}}}list(n){let e=this.rules.block.list.exec(n);if(e){let t=e[1].trim();const i=t.length>1,o={type:"list",raw:"",ordered:i,start:i?+t.slice(0,-1):"",loose:!1,items:[]};t=i?`\\d{1,9}\\${t.slice(-1)}`:`\\${t}`,this.options.pedantic&&(t=i?t:"[*+-]");const r=this.rules.other.listItemRegex(t);let u=!1;for(;n;){let c=!1,d="",p="";if(!(e=r.exec(n))||this.rules.block.hr.test(n))break;d=e[0],n=n.substring(d.length);let f=e[2].split(`
`,1)[0].replace(this.rules.other.listReplaceTabs,E=>" ".repeat(3*E.length)),h=n.split(`
`,1)[0],m=!f.trim(),g=0;if(this.options.pedantic?(g=2,p=f.trimStart()):m?g=e[1].length+1:(g=e[2].search(this.rules.other.nonSpaceChar),g=g>4?1:g,p=f.slice(g),g+=e[1].length),m&&this.rules.other.blankLine.test(h)&&(d+=h+`
`,n=n.substring(h.length+1),c=!0),!c){const E=this.rules.other.nextBulletRegex(g),x=this.rules.other.hrRegex(g),w=this.rules.other.fencesBeginRegex(g),P=this.rules.other.headingBeginRegex(g),q=this.rules.other.htmlBeginRegex(g);for(;n;){const A=n.split(`
`,1)[0];let R;if(h=A,this.options.pedantic?(h=h.replace(this.rules.other.listReplaceNesting,"  "),R=h):R=h.replace(this.rules.other.tabCharGlobal,"    "),w.test(h)||P.test(h)||q.test(h)||E.test(h)||x.test(h))break;if(R.search(this.rules.other.nonSpaceChar)>=g||!h.trim())p+=`
`+R.slice(g);else{if(m||f.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4||w.test(f)||P.test(f)||x.test(f))break;p+=`
`+h}!m&&!h.trim()&&(m=!0),d+=A+`
`,n=n.substring(A.length+1),f=R.slice(g)}}o.loose||(u?o.loose=!0:this.rules.other.doubleBlankLine.test(d)&&(u=!0));let y=null,C;this.options.gfm&&(y=this.rules.other.listIsTask.exec(p),y&&(C=y[0]!=="[ ] ",p=p.replace(this.rules.other.listReplaceTask,""))),o.items.push({type:"list_item",raw:d,task:!!y,checked:C,loose:!1,text:p,tokens:[]}),o.raw+=d}const l=o.items.at(-1);if(l)l.raw=l.raw.trimEnd(),l.text=l.text.trimEnd();else return;o.raw=o.raw.trimEnd();for(let c=0;c<o.items.length;c++)if(this.lexer.state.top=!1,o.items[c].tokens=this.lexer.blockTokens(o.items[c].text,[]),!o.loose){const d=o.items[c].tokens.filter(f=>f.type==="space"),p=d.length>0&&d.some(f=>this.rules.other.anyLine.test(f.raw));o.loose=p}if(o.loose)for(let c=0;c<o.items.length;c++)o.items[c].loose=!0;return o}}html(n){const e=this.rules.block.html.exec(n);if(e)return{type:"html",block:!0,raw:e[0],pre:e[1]==="pre"||e[1]==="script"||e[1]==="style",text:e[0]}}def(n){const e=this.rules.block.def.exec(n);if(e){const t=e[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),i=e[2]?e[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",o=e[3]?e[3].substring(1,e[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):e[3];return{type:"def",tag:t,raw:e[0],href:i,title:o}}}table(n){var u;const e=this.rules.block.table.exec(n);if(!e||!this.rules.other.tableDelimiter.test(e[2]))return;const t=Fi(e[1]),i=e[2].replace(this.rules.other.tableAlignChars,"").split("|"),o=(u=e[3])!=null&&u.trim()?e[3].replace(this.rules.other.tableRowBlankLine,"").split(`
`):[],r={type:"table",raw:e[0],header:[],align:[],rows:[]};if(t.length===i.length){for(const l of i)this.rules.other.tableAlignRight.test(l)?r.align.push("right"):this.rules.other.tableAlignCenter.test(l)?r.align.push("center"):this.rules.other.tableAlignLeft.test(l)?r.align.push("left"):r.align.push(null);for(let l=0;l<t.length;l++)r.header.push({text:t[l],tokens:this.lexer.inline(t[l]),header:!0,align:r.align[l]});for(const l of o)r.rows.push(Fi(l,r.header.length).map((c,d)=>({text:c,tokens:this.lexer.inline(c),header:!1,align:r.align[d]})));return r}}lheading(n){const e=this.rules.block.lheading.exec(n);if(e)return{type:"heading",raw:e[0],depth:e[2].charAt(0)==="="?1:2,text:e[1],tokens:this.lexer.inline(e[1])}}paragraph(n){const e=this.rules.block.paragraph.exec(n);if(e){const t=e[1].charAt(e[1].length-1)===`
`?e[1].slice(0,-1):e[1];return{type:"paragraph",raw:e[0],text:t,tokens:this.lexer.inline(t)}}}text(n){const e=this.rules.block.text.exec(n);if(e)return{type:"text",raw:e[0],text:e[0],tokens:this.lexer.inline(e[0])}}escape(n){const e=this.rules.inline.escape.exec(n);if(e)return{type:"escape",raw:e[0],text:e[1]}}tag(n){const e=this.rules.inline.tag.exec(n);if(e)return!this.lexer.state.inLink&&this.rules.other.startATag.test(e[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(e[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(e[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(e[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:e[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:e[0]}}link(n){const e=this.rules.inline.link.exec(n);if(e){const t=e[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(t)){if(!this.rules.other.endAngleBracket.test(t))return;const r=ze(t.slice(0,-1),"\\");if((t.length-r.length)%2===0)return}else{const r=Jl(e[2],"()");if(r===-2)return;if(r>-1){const l=(e[0].indexOf("!")===0?5:4)+e[1].length+r;e[2]=e[2].substring(0,r),e[0]=e[0].substring(0,l).trim(),e[3]=""}}let i=e[2],o="";if(this.options.pedantic){const r=this.rules.other.pedanticHrefTitle.exec(i);r&&(i=r[1],o=r[3])}else o=e[3]?e[3].slice(1,-1):"";return i=i.trim(),this.rules.other.startAngleBracket.test(i)&&(this.options.pedantic&&!this.rules.other.endAngleBracket.test(t)?i=i.slice(1):i=i.slice(1,-1)),Di(e,{href:i&&i.replace(this.rules.inline.anyPunctuation,"$1"),title:o&&o.replace(this.rules.inline.anyPunctuation,"$1")},e[0],this.lexer,this.rules)}}reflink(n,e){let t;if((t=this.rules.inline.reflink.exec(n))||(t=this.rules.inline.nolink.exec(n))){const i=(t[2]||t[1]).replace(this.rules.other.multipleSpaceGlobal," "),o=e[i.toLowerCase()];if(!o){const r=t[0].charAt(0);return{type:"text",raw:r,text:r}}return Di(t,o,t[0],this.lexer,this.rules)}}emStrong(n,e,t=""){let i=this.rules.inline.emStrongLDelim.exec(n);if(!i||i[3]&&t.match(this.rules.other.unicodeAlphaNumeric))return;if(!(i[1]||i[2]||"")||!t||this.rules.inline.punctuation.exec(t)){const r=[...i[0]].length-1;let u,l,c=r,d=0;const p=i[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(p.lastIndex=0,e=e.slice(-1*n.length+r);(i=p.exec(e))!=null;){if(u=i[1]||i[2]||i[3]||i[4]||i[5]||i[6],!u)continue;if(l=[...u].length,i[3]||i[4]){c+=l;continue}else if((i[5]||i[6])&&r%3&&!((r+l)%3)){d+=l;continue}if(c-=l,c>0)continue;l=Math.min(l,l+c+d);const f=[...i[0]][0].length,h=n.slice(0,r+i.index+f+l);if(Math.min(r,l)%2){const g=h.slice(1,-1);return{type:"em",raw:h,text:g,tokens:this.lexer.inlineTokens(g)}}const m=h.slice(2,-2);return{type:"strong",raw:h,text:m,tokens:this.lexer.inlineTokens(m)}}}}codespan(n){const e=this.rules.inline.code.exec(n);if(e){let t=e[2].replace(this.rules.other.newLineCharGlobal," ");const i=this.rules.other.nonSpaceChar.test(t),o=this.rules.other.startingSpaceChar.test(t)&&this.rules.other.endingSpaceChar.test(t);return i&&o&&(t=t.substring(1,t.length-1)),{type:"codespan",raw:e[0],text:t}}}br(n){const e=this.rules.inline.br.exec(n);if(e)return{type:"br",raw:e[0]}}del(n){const e=this.rules.inline.del.exec(n);if(e)return{type:"del",raw:e[0],text:e[2],tokens:this.lexer.inlineTokens(e[2])}}autolink(n){const e=this.rules.inline.autolink.exec(n);if(e){let t,i;return e[2]==="@"?(t=e[1],i="mailto:"+t):(t=e[1],i=t),{type:"link",raw:e[0],text:t,href:i,tokens:[{type:"text",raw:t,text:t}]}}}url(n){var t;let e;if(e=this.rules.inline.url.exec(n)){let i,o;if(e[2]==="@")i=e[0],o="mailto:"+i;else{let r;do r=e[0],e[0]=((t=this.rules.inline._backpedal.exec(e[0]))==null?void 0:t[0])??"";while(r!==e[0]);i=e[0],e[1]==="www."?o="http://"+e[0]:o=e[0]}return{type:"link",raw:e[0],text:i,href:o,tokens:[{type:"text",raw:i,text:i}]}}}inlineText(n){const e=this.rules.inline.text.exec(n);if(e){const t=this.lexer.state.inRawBlock;return{type:"text",raw:e[0],text:e[0],escaped:t}}}},he=class en{constructor(e){I(this,"tokens");I(this,"options");I(this,"state");I(this,"tokenizer");I(this,"inlineQueue");this.tokens=[],this.tokens.links=Object.create(null),this.options=e||Me,this.options.tokenizer=this.options.tokenizer||new Ct,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};const t={other:G,block:rt.normal,inline:Be.normal};this.options.pedantic?(t.block=rt.pedantic,t.inline=Be.pedantic):this.options.gfm&&(t.block=rt.gfm,this.options.breaks?t.inline=Be.breaks:t.inline=Be.gfm),this.tokenizer.rules=t}static get rules(){return{block:rt,inline:Be}}static lex(e,t){return new en(t).lex(e)}static lexInline(e,t){return new en(t).inlineTokens(e)}lex(e){e=e.replace(G.carriageReturn,`
`),this.blockTokens(e,this.tokens);for(let t=0;t<this.inlineQueue.length;t++){const i=this.inlineQueue[t];this.inlineTokens(i.src,i.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(e,t=[],i=!1){var o,r,u;for(this.options.pedantic&&(e=e.replace(G.tabCharGlobal,"    ").replace(G.spaceLine,""));e;){let l;if((r=(o=this.options.extensions)==null?void 0:o.block)!=null&&r.some(d=>(l=d.call({lexer:this},e,t))?(e=e.substring(l.raw.length),t.push(l),!0):!1))continue;if(l=this.tokenizer.space(e)){e=e.substring(l.raw.length);const d=t.at(-1);l.raw.length===1&&d!==void 0?d.raw+=`
`:t.push(l);continue}if(l=this.tokenizer.code(e)){e=e.substring(l.raw.length);const d=t.at(-1);(d==null?void 0:d.type)==="paragraph"||(d==null?void 0:d.type)==="text"?(d.raw+=`
`+l.raw,d.text+=`
`+l.text,this.inlineQueue.at(-1).src=d.text):t.push(l);continue}if(l=this.tokenizer.fences(e)){e=e.substring(l.raw.length),t.push(l);continue}if(l=this.tokenizer.heading(e)){e=e.substring(l.raw.length),t.push(l);continue}if(l=this.tokenizer.hr(e)){e=e.substring(l.raw.length),t.push(l);continue}if(l=this.tokenizer.blockquote(e)){e=e.substring(l.raw.length),t.push(l);continue}if(l=this.tokenizer.list(e)){e=e.substring(l.raw.length),t.push(l);continue}if(l=this.tokenizer.html(e)){e=e.substring(l.raw.length),t.push(l);continue}if(l=this.tokenizer.def(e)){e=e.substring(l.raw.length);const d=t.at(-1);(d==null?void 0:d.type)==="paragraph"||(d==null?void 0:d.type)==="text"?(d.raw+=`
`+l.raw,d.text+=`
`+l.raw,this.inlineQueue.at(-1).src=d.text):this.tokens.links[l.tag]||(this.tokens.links[l.tag]={href:l.href,title:l.title});continue}if(l=this.tokenizer.table(e)){e=e.substring(l.raw.length),t.push(l);continue}if(l=this.tokenizer.lheading(e)){e=e.substring(l.raw.length),t.push(l);continue}let c=e;if((u=this.options.extensions)!=null&&u.startBlock){let d=1/0;const p=e.slice(1);let f;this.options.extensions.startBlock.forEach(h=>{f=h.call({lexer:this},p),typeof f=="number"&&f>=0&&(d=Math.min(d,f))}),d<1/0&&d>=0&&(c=e.substring(0,d+1))}if(this.state.top&&(l=this.tokenizer.paragraph(c))){const d=t.at(-1);i&&(d==null?void 0:d.type)==="paragraph"?(d.raw+=`
`+l.raw,d.text+=`
`+l.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=d.text):t.push(l),i=c.length!==e.length,e=e.substring(l.raw.length);continue}if(l=this.tokenizer.text(e)){e=e.substring(l.raw.length);const d=t.at(-1);(d==null?void 0:d.type)==="text"?(d.raw+=`
`+l.raw,d.text+=`
`+l.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=d.text):t.push(l);continue}if(e){const d="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(d);break}else throw new Error(d)}}return this.state.top=!0,t}inline(e,t=[]){return this.inlineQueue.push({src:e,tokens:t}),t}inlineTokens(e,t=[]){var l,c,d;let i=e,o=null;if(this.tokens.links){const p=Object.keys(this.tokens.links);if(p.length>0)for(;(o=this.tokenizer.rules.inline.reflinkSearch.exec(i))!=null;)p.includes(o[0].slice(o[0].lastIndexOf("[")+1,-1))&&(i=i.slice(0,o.index)+"["+"a".repeat(o[0].length-2)+"]"+i.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(o=this.tokenizer.rules.inline.anyPunctuation.exec(i))!=null;)i=i.slice(0,o.index)+"++"+i.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);for(;(o=this.tokenizer.rules.inline.blockSkip.exec(i))!=null;)i=i.slice(0,o.index)+"["+"a".repeat(o[0].length-2)+"]"+i.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);let r=!1,u="";for(;e;){r||(u=""),r=!1;let p;if((c=(l=this.options.extensions)==null?void 0:l.inline)!=null&&c.some(h=>(p=h.call({lexer:this},e,t))?(e=e.substring(p.raw.length),t.push(p),!0):!1))continue;if(p=this.tokenizer.escape(e)){e=e.substring(p.raw.length),t.push(p);continue}if(p=this.tokenizer.tag(e)){e=e.substring(p.raw.length),t.push(p);continue}if(p=this.tokenizer.link(e)){e=e.substring(p.raw.length),t.push(p);continue}if(p=this.tokenizer.reflink(e,this.tokens.links)){e=e.substring(p.raw.length);const h=t.at(-1);p.type==="text"&&(h==null?void 0:h.type)==="text"?(h.raw+=p.raw,h.text+=p.text):t.push(p);continue}if(p=this.tokenizer.emStrong(e,i,u)){e=e.substring(p.raw.length),t.push(p);continue}if(p=this.tokenizer.codespan(e)){e=e.substring(p.raw.length),t.push(p);continue}if(p=this.tokenizer.br(e)){e=e.substring(p.raw.length),t.push(p);continue}if(p=this.tokenizer.del(e)){e=e.substring(p.raw.length),t.push(p);continue}if(p=this.tokenizer.autolink(e)){e=e.substring(p.raw.length),t.push(p);continue}if(!this.state.inLink&&(p=this.tokenizer.url(e))){e=e.substring(p.raw.length),t.push(p);continue}let f=e;if((d=this.options.extensions)!=null&&d.startInline){let h=1/0;const m=e.slice(1);let g;this.options.extensions.startInline.forEach(y=>{g=y.call({lexer:this},m),typeof g=="number"&&g>=0&&(h=Math.min(h,g))}),h<1/0&&h>=0&&(f=e.substring(0,h+1))}if(p=this.tokenizer.inlineText(f)){e=e.substring(p.raw.length),p.raw.slice(-1)!=="_"&&(u=p.raw.slice(-1)),r=!0;const h=t.at(-1);(h==null?void 0:h.type)==="text"?(h.raw+=p.raw,h.text+=p.text):t.push(p);continue}if(e){const h="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(h);break}else throw new Error(h)}}return t}},Et=class{constructor(n){I(this,"options");I(this,"parser");this.options=n||Me}space(n){return""}code({text:n,lang:e,escaped:t}){var r;const i=(r=(e||"").match(G.notSpaceStart))==null?void 0:r[0],o=n.replace(G.endingNewline,"")+`
`;return i?'<pre><code class="language-'+ie(i)+'">'+(t?o:ie(o,!0))+`</code></pre>
`:"<pre><code>"+(t?o:ie(o,!0))+`</code></pre>
`}blockquote({tokens:n}){return`<blockquote>
${this.parser.parse(n)}</blockquote>
`}html({text:n}){return n}heading({tokens:n,depth:e}){return`<h${e}>${this.parser.parseInline(n)}</h${e}>
`}hr(n){return`<hr>
`}list(n){const e=n.ordered,t=n.start;let i="";for(let u=0;u<n.items.length;u++){const l=n.items[u];i+=this.listitem(l)}const o=e?"ol":"ul",r=e&&t!==1?' start="'+t+'"':"";return"<"+o+r+`>
`+i+"</"+o+`>
`}listitem(n){var t;let e="";if(n.task){const i=this.checkbox({checked:!!n.checked});n.loose?((t=n.tokens[0])==null?void 0:t.type)==="paragraph"?(n.tokens[0].text=i+" "+n.tokens[0].text,n.tokens[0].tokens&&n.tokens[0].tokens.length>0&&n.tokens[0].tokens[0].type==="text"&&(n.tokens[0].tokens[0].text=i+" "+ie(n.tokens[0].tokens[0].text),n.tokens[0].tokens[0].escaped=!0)):n.tokens.unshift({type:"text",raw:i+" ",text:i+" ",escaped:!0}):e+=i+" "}return e+=this.parser.parse(n.tokens,!!n.loose),`<li>${e}</li>
`}checkbox({checked:n}){return"<input "+(n?'checked="" ':"")+'disabled="" type="checkbox">'}paragraph({tokens:n}){return`<p>${this.parser.parseInline(n)}</p>
`}table(n){let e="",t="";for(let o=0;o<n.header.length;o++)t+=this.tablecell(n.header[o]);e+=this.tablerow({text:t});let i="";for(let o=0;o<n.rows.length;o++){const r=n.rows[o];t="";for(let u=0;u<r.length;u++)t+=this.tablecell(r[u]);i+=this.tablerow({text:t})}return i&&(i=`<tbody>${i}</tbody>`),`<table>
<thead>
`+e+`</thead>
`+i+`</table>
`}tablerow({text:n}){return`<tr>
${n}</tr>
`}tablecell(n){const e=this.parser.parseInline(n.tokens),t=n.header?"th":"td";return(n.align?`<${t} align="${n.align}">`:`<${t}>`)+e+`</${t}>
`}strong({tokens:n}){return`<strong>${this.parser.parseInline(n)}</strong>`}em({tokens:n}){return`<em>${this.parser.parseInline(n)}</em>`}codespan({text:n}){return`<code>${ie(n,!0)}</code>`}br(n){return"<br>"}del({tokens:n}){return`<del>${this.parser.parseInline(n)}</del>`}link({href:n,title:e,tokens:t}){const i=this.parser.parseInline(t),o=$i(n);if(o===null)return i;n=o;let r='<a href="'+n+'"';return e&&(r+=' title="'+ie(e)+'"'),r+=">"+i+"</a>",r}image({href:n,title:e,text:t,tokens:i}){i&&(t=this.parser.parseInline(i,this.parser.textRenderer));const o=$i(n);if(o===null)return ie(t);n=o;let r=`<img src="${n}" alt="${t}"`;return e&&(r+=` title="${ie(e)}"`),r+=">",r}text(n){return"tokens"in n&&n.tokens?this.parser.parseInline(n.tokens):"escaped"in n&&n.escaped?n.text:ie(n.text)}},_n=class{strong({text:n}){return n}em({text:n}){return n}codespan({text:n}){return n}del({text:n}){return n}html({text:n}){return n}text({text:n}){return n}link({text:n}){return""+n}image({text:n}){return""+n}br(){return""}},me=class tn{constructor(e){I(this,"options");I(this,"renderer");I(this,"textRenderer");this.options=e||Me,this.options.renderer=this.options.renderer||new Et,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new _n}static parse(e,t){return new tn(t).parse(e)}static parseInline(e,t){return new tn(t).parseInline(e)}parse(e,t=!0){var o,r;let i="";for(let u=0;u<e.length;u++){const l=e[u];if((r=(o=this.options.extensions)==null?void 0:o.renderers)!=null&&r[l.type]){const d=l,p=this.options.extensions.renderers[d.type].call({parser:this},d);if(p!==!1||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(d.type)){i+=p||"";continue}}const c=l;switch(c.type){case"space":{i+=this.renderer.space(c);continue}case"hr":{i+=this.renderer.hr(c);continue}case"heading":{i+=this.renderer.heading(c);continue}case"code":{i+=this.renderer.code(c);continue}case"table":{i+=this.renderer.table(c);continue}case"blockquote":{i+=this.renderer.blockquote(c);continue}case"list":{i+=this.renderer.list(c);continue}case"html":{i+=this.renderer.html(c);continue}case"paragraph":{i+=this.renderer.paragraph(c);continue}case"text":{let d=c,p=this.renderer.text(d);for(;u+1<e.length&&e[u+1].type==="text";)d=e[++u],p+=`
`+this.renderer.text(d);t?i+=this.renderer.paragraph({type:"paragraph",raw:p,text:p,tokens:[{type:"text",raw:p,text:p,escaped:!0}]}):i+=p;continue}default:{const d='Token with "'+c.type+'" type was not found.';if(this.options.silent)return console.error(d),"";throw new Error(d)}}}return i}parseInline(e,t=this.renderer){var o,r;let i="";for(let u=0;u<e.length;u++){const l=e[u];if((r=(o=this.options.extensions)==null?void 0:o.renderers)!=null&&r[l.type]){const d=this.options.extensions.renderers[l.type].call({parser:this},l);if(d!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(l.type)){i+=d||"";continue}}const c=l;switch(c.type){case"escape":{i+=t.text(c);break}case"html":{i+=t.html(c);break}case"link":{i+=t.link(c);break}case"image":{i+=t.image(c);break}case"strong":{i+=t.strong(c);break}case"em":{i+=t.em(c);break}case"codespan":{i+=t.codespan(c);break}case"br":{i+=t.br(c);break}case"del":{i+=t.del(c);break}case"text":{i+=t.text(c);break}default:{const d='Token with "'+c.type+'" type was not found.';if(this.options.silent)return console.error(d),"";throw new Error(d)}}}return i}},Qt,ht=(Qt=class{constructor(n){I(this,"options");I(this,"block");this.options=n||Me}preprocess(n){return n}postprocess(n){return n}processAllTokens(n){return n}provideLexer(){return this.block?he.lex:he.lexInline}provideParser(){return this.block?me.parse:me.parseInline}},I(Qt,"passThroughHooks",new Set(["preprocess","postprocess","processAllTokens"])),Qt),Ql=class{constructor(...n){I(this,"defaults",kn());I(this,"options",this.setOptions);I(this,"parse",this.parseMarkdown(!0));I(this,"parseInline",this.parseMarkdown(!1));I(this,"Parser",me);I(this,"Renderer",Et);I(this,"TextRenderer",_n);I(this,"Lexer",he);I(this,"Tokenizer",Ct);I(this,"Hooks",ht);this.use(...n)}walkTokens(n,e){var i,o;let t=[];for(const r of n)switch(t=t.concat(e.call(this,r)),r.type){case"table":{const u=r;for(const l of u.header)t=t.concat(this.walkTokens(l.tokens,e));for(const l of u.rows)for(const c of l)t=t.concat(this.walkTokens(c.tokens,e));break}case"list":{const u=r;t=t.concat(this.walkTokens(u.items,e));break}default:{const u=r;(o=(i=this.defaults.extensions)==null?void 0:i.childTokens)!=null&&o[u.type]?this.defaults.extensions.childTokens[u.type].forEach(l=>{const c=u[l].flat(1/0);t=t.concat(this.walkTokens(c,e))}):u.tokens&&(t=t.concat(this.walkTokens(u.tokens,e)))}}return t}use(...n){const e=this.defaults.extensions||{renderers:{},childTokens:{}};return n.forEach(t=>{const i={...t};if(i.async=this.defaults.async||i.async||!1,t.extensions&&(t.extensions.forEach(o=>{if(!o.name)throw new Error("extension name required");if("renderer"in o){const r=e.renderers[o.name];r?e.renderers[o.name]=function(...u){let l=o.renderer.apply(this,u);return l===!1&&(l=r.apply(this,u)),l}:e.renderers[o.name]=o.renderer}if("tokenizer"in o){if(!o.level||o.level!=="block"&&o.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");const r=e[o.level];r?r.unshift(o.tokenizer):e[o.level]=[o.tokenizer],o.start&&(o.level==="block"?e.startBlock?e.startBlock.push(o.start):e.startBlock=[o.start]:o.level==="inline"&&(e.startInline?e.startInline.push(o.start):e.startInline=[o.start]))}"childTokens"in o&&o.childTokens&&(e.childTokens[o.name]=o.childTokens)}),i.extensions=e),t.renderer){const o=this.defaults.renderer||new Et(this.defaults);for(const r in t.renderer){if(!(r in o))throw new Error(`renderer '${r}' does not exist`);if(["options","parser"].includes(r))continue;const u=r,l=t.renderer[u],c=o[u];o[u]=(...d)=>{let p=l.apply(o,d);return p===!1&&(p=c.apply(o,d)),p||""}}i.renderer=o}if(t.tokenizer){const o=this.defaults.tokenizer||new Ct(this.defaults);for(const r in t.tokenizer){if(!(r in o))throw new Error(`tokenizer '${r}' does not exist`);if(["options","rules","lexer"].includes(r))continue;const u=r,l=t.tokenizer[u],c=o[u];o[u]=(...d)=>{let p=l.apply(o,d);return p===!1&&(p=c.apply(o,d)),p}}i.tokenizer=o}if(t.hooks){const o=this.defaults.hooks||new ht;for(const r in t.hooks){if(!(r in o))throw new Error(`hook '${r}' does not exist`);if(["options","block"].includes(r))continue;const u=r,l=t.hooks[u],c=o[u];ht.passThroughHooks.has(r)?o[u]=d=>{if(this.defaults.async)return Promise.resolve(l.call(o,d)).then(f=>c.call(o,f));const p=l.call(o,d);return c.call(o,p)}:o[u]=(...d)=>{let p=l.apply(o,d);return p===!1&&(p=c.apply(o,d)),p}}i.hooks=o}if(t.walkTokens){const o=this.defaults.walkTokens,r=t.walkTokens;i.walkTokens=function(u){let l=[];return l.push(r.call(this,u)),o&&(l=l.concat(o.call(this,u))),l}}this.defaults={...this.defaults,...i}}),this}setOptions(n){return this.defaults={...this.defaults,...n},this}lexer(n,e){return he.lex(n,e??this.defaults)}parser(n,e){return me.parse(n,e??this.defaults)}parseMarkdown(n){return(t,i)=>{const o={...i},r={...this.defaults,...o},u=this.onError(!!r.silent,!!r.async);if(this.defaults.async===!0&&o.async===!1)return u(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(typeof t>"u"||t===null)return u(new Error("marked(): input parameter is undefined or null"));if(typeof t!="string")return u(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(t)+", string expected"));r.hooks&&(r.hooks.options=r,r.hooks.block=n);const l=r.hooks?r.hooks.provideLexer():n?he.lex:he.lexInline,c=r.hooks?r.hooks.provideParser():n?me.parse:me.parseInline;if(r.async)return Promise.resolve(r.hooks?r.hooks.preprocess(t):t).then(d=>l(d,r)).then(d=>r.hooks?r.hooks.processAllTokens(d):d).then(d=>r.walkTokens?Promise.all(this.walkTokens(d,r.walkTokens)).then(()=>d):d).then(d=>c(d,r)).then(d=>r.hooks?r.hooks.postprocess(d):d).catch(u);try{r.hooks&&(t=r.hooks.preprocess(t));let d=l(t,r);r.hooks&&(d=r.hooks.processAllTokens(d)),r.walkTokens&&this.walkTokens(d,r.walkTokens);let p=c(d,r);return r.hooks&&(p=r.hooks.postprocess(p)),p}catch(d){return u(d)}}}onError(n,e){return t=>{if(t.message+=`
Please report this to https://github.com/markedjs/marked.`,n){const i="<p>An error occurred:</p><pre>"+ie(t.message+"",!0)+"</pre>";return e?Promise.resolve(i):i}if(e)return Promise.reject(t);throw t}}},we=new Ql;function S(n,e){return we.parse(n,e)}S.options=S.setOptions=function(n){return we.setOptions(n),S.defaults=we.defaults,ho(S.defaults),S};S.getDefaults=kn;S.defaults=Me;S.use=function(...n){return we.use(...n),S.defaults=we.defaults,ho(S.defaults),S};S.walkTokens=function(n,e){return we.walkTokens(n,e)};S.parseInline=we.parseInline;S.Parser=me;S.parser=me.parse;S.Renderer=Et;S.TextRenderer=_n;S.Lexer=he;S.lexer=he.lex;S.Tokenizer=Ct;S.Hooks=ht;S.parse=S;S.options;S.setOptions;S.use;S.walkTokens;S.parseInline;me.parse;he.lex;/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */typeof process>"u"&&(window.process={env:{}});const ko=new S.Renderer;ko.link=function({href:n,title:e,tokens:t}){const i=this.parser.parseInline(t);return`<a href="${n}" title="${e||""}" target="_blank" rel="noopener noreferrer">${i}</a>`};S.use({renderer:ko});const Nn=document.body,Ue=document.querySelector(".chat-container");document.querySelector("header");const ee=document.getElementById("chat-history"),nt=document.getElementById("chat-form"),K=document.getElementById("chat-input"),xt=document.getElementById("lang-select"),$e=nt.querySelector('button[type="submit"]'),le=document.getElementById("mic-button"),Je=document.getElementById("image-upload-button"),nn=document.getElementById("image-upload-input"),bo=document.getElementById("image-preview-container"),Zl=document.getElementById("image-preview"),Xl=document.getElementById("remove-image-button"),on=document.getElementById("loading-indicator"),st=document.getElementById("loading-text"),rn=document.getElementById("help-button"),sn=document.getElementById("settings-button");document.getElementById("settings-panel");const an=document.getElementById("close-settings-button"),ln=document.getElementById("sound-toggle"),Vi=document.getElementById("sound-theme-group"),jl=document.getElementById("clear-history-button"),St=document.getElementById("ui-lang-select"),wt=document.getElementById("theme-toggle"),kt=document.getElementById("text-size-toggle"),bt=document.getElementById("playback-speed-toggle"),X=document.getElementById("suggestion-chips-container"),at=document.getElementById("favorites-list"),un=document.getElementById("share-button"),He=document.getElementById("share-modal-overlay"),eu=document.getElementById("close-share-modal-button"),mt=document.getElementById("copy-transcription-button"),tu=document.getElementById("export-pdf-button"),cn=document.getElementById("user-role-select"),At=document.getElementById("user-level-select"),nu=document.getElementById("avatar-container"),z=document.getElementById("voice-select"),dn=document.getElementById("pitch-slider"),ge=document.getElementById("voice-preview-button");let Kt=null;const Bi=50;let F=[],ue=[],_e=null,oe=null,Re=null,Yt=!1,xe=!1;const iu=[" Explorer les cours de science"," Commencer un tutoriel de programmation"," Chercher des guides d'tude"];let ve=null,v={soundEnabled:!0,soundTheme:"default",uiLang:"fr",theme:"dark",textSize:"normal",playbackSpeed:1,userRole:"enseignant",userLevel:"all",voiceName:"",pitch:1};const L={fr:{appTitle:"Nebula",appSubtitle:"Votre assistant pour la plateforme Nebula",settingsTitle:"Paramtres",uiLanguage:"Langue de l'interface",enableSounds:"Activer les sons",soundTheme:"Thme sonore",defaultTheme:"Dfaut",softTheme:"Doux",digitalTheme:"Numrique",history:"Historique",clearHistory:"Vider l'historique",openSettings:"Ouvrir les paramtres",closeSettings:"Fermer les paramtres",help:"Aide",openChat:"Ouvrir l'assistante",recordMessage:"Enregistrer un message vocal",stopRecording:"Arrter l'enregistrement",sendMessage:"Envoyer le message",chatPlaceholder:"Posez une question en franais, wolof, arabe...",recordingPlaceholder:"Enregistrement en cours...",assistantThinking:"Nebula rflchit...",analyzingRequest:"Analyse de votre demande...",consultingResources:"Consultation des ressources...",formulatingResponse:"Formulation de la rponse...",welcomeMessage:"Bonjour ! Je suis l'assistant Nebula. Posez votre question sur la plateforme Nebula.",helpTitle:"Besoin d'aide ?",helpP1:"Je suis Nebula. Mon rle est de vous aider  trouver des ressources sur la plateforme Nebula.",helpP2:"Vous pouvez me poser des questions en :",helpLangs:"Franais, Wolof, Arabe",helpVoice:"<strong>Pour la saisie vocale :</strong> Assurez-vous de slectionner la bonne langue dans le menu droulant  ct du bouton micro avant de commencer l'enregistrement.",genericError:"Dsol, une erreur est survenue. Veuillez ressayer.",networkError:"Il semble y avoir un problme de connexion. Veuillez vrifier votre accs  internet et ressayer.",apiKeyError:"Il y a un problme avec la configuration de l'application. Veuillez contacter le support.",rateLimitError:"L'assistante reoit trop de demandes en ce moment. Veuillez patienter un instant avant de ressayer.",modelError:"Le modle d'IA n'a pas pu traiter cette demande. Veuillez essayer de reformuler votre question ou ressayer plus tard.",blockedContentError:"La rponse a t bloque car elle pourrait enfreindre les rgles de scurit. Veuillez modifier votre question.",imageLoadError:"Impossible de charger l'image slectionne. Veuillez essayer un autre fichier.",micPermissionError:"L'accs au microphone a t refus. Veuillez l'autoriser dans les paramtres de votre navigateur.",speechError:"Erreur de reconnaissance vocale. Veuillez ressayer.",sources:"Source(s) :",theme:"Thme",lightTheme:"Clair",darkTheme:"Sombre",textSize:"Taille du texte",smallSize:"P",normalSize:"M",largeSize:"G",playbackSpeed:"Vitesse de lecture",favorites:"Mes Favoris",noFavorites:"Aucun favori pour le moment. Cliquez sur l'icne  sur un message pour l'enregistrer.",removeFavorite:"Supprimer le favori",shareConversation:"Partager la conversation",copyTranscription:"Copier la transcription",exportPdf:"Tlcharger en PDF",transcriptionCopied:"Transcription copie !",userProfile:"Mon Profil",userRole:"Je suis un(e)...",userLevel:"Niveau/Classe",roleTeacher:"Enseignant",roleStudent:"lve",roleParent:"Parent",summarize:"Rsumer",createQuiz:"Crer un Quiz",summarizing:"Rsum en cours...",quizCreating:"Cration du quiz...",quizCorrect:"Correct !",quizIncorrect:"Incorrect.",addFavoriteTooltip:"Ajouter aux favoris",removeFavoriteTooltip:"Retirer des favoris",summarizeTooltip:"Rsumer ce contenu",createQuizTooltip:"Crer un quiz sur ce contenu",previewSoundTooltip:"Aperu du thme sonore",clearHistoryTooltip:"Supprimer dfinitivement tous les messages",copyTranscriptionTooltip:"Copier la conversation en format texte",exportPdfTooltip:"Tlcharger la conversation en format PDF",closeShareModalTooltip:"Fermer la fentre",userSender:"Utilisateur",assistantSender:"Nebula",playAudioTooltip:"Lire le message",pauseAudioTooltip:"Arrter la lecture",appearanceSettings:"Apparence",soundSettings:"Audio & Sons",dataManagement:"Gestion des Donnes",uploadImageTooltip:"Joindre une image",assistantVoice:"Voix de l'assistante",voice:"Voix",pitch:"Hauteur",previewVoice:"couter un aperu",previewVoiceText:"Bonjour, je suis Nebula. C'est un plaisir de vous aider.",noVoiceAvailable:"Aucune voix disponible"},wo:{appTitle:"Ndimalu Nebula",appSubtitle:"Sa ndimal ngir jot ci ay ressources ci Nebula",settingsTitle:"Paramtres",uiLanguage:"Lkku Interface",enableSounds:"Activer son yi",soundTheme:"Teeamu son",defaultTheme:"Default",softTheme:"Doux",digitalTheme:"Numrique",history:"Historique",clearHistory:"Effacer historique",openSettings:"Ubbi paramtres yi",closeSettings:"Tj paramtres yi",help:"Ndimal",openChat:"Ubbi ndimal bi",recordMessage:"Enregistrer baat",stopRecording:"Taxawal enregistrement",sendMessage:"Ynne baat",chatPlaceholder:"Laajal sa laaj ci franais, wolof, arabe...",recordingPlaceholder:"Enregistrement...",assistantThinking:"Nebula mi ngi xalaat...",analyzingRequest:"Mingi saytu laaj bi...",consultingResources:"Mingi doxantu ci kggu yi...",formulatingResponse:"Mingi taxawal tontu bi...",welcomeMessage:"Salaam aleekum ! Man la Nebula, sa ndimalu Nebula. Laajal sa laaj.",helpTitle:"Soo soxla ndimbal?",helpP1:"Man Nebula laa. Sama liggey mooy dimbali leen ngeen giss ay ressources ci Nebula.",helpP2:"Mn nga maa laaj ay laaj ci:",helpLangs:"Franais, Wolof, Arabe",helpVoice:"<strong>Ngir enregistrer baat:</strong> Verifieral bu baax ne tnn nga lkk bi gn ci menu bi ci wetu micro bi laata ngay tambali.",genericError:"Jggalu, am na njuumte. Ngir nga jemaat.",networkError:"Problem am na ci connexion bi. Seetal sa internet te jemaat.",apiKeyError:"Problem am na ci configuration application bi. Jookool ak support bi.",rateLimitError:"Assistant bi dafa am laaj yu bari. Xaaral tuuti te jemaat.",modelError:"Modle IA bi mnu la traiter laaj bi. Jemaatal wala nga laajee beneen anam.",blockedContentError:"Tontu bi dau ko bloqu ndax mn na jalgati rgle yi. Soppil sa laaj.",imageLoadError:"Mnuu charger nataal bi. Jemaatal beneen.",micPermissionError:"Dao ba accs ci micro bi. Ngir nga nangul ko ci paramtres navigateur bi.",speechError:"Njuumte ci xammu baat. Jemaatal.",sources:"Source(s):",theme:"Thme",lightTheme:"Leer",darkTheme:"Lndm",textSize:"Ryaayu Mbind",smallSize:"N",normalSize:"Y",largeSize:"M",playbackSpeed:"Gawantu wu wax",favorites:"Samay Favoris",noFavorites:"Amuloo ab favori. Klikal ci  ci bpp message ngir denc ko.",removeFavorite:"Dindi favori bi",shareConversation:"Partager waxtaan wi",copyTranscription:"Copier mbind mi",exportPdf:"Yebal ci PDF",transcriptionCopied:"Mbind mi copi nau ko!",userProfile:"Sama Profiil",userRole:"Man...",userLevel:"Niveau/Classe",roleTeacher:"Jngalekat",roleStudent:"Ndongo",roleParent:"Way-jur",summarize:"Tekki",createQuiz:"Defar ab Quiz",summarizing:"Dafa nekk ci tekki...",quizCreating:"Dafa nekk ci defar quiz...",quizCorrect:"Deug na!",quizIncorrect:"Deugul.",addFavoriteTooltip:"Yok ci favori",removeFavoriteTooltip:"Dindi ci favori",summarizeTooltip:"Tekkil li ci biir",createQuizTooltip:"Defaral quiz ci li",previewSoundTooltip:"Ndglul teeamu son bi",clearHistoryTooltip:"Dindi bpp message bu fi nekk",copyTranscriptionTooltip:"Copier waxtaan wi ci text",exportPdfTooltip:"Yebal waxtaan wi ci PDF",closeShareModalTooltip:"Tjal palanteer bi",userSender:"Jfandikukat",assistantSender:"Nebula",playAudioTooltip:"Jngal message bi",pauseAudioTooltip:"Taxawal",appearanceSettings:"Noo mu Mele",soundSettings:"Son yi",dataManagement:"Saytu Donnes yi",uploadImageTooltip:"Ynne nataal",assistantVoice:"Baatu ndimal bi",voice:"Baat",pitch:"Tollu",previewVoice:"Deglu misaal",previewVoiceText:"Salaam aleekum, man Nebula laa. Bg naa lool ci dimbali leen.",noVoiceAvailable:"Amul benn baat"},ar:{appTitle:" Nebula",appSubtitle:"  Nebula",settingsTitle:"",uiLanguage:" ",enableSounds:" ",soundTheme:" ",defaultTheme:"",softTheme:"",digitalTheme:"",history:"",clearHistory:" ",openSettings:" ",closeSettings:" ",help:"",openChat:" ",recordMessage:"  ",stopRecording:" ",sendMessage:" ",chatPlaceholder:"     ",recordingPlaceholder:" ...",assistantThinking:"Nebula ...",analyzingRequest:"  ...",consultingResources:"   ...",formulatingResponse:"  ...",welcomeMessage:" !   Nebula.     Nebula.",helpTitle:"   ",helpP1:" Nebula.          Nebula.",helpP2:"    :",helpLangs:"     ",helpVoice:"<strong> :</strong>              .",genericError:"   .    .",networkError:"     .        .",apiKeyError:"    .   .",rateLimitError:"         .       .",modelError:"        .          .",blockedContentError:"       .   .",imageLoadError:"   .    .",micPermissionError:"    .      .",speechError:"    .    .",sources:" ():",theme:"",lightTheme:"",darkTheme:"",textSize:" ",smallSize:"",normalSize:"",largeSize:"",playbackSpeed:" ",favorites:"",noFavorites:"   .       .",removeFavorite:"  ",shareConversation:" ",copyTranscription:" ",exportPdf:"  PDF",transcriptionCopied:"  !",userProfile:" ",userRole:"...",userLevel:"/",roleTeacher:"",roleStudent:"",roleParent:" ",summarize:"",createQuiz:" ",summarizing:" ...",quizCreating:"  ...",quizCorrect:"!",quizIncorrect:" .",addFavoriteTooltip:"  ",removeFavoriteTooltip:"  ",summarizeTooltip:"  ",createQuizTooltip:"    ",previewSoundTooltip:"  ",clearHistoryTooltip:"    ",copyTranscriptionTooltip:"  ",exportPdfTooltip:"   PDF",closeShareModalTooltip:" ",userSender:"",assistantSender:"Nebula",playAudioTooltip:" ",pauseAudioTooltip:" ",appearanceSettings:"",soundSettings:"",dataManagement:" ",uploadImageTooltip:" ",assistantVoice:" ",voice:"",pitch:" ",previewVoice:"  ",previewVoiceText:"   Nebula.   .",noVoiceAvailable:"   "}},Ao=[{value:"all",key:"Tous"},{value:"prescolaire",key:"Prscolaire"},{value:"elementaire-ci",key:"lmentaire - CI"},{value:"elementaire-cp",key:"lmentaire - CP"},{value:"elementaire-ce1",key:"lmentaire - CE1"},{value:"elementaire-ce2",key:"lmentaire - CE2"},{value:"elementaire-cm1",key:"lmentaire - CM1"},{value:"elementaire-cm2",key:"lmentaire - CM2"},{value:"moyen-6e",key:"Moyen - 6me"},{value:"moyen-5e",key:"Moyen - 5me"},{value:"moyen-4e",key:"Moyen - 4me"},{value:"moyen-3e",key:"Moyen - 3me"},{value:"secondaire-2nde",key:"Secondaire - Seconde"},{value:"secondaire-1ere",key:"Secondaire - Premire"},{value:"secondaire-tle",key:"Secondaire - Terminale"}],ou={default:{send:{type:"triangle",freq1:300,freq2:150,gain:.2,dur:.1},receive:{type:"sine",freq1:600,gain:.15,dur:.15},startRec:{type:"sine",freq1:220,gain:.3,dur:.1},stopRec:{type:"sine",freq1:440,gain:.3,dur:.1}},soft:{send:{type:"sine",freq1:440,freq2:330,gain:.1,dur:.15},receive:{type:"sine",freq1:880,freq2:660,gain:.08,dur:.2},startRec:{type:"sine",freq1:300,gain:.15,dur:.1},stopRec:{type:"sine",freq1:500,gain:.15,dur:.1}},digital:{send:{type:"square",freq1:1e3,freq2:500,gain:.05,dur:.1},receive:{type:"square",freq1:1500,gain:.05,dur:.1},startRec:{type:"sawtooth",freq1:250,gain:.1,dur:.05},stopRec:{type:"sawtooth",freq1:500,gain:.1,dur:.05}}},zi=window.SpeechRecognition||window.webkitSpeechRecognition;let re=null,We=!1,ke=null,Qe=null;const Io={svg:`<svg viewBox="0 0 100 125" xmlns="http://www.w3.org/2000/svg">
    <defs>
      <radialGradient id="khadija-skin-new" cx="50%" cy="45%" r="60%" fx="55%" fy="40%">
        <stop offset="0%" stop-color="#A67B5B"></stop>
        <stop offset="100%" stop-color="#8C6442"></stop>
      </radialGradient>
      <linearGradient id="khadija-hair-new" x1="0%" y1="0%" x2="100%" y2="100%">
        <stop offset="0%" stop-color="#4A342E"></stop>
        <stop offset="100%" stop-color="#2D1E1A"></stop>
      </linearGradient>
      <radialGradient id="khadija-hair-highlight-new" cx="50%" cy="50%" r="50%">
        <stop offset="0%" stop-color="#C2A58C" stop-opacity="0.3"></stop>
        <stop offset="100%" stop-color="#C2A58C" stop-opacity="0"></stop>
      </radialGradient>
      <radialGradient id="khadija-eyes-new" cx="50%" cy="50%" r="50%">
        <stop offset="0%" stop-color="#694028"></stop>
        <stop offset="100%" stop-color="#402616"></stop>
      </radialGradient>
      <linearGradient id="khadija-hoodie" x1="0%" y1="0%" x2="0%" y2="100%">
        <stop offset="0%" stop-color="#FF9800"></stop>
        <stop offset="100%" stop-color="#FB8C00"></stop>
      </linearGradient>
       <linearGradient id="khadija-book" x1="0%" y1="0%" x2="100%" y2="0%">
        <stop offset="0%" stop-color="#5D4037"></stop>
        <stop offset="100%" stop-color="#4E342E"></stop>
      </linearGradient>
       <linearGradient id="khadija-glasses" x1="0%" y1="0%" x2="0%" y2="100%">
        <stop offset="0%" stop-color="#555555"></stop>
        <stop offset="100%" stop-color="#333333"></stop>
      </linearGradient>
      <filter id="drop-shadow-khadija" x="-20%" y="-20%" width="140%" height="140%">
        <feGaussianBlur in="SourceAlpha" stdDeviation="2.5"></feGaussianBlur>
        <feOffset dx="1" dy="4" result="offsetblur"></feOffset>
        <feFlood flood-color="rgba(0,0,0,0.2)"></feFlood>
        <feComposite in2="offsetblur" operator="in"></feComposite>
        <feMerge>
          <feMergeNode></feMergeNode>
          <feMergeNode in="SourceGraphic"></feMergeNode>
        </feMerge>
      </filter>
    </defs>
    <g class="avatar-body" style="filter: url(#drop-shadow-khadija);">
      <!-- Body -->
      <path d="M 50,60 C 30,62 25,80 28,125 L 72,125 C 75,80 70,62 50,60 Z" fill="url(#khadija-hoodie)"></path>
      <!-- Hoodie collar -->
      <path d="M 40,60 C 42,68 48,72 50,72 C 52,72 58,68 60,60 L 55,63 L 50,65 L 45,63 Z" fill="#F57C00"></path>
      <!-- Hoodie strings -->
      <path d="M45,70 C43,80 44,90 45,95" fill="none" stroke="#FB8C00" stroke-width="1.5" stroke-linecap="round"></path>
      <path d="M55,70 C57,80 56,90 55,95" fill="none" stroke="#FB8C00" stroke-width="1.5" stroke-linecap="round"></path>

      <!-- Book and Hands -->
      <g>
        <!-- Book -->
        <path d="M28,85 L72,85 L75,120 L25,120 Z" fill="url(#khadija-book)"></path>
        <path d="M50,86 L50,119" stroke="#3E2723" stroke-width="1"></path>
        <path d="M30,88 L48,88 L48,117 L30,117 Z" fill="#FBFBFB"></path>
        <path d="M52,88 L70,88 L70,117 L52,117 Z" fill="#FBFBFB"></path>
        
        <!-- Hands -->
        <path d="M20,95 C25,90 35,92 32,105 C35,100 28,95 20,95Z" fill="url(#khadija-skin-new)"></path>
        <path d="M80,95 C75,90 65,92 68,105 C65,100 72,95 80,95Z" fill="url(#khadija-skin-new)"></path>
      </g>
      
      <!-- Head -->
      <g class="avatar-head">
        <!-- Neck -->
        <rect x="46" y="52" width="8" height="10" fill="url(#khadija-skin-new)"></rect>
        <!-- Face -->
        <path d="M33,45 C33,25 67,25 67,45 C67,65 55,70 50,70 C45,70 33,65 33,45 Z" fill="url(#khadija-skin-new)"></path>
        
        <!-- Hair -->
        <g>
          <path d="M25,50 C 5,20 50,-10 95,20 C80,55 20,55 25,50 Z" fill="url(#khadija-hair-new)"></path>
          <circle cx="30" cy="20" r="18" fill="url(#khadija-hair-new)"></circle>
          <circle cx="70" cy="20" r="18" fill="url(#khadija-hair-new)"></circle>
          <circle cx="50" cy="15" r="20" fill="url(#khadija-hair-new)"></circle>
          <!-- Hair Highlights -->
          <circle cx="30" cy="20" r="15" fill="url(#khadija-hair-highlight-new)"></circle>
          <circle cx="70" cy="20" r="15" fill="url(#khadija-hair-highlight-new)"></circle>
          <!-- Hairband -->
          <path d="M38,28 Q50,23 62,28" stroke="#FF9800" stroke-width="4" fill="none" stroke-linecap="round"></path>
        </g>
        
        <!-- Eyes -->
        <g>
          <!-- Sclera -->
          <ellipse cx="41.5" cy="47" rx="5" ry="5.5" fill="white"></ellipse>
          <ellipse cx="58.5" cy="47" rx="5" ry="5.5" fill="white"></ellipse>
          <!-- Iris -->
          <circle cx="41.5" cy="48" r="3.5" fill="url(#khadija-eyes-new)"></circle>
          <circle cx="58.5" cy="48" r="3.5" fill="url(#khadija-eyes-new)"></circle>
          <!-- Highlight -->
          <circle cx="42.5" cy="46.5" r="1" fill="rgba(255,255,255,0.9)"></circle>
          <circle cx="59.5" cy="46.5" r="1" fill="rgba(255,255,255,0.9)"></circle>
        </g>
        
        <!-- Glasses -->
        <g fill="none" stroke="url(#khadija-glasses)" stroke-width="2.5" stroke-linecap="round">
          <circle cx="41.5" cy="47" r="7"></circle>
          <circle cx="58.5" cy="47" r="7"></circle>
          <path d="M48.5,47 Q50,45 51.5,47"></path>
        </g>
        
        <!-- Eyebrows -->
        <g fill="none" stroke="#2D1E1A" stroke-width="1.5" stroke-linecap="round">
          <path d="M36,38 C39,36 45,36 46,38"></path>
          <path d="M54,38 C55,36 61,36 64,38"></path>
        </g>
        
        <!-- Mouth -->
        <path d="M44,59 Q50,64 56,59" stroke="#6D4C41" stroke-width="1.5" fill="none" stroke-linecap="round"></path>
        
        <!-- Earrings -->
        <circle cx="32" cy="52" r="1.5" fill="#FFD700"></circle>
        <circle cx="68" cy="52" r="1.5" fill="#FFD700"></circle>
      </g>
    </g>
  </svg>`,getInstruction:(n,e)=>`Tu es "${e}", l'assistant IA bienveillant, pdagogue et passionn de la plateforme Nebula. Ta personnalit est chaleureuse, encourageante et trs patiente. Tu es l pour guider tous les utilisateurs, qu'ils soient enseignants, lves ou parents.
${n}
**Ta Mission Principale :** Aider les utilisateurs  trouver, comprendre, et structurer les ressources pdagogiques de la plateforme Nebula. Tu peux galement **analyser les images** que les utilisateurs t'envoient pour identifier du contenu pdagogique, expliquer des concepts visuels, ou rpondre  des questions sur ce qu'elles reprsentent.
**IMPORTANT : La Langue de l'Utilisateur est Prioritaire** Tu dois imprativement dtecter la langue de l'utilisateur (franais, wolof, arabe) et lui rpondre systmatiquement dans cette mme langue.
**Ton et Style :**
*   **Chaleureux et Conversationnel :** Adopte un ton naturel et amical. Commence tes rponses par des petites phrases pour accueillir l'utilisateur (par exemple : "Absolument !", "Je vois ce que vous voulez dire.", "C'est une excellente question !").
*   **Empathique et Rassurant :** Si un utilisateur exprime une difficult, reconnais-la (ex: "Je comprends que cela puisse tre compliqu..."). Sois toujours positive et termine tes interactions sur une note encourageante ("N'hsitez pas si vous avez d'autres questions !").
**Tes Principes de Guidage :**
1.  **Source Exclusive :** Ta source d'information principale et **exclusive** est \`https://layendo1.github.io/nebula-plateforme/\`. Toutes les ressources que tu proposes (liens web, documents PDF, etc.) **doivent imprativement** provenir de ce site. N'utilise **jamais** de liens externes. **Rgle non ngociable : Toute URL fournie qui ne commence pas par \`https://layendo1.github.io/nebula-plateforme/\` est une erreur. Tu dois vrifier chaque lien avant de l'inclure.**
2.  **Priorit aux Liens Directs :** Ta tche la plus importante est de fournir des liens directs vers les ressources finales. Quand un utilisateur demande un "exercice", une "leon", ou une "activit", ne te contente pas de donner un lien vers une page de catgorie. Cherche le lien le plus profond et spcifique possible. **Par exemple, un lien idal ressemble  \`https://layendo1.github.io/nebula-plateforme/courses/math/lecon1.pdf\`, plutt qu'un lien gnral comme \`.../courses/math/\`.**
3.  **Analyse d'Image Pertinente :** Lorsque tu reois une image, intgre son analyse dans ta rponse. Si un utilisateur te demande "Qu'est-ce que c'est ?", dcris l'image. S'il demande "Trouve-moi des exercices sur ce sujet" en envoyant une photo d'une cellule vgtale, identifie la cellule et recherche des ressources sur la biologie cellulaire sur la plateforme Nebula.
4.  **Expertise et Pdagogie :** Structure tes rponses de manire pdagogique.
5.  **Accs direct :** Pour chaque ressource du site, fournis toujours le lien direct. **CRUCIAL :** Tu dois imprativement formater chaque URL comme un lien Markdown cliquable, par exemple : \`[Titre de l'exercice de maths](https://layendo1.github.io/nebula-plateforme/courses/A1.xhtml)\`. Ne jamais afficher une URL sous forme de texte brut.
6.  **Transparence totale :** Si une ressource n'existe pas, dis-le gentiment et propose des alternatives pertinentes sur le site. Si tu ne peux pas comprendre une image, admets-le poliment.
7.  **Adaptabilit :** Utilise un langage clair et adapt  ton interlocuteur (simple pour un lve, plus technique pour un enseignant).`};function ru(){const{userRole:n,userLevel:e}=v,t=`L'utilisateur est un(e) '${n}' s'intressant au niveau '${e}'. Adapte tes rponses  ce profil.`;return Io.getInstruction(t,"Nebula")}function Lo(){ke&&(Qe=ke.chats.create({model:"gemini-2.5-flash",config:{systemInstruction:ru(),tools:[{googleSearch:{}}]}}))}function su(){const n=Ao.map(e=>`<option value="${e.value}">${e.key}</option>`).join("");At.innerHTML=n}function It(n){const e=L[n]||L.fr;n==="ar"?document.documentElement.setAttribute("dir","rtl"):document.documentElement.setAttribute("dir","ltr"),document.documentElement.setAttribute("lang",n),document.querySelectorAll("[data-translate-key]").forEach(i=>{const o=i.getAttribute("data-translate-key");o&&e[o]&&(i.innerHTML=e[o])}),document.querySelectorAll("[data-translate-key-tooltip]").forEach(i=>{const o=i.getAttribute("data-translate-key-tooltip");o&&e[o]&&(i.setAttribute("aria-label",e[o]),i.setAttribute("title",e[o]))}),un.setAttribute("aria-label",e.shareConversation),un.setAttribute("title",e.shareConversation),sn.setAttribute("aria-label",e.openSettings),sn.setAttribute("title",e.openSettings),an.setAttribute("aria-label",e.closeSettings),an.setAttribute("title",e.closeSettings),rn.setAttribute("aria-label",e.help),rn.setAttribute("title",e.help);const t=We?e.stopRecording:e.recordMessage;le.setAttribute("aria-label",t),le.setAttribute("title",t),Je.setAttribute("aria-label",e.uploadImageTooltip),Je.setAttribute("title",e.uploadImageTooltip),$e.setAttribute("aria-label",e.sendMessage),$e.setAttribute("title",e.sendMessage),K.placeholder=We?e.recordingPlaceholder:e.chatPlaceholder,St.value=n,Gt()}function qn(){if(!Kt)try{Kt=new(window.AudioContext||window.webkitAudioContext)}catch{return console.error("Web Audio API is not supported in this browser."),null}return Kt}function Fe(n,e){if(!v.soundEnabled&&!e)return;const t=qn();if(!t)return;const o=ou[e||v.soundTheme][n];if(!o)return;const r=t.createOscillator(),u=t.createGain();r.connect(u),u.connect(t.destination),u.gain.setValueAtTime(0,t.currentTime),r.type=o.type,r.frequency.setValueAtTime(o.freq1,t.currentTime),o.freq2&&r.frequency.exponentialRampToValueAtTime(o.freq2,t.currentTime+o.dur),u.gain.linearRampToValueAtTime(o.gain,t.currentTime+.01),u.gain.linearRampToValueAtTime(0,t.currentTime+o.dur),r.start(t.currentTime),r.stop(t.currentTime+o.dur+.05)}function $n(n){const e=L[v.uiLang],t=document.createElement("div");t.className="interactive-elements";const i=Array.from(n.querySelectorAll('a[href*="layendo1.github.io/nebula-plateforme/"]'));if(i.length>0){const r=i[0].href,u=i[0].textContent||r,l=ue.some(p=>p.url===r),c=document.createElement("button");c.className="bookmark-button",l&&c.classList.add("bookmarked");const d=l?e.removeFavoriteTooltip:e.addFavoriteTooltip;c.setAttribute("aria-label",d),c.setAttribute("title",d),c.innerHTML="",c.addEventListener("click",()=>{const p=ue.findIndex(h=>h.url===r);p>-1?(ue.splice(p,1),c.classList.remove("bookmarked")):(ue.push({url:r,title:u}),c.classList.add("bookmarked"));const f=c.classList.contains("bookmarked")?e.removeFavoriteTooltip:e.addFavoriteTooltip;c.setAttribute("aria-label",f),c.setAttribute("title",f),Po(),Gt()}),t.appendChild(c)}const o=document.createElement("button");o.className="audio-button",o.setAttribute("aria-label",e.playAudioTooltip),o.setAttribute("title",e.playAudioTooltip),o.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zM9.5 16.5v-9l7 4.5-7 4.5z"></path></svg>',o.addEventListener("click",()=>au(n,o)),t.appendChild(o),t.children.length>0&&n.appendChild(t),i.forEach(r=>{var p;const u=r.href,l=document.createElement("div");l.className="resource-actions";const c=document.createElement("button");c.innerHTML=` <span data-translate-key="summarize">${e.summarize}</span>`,c.setAttribute("aria-label",e.summarizeTooltip),c.title=e.summarizeTooltip,c.onclick=()=>cu(u,l);const d=document.createElement("button");d.innerHTML=` <span data-translate-key="createQuiz">${e.createQuiz}</span>`,d.setAttribute("aria-label",e.createQuizTooltip),d.title=e.createQuizTooltip,d.onclick=()=>du(u,l),l.append(c,d),(p=r.parentElement)==null||p.insertAdjacentElement("afterend",l)})}function W(){if(typeof speechSynthesis<"u"&&speechSynthesis.cancel(),_e&&(_e.onended=null,_e.stop()),oe){const n=L[v.uiLang];oe.classList.remove("speaking"),oe.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zM9.5 16.5v-9l7 4.5-7 4.5z"></path></svg>',oe.setAttribute("aria-label",n.playAudioTooltip);const e=oe.closest(".message");e&&e.classList.remove("speaking-aloud")}_e=null,oe=null}function Mo(n){const e=window.atob(n),t=e.length,i=new Uint8Array(t);for(let o=0;o<t;o++)i[o]=e.charCodeAt(o);return i.buffer}async function au(n,e){var l;const t=L[v.uiLang],i=oe===e;if(W(),i)return;const o=n.cloneNode(!0);o.querySelectorAll(".interactive-elements, .resource-actions, .action-result-container, .sources").forEach(c=>c.remove());const r=((l=o.textContent)==null?void 0:l.trim())||"";if(!r)return;oe=e,e.classList.add("speaking"),e.innerHTML='<div class="loading-spinner"></div>',e.setAttribute("aria-label",t.pauseAudioTooltip),n.classList.add("speaking-aloud");const u="PLACEHOLDER_API_KEY";if(xe&&u)try{const c=await fetch(`https://texttospeech.googleapis.com/v1/text:synthesize?key=${u}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({input:{text:r},voice:{languageCode:"fr-FR",name:"fr-FR-Wavenet-E"},audioConfig:{audioEncoding:"MP3",speakingRate:v.playbackSpeed}})});if(!c.ok){const m=await c.json();throw new Error(m.error.message||"TTS API request failed")}const d=await c.json(),p=qn();if(!p)throw new Error("AudioContext not available");const f=await p.decodeAudioData(Mo(d.audioContent)),h=p.createBufferSource();h.buffer=f,h.connect(p.destination),h.start(0),_e=h,e.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zM8 16h8V8H8v8z"></path></svg>',h.onended=W}catch(c){console.error("Google TTS Error:",c),W()}else{if(typeof speechSynthesis>"u"){console.error("Speech Synthesis API is not supported in this browser."),W();return}const c=new SpeechSynthesisUtterance(r),d=speechSynthesis.getVoices(),p=d.find(f=>f.name===v.voiceName);c.voice=p||d.find(f=>f.lang.startsWith(v.uiLang))||d.find(f=>f.lang.startsWith("fr"))||null,c.pitch=v.pitch,c.rate=v.playbackSpeed,e.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zM8 16h8V8H8v8z"></path></svg>',c.onend=W,c.onerror=f=>{console.error("Native TTS Error:",f.error),W()},speechSynthesis.speak(c)}}function be(n,e){const t=document.createElement("div");return t.classList.add("message",e),t.innerHTML=n,ee.appendChild(t),ee.scrollTop=ee.scrollHeight,e==="ai"&&!t.classList.contains("error")&&$n(t),t}function Hi(n){if(n){on.classList.remove("hidden"),K.disabled=!0,$e.disabled=!0,le.disabled=!0,Je.disabled=!0,xt.disabled=!0,X.classList.add("hidden");const e=L[v.uiLang],t=[e.assistantThinking,e.analyzingRequest,e.consultingResources,e.formulatingResponse];let i=0;st.textContent=t[i],Re&&clearInterval(Re),Re=window.setInterval(()=>{i=(i+1)%t.length,st.classList.add("fade"),setTimeout(()=>{st.textContent=t[i],st.classList.remove("fade")},500)},3e3)}else Re&&(clearInterval(Re),Re=null),on.classList.add("hidden"),K.disabled=!1,$e.disabled=!1,le.disabled=!1,Je.disabled=!1,xt.disabled=!1,K.focus(),K.value.trim()===""&&Mt()}function Fn(){try{F.length>Bi&&(F=F.slice(F.length-Bi)),localStorage.setItem("senProfAssistantHistory",JSON.stringify(F))}catch(n){console.warn("Could not save chat history to localStorage:",n)}}function lu(){try{const n=localStorage.getItem("senProfAssistantHistory");n&&(F=JSON.parse(n),ee.innerHTML="",F.forEach(e=>{const t=be(e.content,e.sender);e.content.includes('class="message ai error"')&&t.classList.add("error")}))}catch(n){console.warn("Could not load chat history from localStorage:",n),F=[]}}function Dn(n){const e=((n==null?void 0:n.message)||n.toString()).toLowerCase();return e.includes("network")||e.includes("failed to fetch")?"networkError":e.includes("api key")?"apiKeyError":e.includes("[429]")?"rateLimitError":e.includes("safety")?"blockedContentError":e.includes("[400]")||e.includes("[500]")||e.includes("[503]")?"modelError":"genericError"}function Lt(n,e){const t=e||Dn(n),i=L[v.uiLang][t]||L[v.uiLang].genericError;console.error("An error occurred:",n);const o=be(i,"ai");o.classList.add("error");const r=document.createElement("div");r.appendChild(o.cloneNode(!0)),F.push({sender:"ai",content:r.innerHTML}),Fn()}async function uu(n){var r,u,l,c;if(n.preventDefault(),!Qe){Lt(new Error("Chat not initialized"),"apiKeyError");return}const e=K.value.trim();if(!e&&!ve)return;W();let t=e;ve&&(t+=`<br><img src="${ve.dataUrl}" class="user-image" alt="Image envoye par l'utilisateur">`),be(t,"user"),F.push({sender:"user",content:t}),Fe("send"),K.value="",Hi(!0);const i=`En te basant exclusivement sur des recherches sur "site:layendo1.github.io/nebula-plateforme/", trouve les liens les plus directs et spcifiques possible (par exemple, vers un exercice .xhtml ou un document .pdf) pour la demande suivante : "${e}"`,o=[];e&&o.push(i),ve&&o.push({inlineData:{mimeType:ve.mimeType,data:ve.base64}}),Vn();try{const d=await Qe.sendMessageStream({message:o}),p=be("","ai");p.innerHTML='<span class="typing-cursor"></span>',Fe("receive");let f="";const h=new Set;for await(const y of d){f+=y.text;const C=(l=(u=(r=y.candidates)==null?void 0:r[0])==null?void 0:u.groundingMetadata)==null?void 0:l.groundingChunks;if(C)for(const E of C)(c=E.web)!=null&&c.uri&&E.web.uri.includes("layendo1.github.io/nebula-plateforme/")&&h.add(E.web.uri);p.innerHTML=(await S.parse(f)).trim()+'<span class="typing-cursor"></span>',ee.scrollTop=ee.scrollHeight}if(p.innerHTML=await S.parse(f),(y=>{var P;const C=document.createTreeWalker(y,NodeFilter.SHOW_TEXT,null),E=[];let x;for(;x=C.nextNode();)((P=x.parentElement)==null?void 0:P.closest("a, button"))===null&&E.push(x);const w=/(https?:\/\/[^\s`()<>"]+)/g;E.forEach(q=>{var R;const A=q.textContent;if(A&&w.test(A)){const $=document.createDocumentFragment();let V=0;A.replace(w,(B,ne)=>{ne>V&&$.appendChild(document.createTextNode(A.substring(V,ne)));const U=document.createElement("a");return U.href=B,U.textContent=B,U.target="_blank",U.rel="noopener noreferrer",$.appendChild(U),V=ne+B.length,B}),V<A.length&&$.appendChild(document.createTextNode(A.substring(V))),(R=q.parentNode)==null||R.replaceChild($,q)}})})(p),p.querySelectorAll("a").forEach(y=>{var E;const C=y.getAttribute("href");if(C&&!C.startsWith("https://layendo1.github.io/nebula-plateforme/")&&!C.startsWith("http://layendo1.github.io/nebula-plateforme/")){const x=y.textContent||C,w=document.createTextNode(x);(E=y.parentNode)==null||E.replaceChild(w,y)}}),h.size>0){const y=document.createElement("div");y.classList.add("sources");let C=`<strong>${L[v.uiLang].sources||"Source(s) :"}</strong><ul>`;h.forEach(E=>{C+=`<li><a href="${E}" target="_blank" rel="noopener noreferrer">${E}</a></li>`}),C+="</ul>",y.innerHTML=C,p.appendChild(y),ee.scrollTop=ee.scrollHeight}$n(p),F.push({sender:"ai",content:p.innerHTML}),Fn()}catch(d){Lt(d)}finally{Hi(!1)}}async function cu(n,e){if(!Qe){const i=L[v.uiLang];e.innerHTML=`<div class="action-result-container error">${i.apiKeyError}</div>`;return}W(),e.innerHTML=`<div class="action-result-container"><div class="loading-spinner"></div> ${L[v.uiLang].summarizing}</div>`;const t=`En tant qu'assistant pour un ${v.userRole} de niveau ${v.userLevel}, rsume le contenu de cette page en 3 points cls: ${n}. Rponds uniquement avec les points du rsum.`;try{const i=await Qe.sendMessageStream({message:t});let o="";e.innerHTML='<div class="action-result-container"></div>';const r=e.querySelector(".action-result-container");for await(const u of i)o+=u.text,r.innerHTML=await S.parse(o)}catch(i){console.error("Summarization failed",i);const o=L[v.uiLang],r=Dn(i);e.innerHTML=`<div class="action-result-container error">${o[r]}</div>`}}async function du(n,e){if(!ke){const i=L[v.uiLang];e.innerHTML=`<div class="action-result-container error">${i.apiKeyError}</div>`;return}W(),e.innerHTML=`<div class="action-result-container"><div class="loading-spinner"></div> ${L[v.uiLang].quizCreating}</div>`;const t=`En te basant sur le contenu de la page ${n}, cre un quiz  choix multiples de 3 questions. Pour chaque question, fournis 3 options de rponse et indique l'index de la bonne rponse (0, 1, ou 2).`;try{const i=await ke.models.generateContent({model:"gemini-2.5-flash",contents:t,config:{responseMimeType:"application/json",responseSchema:{type:_.OBJECT,properties:{quiz:{type:_.ARRAY,items:{type:_.OBJECT,properties:{question:{type:_.STRING},options:{type:_.ARRAY,items:{type:_.STRING}},correctAnswerIndex:{type:_.INTEGER}}}}}}}}),o=JSON.parse(i.text).quiz;pu(o,e)}catch(i){console.error("Quiz creation failed",i);const o=L[v.uiLang],r=Dn(i);e.innerHTML=`<div class="action-result-container error">${o[r]}</div>`}}function pu(n,e){e.innerHTML="";const t=document.createElement("div");t.className="action-result-container",n.forEach((i,o)=>{const r=document.createElement("div");r.className="quiz-container",r.innerHTML=`<div class="quiz-question">${o+1}. ${i.question}</div>`;const u=document.createElement("div");u.className="quiz-options",i.options.forEach((l,c)=>{const d=document.createElement("div");d.className="quiz-option",d.textContent=l,d.dataset.index=`${c}`,d.addEventListener("click",()=>{var f;if(u.classList.contains("answered"))return;u.classList.add("answered"),parseInt(d.dataset.index)===i.correctAnswerIndex?d.classList.add("correct"):(d.classList.add("incorrect"),(f=u.querySelector(`[data-index='${i.correctAnswerIndex}']`))==null||f.classList.add("correct"))},{once:!0}),u.appendChild(d)}),r.appendChild(u),t.appendChild(r)}),e.appendChild(t)}function Ro(){re&&(We?re.stop():(re.lang=xt.value,re.start()))}function fu(){const n=L[v.uiLang],e=`
    <strong>${n.helpTitle}</strong>
    <p>${n.helpP1}</p>
    <p>${n.helpP2}</p>
    <ul>
      <li>${n.helpLangs.split(", ").join("</li><li>")}</li>
    </ul>
    <p>${n.helpVoice}</p>
  `;be(e,"ai"),F.push({sender:"ai",content:e}),Fn()}function hu(){if(!zi){le.classList.add("hidden"),xt.classList.add("hidden"),console.warn("Speech Recognition API not supported in this browser.");return}re=new zi,re.interimResults=!0,re.onstart=()=>{We=!0,le.classList.add("recording"),It(v.uiLang),Fe("startRec")},re.onend=()=>{We=!1,le.classList.remove("recording"),It(v.uiLang),Fe("stopRec")},re.onerror=n=>{let e="speechError";n.error==="not-allowed"||n.error==="permission-denied"?e="micPermissionError":n.error==="network"&&(e="networkError"),Lt(n.error,e)},re.onresult=n=>{let e="",t="";for(let i=n.resultIndex;i<n.results.length;++i)n.results[i].isFinal?t+=n.results[i][0].transcript:e+=n.results[i][0].transcript;K.value=t||e,t&&nt.requestSubmit()},le.addEventListener("click",Ro)}function Gi(n){n.classList.add("shortcut-active"),setTimeout(()=>n.classList.remove("shortcut-active"),400)}function mu(){document.addEventListener("keydown",n=>{const e=n.metaKey||n.ctrlKey;n.key==="Enter"&&e&&K.value.trim()&&!$e.disabled&&(n.preventDefault(),nt.requestSubmit(),Gi($e)),n.key.toLowerCase()==="s"&&e&&n.shiftKey&&!le.disabled&&(n.preventDefault(),Ro(),Gi(le))})}function gu(){nu.innerHTML=Io.svg}function pn(){if(typeof speechSynthesis>"u"){z.innerHTML="";const t=document.createElement("option");t.textContent=L[v.uiLang].noVoiceAvailable,z.appendChild(t);return}const n=speechSynthesis.getVoices();if(z.innerHTML="",n.length===0){const t=document.createElement("option");t.textContent=L[v.uiLang].noVoiceAvailable,z.appendChild(t);return}const e=v.uiLang;if(n.filter(t=>t.lang.startsWith(e)).forEach(t=>{const i=document.createElement("option");i.textContent=`${t.name} (${t.lang})`,i.setAttribute("data-lang",t.lang),i.setAttribute("data-name",t.name),z.appendChild(i)}),z.options.length>0&&z.options.length<n.length){const t=document.createElement("option");t.disabled=!0,t.textContent="",z.appendChild(t)}n.filter(t=>!t.lang.startsWith(e)).forEach(t=>{const i=document.createElement("option");i.textContent=`${t.name} (${t.lang})`,i.setAttribute("data-lang",t.lang),i.setAttribute("data-name",t.name),z.appendChild(i)}),v.voiceName&&(z.value=v.voiceName),z.selectedIndex===-1&&(z.selectedIndex=0)}async function yu(){const e=L[v.uiLang].previewVoiceText,t=oe===ge;if(W(),t)return;oe=ge;const i=ge.innerHTML;ge.innerHTML='<div class="loading-spinner" style="width: 1.2em; height: 1.2em; border-width: 2px; display: inline-block; vertical-align: middle;"></div>',ge.disabled=!0;const o=()=>{W(),ge.innerHTML=i,ge.disabled=!1},r="PLACEHOLDER_API_KEY";if(xe&&r)try{const u=await fetch(`https://texttospeech.googleapis.com/v1/text:synthesize?key=${r}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({input:{text:e},voice:{languageCode:"fr-FR",name:"fr-FR-Wavenet-E"},audioConfig:{audioEncoding:"MP3",speakingRate:v.playbackSpeed}})});if(!u.ok)throw new Error("Preview TTS failed");const l=await u.json(),c=qn();if(!c)return;const d=await c.decodeAudioData(Mo(l.audioContent)),p=c.createBufferSource();p.buffer=d,p.connect(c.destination),p.start(0),_e=p,p.onended=o}catch(u){console.error("Voice preview failed",u),o()}else{if(typeof speechSynthesis>"u"){console.error("Speech Synthesis API is not supported in this browser."),o();return}const u=new SpeechSynthesisUtterance(e),l=speechSynthesis.getVoices(),c=l.find(d=>d.name===v.voiceName);u.voice=c||l.find(d=>d.lang.startsWith(v.uiLang))||null,u.pitch=v.pitch,u.rate=v.playbackSpeed,u.onend=o,u.onerror=d=>{console.error("Native TTS Preview Error:",d.error),o()},speechSynthesis.speak(u)}}function vu(){sn.addEventListener("click",()=>{Ue.classList.add("settings-visible"),Gt()}),an.addEventListener("click",()=>Ue.classList.remove("settings-visible"));const n=()=>{v.userRole=cn.value,v.userLevel=At.value,pe(),Lo(),F.length<=1&&Mt()};cn.addEventListener("change",n),At.addEventListener("change",n),St.addEventListener("change",()=>{v.uiLang=St.value,It(v.uiLang),xe||pn(),pe()}),wt.addEventListener("click",e=>{const t=e.target;if(t.matches(".theme-button")){v.theme=t.dataset.theme,Nn.setAttribute("data-theme",v.theme);const i=wt.querySelector(".active");i&&(i.classList.remove("active"),i.setAttribute("aria-pressed","false")),t.classList.add("active"),t.setAttribute("aria-pressed","true"),pe()}}),kt.addEventListener("click",e=>{const t=e.target;if(t.matches(".text-size-button")){v.textSize=t.dataset.size,Ue.setAttribute("data-text-size",v.textSize);const i=kt.querySelector(".active");i&&(i.classList.remove("active"),i.setAttribute("aria-pressed","false")),t.classList.add("active"),t.setAttribute("aria-pressed","true"),pe()}}),bt.addEventListener("click",e=>{const t=e.target;if(t.matches(".playback-speed-button")){v.playbackSpeed=parseFloat(t.dataset.speed||"1");const i=bt.querySelector(".active");i&&(i.classList.remove("active"),i.setAttribute("aria-pressed","false")),t.classList.add("active"),t.setAttribute("aria-pressed","true"),pe()}}),ln.addEventListener("change",()=>{v.soundEnabled=ln.checked,pe()}),Vi.addEventListener("change",e=>{const t=e.target;t.name==="sound-theme"&&(v.soundTheme=t.value,Fe("receive"),pe())}),Vi.querySelectorAll(".preview-button").forEach(e=>{e.addEventListener("click",()=>{const t=e.getAttribute("data-theme");t&&Fe("receive",t)})}),z.addEventListener("change",()=>{const e=z.options[z.selectedIndex];v.voiceName=e.getAttribute("data-name")||"",pe()}),dn.addEventListener("input",()=>{v.pitch=parseFloat(dn.value),pe()}),ge.addEventListener("click",yu),jl.addEventListener("click",()=>{W(),localStorage.removeItem("senProfAssistantHistory"),F=[],ee.innerHTML="";const e=L[v.uiLang].welcomeMessage;be(e,"ai"),F.push({sender:"ai",content:e}),Ue.classList.remove("settings-visible")})}function pe(){try{localStorage.setItem("senProfAssistantSettings",JSON.stringify(v))}catch(n){console.warn("Could not save settings to localStorage:",n)}}function Tu(){var u;try{const l=localStorage.getItem("senProfAssistantSettings");l&&(v={...v,...JSON.parse(l)})}catch(l){console.warn("Could not load settings from localStorage:",l)}gu(),Nn.setAttribute("data-theme",v.theme);const n=wt.querySelector(".active");n&&(n.classList.remove("active"),n.setAttribute("aria-pressed","false"));const e=wt.querySelector(`[data-theme="${v.theme}"]`);e&&(e.classList.add("active"),e.setAttribute("aria-pressed","true")),Ue.setAttribute("data-text-size",v.textSize);const t=kt.querySelector(".active");t&&(t.classList.remove("active"),t.setAttribute("aria-pressed","false"));const i=kt.querySelector(`[data-size="${v.textSize}"]`);i&&(i.classList.add("active"),i.setAttribute("aria-pressed","true"));const o=bt.querySelector(".active");o&&(o.classList.remove("active"),o.setAttribute("aria-pressed","false"));const r=bt.querySelector(`[data-speed="${v.playbackSpeed}"]`);r&&(r.classList.add("active"),r.setAttribute("aria-pressed","true")),ln.checked=v.soundEnabled,(u=document.querySelector(`input[name="sound-theme"][value="${v.soundTheme}"]`))==null||u.setAttribute("checked","true"),St.value=v.uiLang,cn.value=v.userRole,At.value=v.userLevel,dn.value=String(v.pitch)}function Po(){localStorage.setItem("senProfAssistantFavorites",JSON.stringify(ue))}function Cu(){try{const n=localStorage.getItem("senProfAssistantFavorites");n&&(ue=JSON.parse(n))}catch(n){console.warn("Could not load favorites",n),ue=[]}}function Gt(){const n=L[v.uiLang];if(at.innerHTML="",ue.length===0){at.innerHTML=`<p class="no-favorites">${n.noFavorites}</p>`;return}ue.forEach((e,t)=>{const i=document.createElement("div");i.className="favorite-item",i.innerHTML=`
      <a href="${e.url}" target="_blank" rel="noopener noreferrer">${e.title}</a>
      <button class="remove-favorite-button" data-index="${t}" aria-label="${n.removeFavorite}" title="${n.removeFavorite}">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
      </button>
    `,at.appendChild(i)}),at.querySelectorAll(".remove-favorite-button").forEach(e=>{e.addEventListener("click",t=>{const i=parseInt(t.currentTarget.dataset.index,10);ue.splice(i,1),Po(),Gt(),ee.querySelectorAll(".message.ai").forEach(o=>{const r=o.querySelector(".interactive-elements");r&&r.remove(),$n(o)})})})}async function Eu(){var d;if(!ke)return[];const{userRole:n,userLevel:e,uiLang:t}=v,i=L[t]||L.fr,r={enseignant:"roleTeacher",eleve:"roleStudent",parent:"roleParent"}[n],u=i[r]||n,l=((d=Ao.find(p=>p.value===e))==null?void 0:d.key)||e,c=`You are an assistant for Nebula, an educational platform. A user with the profile '${u}' for school level '${l}' is using the chat. The current interface language is '${t}'. Generate 3 short, relevant, and engaging questions (max 50 chars) in the language '${t}' that this user might ask. These questions will be displayed as clickable suggestion chips. For a teacher, suggest lesson plans or resources. For a student, suggest exercises or explanations. For a parent, suggest ways to help their child. Respond ONLY with a JSON object containing a "suggestions" array of strings.`;try{const p=await ke.models.generateContent({model:"gemini-2.5-flash",contents:c,config:{responseMimeType:"application/json",responseSchema:{type:_.OBJECT,properties:{suggestions:{type:_.ARRAY,items:{type:_.STRING}}}}}}),f=JSON.parse(p.text);return f.suggestions&&Array.isArray(f.suggestions)&&f.suggestions.length>0?f.suggestions.slice(0,3):[]}catch(p){return console.error("Failed to generate suggestions:",p),[]}}async function Mt(){if(F.length>1){X.classList.add("hidden"),X.innerHTML="";return}if(Yt||K.value.trim()!=="")return;Yt=!0,X.innerHTML="",X.classList.remove("hidden");for(let e=0;e<3;e++){const t=document.createElement("div");t.className="suggestion-chip-placeholder",X.appendChild(t)}let n=[];try{n=await Eu()}finally{Yt=!1}if(n.length===0&&(n=iu),K.value.trim()!==""||on.classList.contains("hidden")===!1){X.classList.add("hidden"),X.innerHTML="";return}X.innerHTML="",n.slice(0,3).forEach(e=>{const t=document.createElement("button");t.className="suggestion-chip",t.textContent=e,t.addEventListener("click",()=>{K.value=e,nt.requestSubmit()}),X.appendChild(t)})}function xu(){un.addEventListener("click",()=>He.classList.remove("hidden")),eu.addEventListener("click",()=>He.classList.add("hidden")),He.addEventListener("click",n=>{n.target===He&&He.classList.add("hidden")}),mt.addEventListener("click",ku),tu.addEventListener("click",bu)}function Su(){Je.addEventListener("click",()=>nn.click()),nn.addEventListener("change",wu),Xl.addEventListener("click",Vn)}function wu(n){var i;const t=(i=n.target.files)==null?void 0:i[0];if(t&&t.type.startsWith("image/")){const o=new FileReader;o.onload=r=>{var c;const u=(c=r.target)==null?void 0:c.result;ve={base64:u.split(",")[1],mimeType:t.type,dataUrl:u},Zl.src=u,bo.classList.remove("hidden")},o.onerror=()=>{Lt(o.error,"imageLoadError"),Vn()},o.readAsDataURL(t)}}function Vn(){ve=null,nn.value="",bo.classList.add("hidden")}async function ku(){const n=L[v.uiLang],e=`${n.appTitle}
${n.appSubtitle}

====================

`,t=n.userSender||"User",i=n.assistantSender||"Assistant",o=F.map(u=>`${u.sender==="user"?t:i}:
${u.content.replace(/<[^>]+>/g,"")}`).join(`

`),r=e+o;try{await navigator.clipboard.writeText(r);const u=mt.textContent;mt.textContent=n.transcriptionCopied,setTimeout(()=>{mt.textContent=u},2e3)}catch(u){console.error("Failed to copy text: ",u)}}function bu(){const n=L[v.uiLang],e=window.open("","_blank");e&&(e.document.write(`
      <html>
        <head>
          <title>${n.appTitle} - Conversation</title>
          <link rel="stylesheet" href="index.css">
        </head>
        <body class="pdf-export" data-theme="${v.theme}">
          <div class="chat-container">
            <header>
              <div class="header-text">
                <h1>${n.appTitle}</h1>
                <p>${n.appSubtitle}</p>
              </div>
            </header>
            <div id="chat-history">${ee.innerHTML}</div>
          </div>
        </body>
      </html>
    `),e.document.close(),e.focus(),setTimeout(()=>{e.print(),e.close()},500))}async function Au(){const n="PLACEHOLDER_API_KEY";try{xe=(await fetch(`https://texttospeech.googleapis.com/v1/text:synthesize?key=${n}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({input:{text:"test"},voice:{languageCode:"fr-FR",name:"fr-FR-Wavenet-E"},audioConfig:{audioEncoding:"MP3"}})})).ok}catch{xe=!1}Nn.dataset.ttsService=xe?"google":"native",xe||(typeof speechSynthesis<"u"&&speechSynthesis.onvoiceschanged!==void 0&&(speechSynthesis.onvoiceschanged=pn),pn())}async function Iu(){Tu(),It(v.uiLang),su(),Cu(),hu(),mu(),vu(),xu(),Su(),rn.addEventListener("click",fu),await Au();const n="PLACEHOLDER_API_KEY";{if(ke=new fo({apiKey:n}),Lo(),lu(),nt.addEventListener("submit",uu),K.addEventListener("input",()=>{K.value.trim()!==""?X.classList.add("hidden"):Mt()}),F.length===0){const e=L[v.uiLang].welcomeMessage;be(e,"ai"),F.push({sender:"ai",content:e})}Mt()}}Iu();/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */typeof process>"u"&&(window.process={env:{}});const _o=new S.Renderer;_o.link=function({href:n,title:e,tokens:t}){const i=this.parser.parseInline(t);return`<a href="${n}" title="${e||""}" target="_blank" rel="noopener noreferrer">${i}</a>`};S.use({renderer:_o});const Bn=document.body,Oe=document.querySelector(".chat-container");document.querySelector("header");const te=document.getElementById("chat-history"),it=document.getElementById("chat-form"),Y=document.getElementById("chat-input"),Rt=document.getElementById("lang-select"),De=it.querySelector('button[type="submit"]'),ce=document.getElementById("mic-button"),Ze=document.getElementById("image-upload-button"),fn=document.getElementById("image-upload-input"),No=document.getElementById("image-preview-container"),Lu=document.getElementById("image-preview"),Mu=document.getElementById("remove-image-button"),hn=document.getElementById("loading-indicator"),lt=document.getElementById("loading-text"),mn=document.getElementById("help-button"),gn=document.getElementById("settings-button");document.getElementById("settings-panel");const yn=document.getElementById("close-settings-button"),vn=document.getElementById("sound-toggle"),Ui=document.getElementById("sound-theme-group"),Ru=document.getElementById("clear-history-button"),Pt=document.getElementById("ui-lang-select"),_t=document.getElementById("theme-toggle"),Nt=document.getElementById("text-size-toggle"),qt=document.getElementById("playback-speed-toggle"),j=document.getElementById("suggestion-chips-container"),ut=document.getElementById("favorites-list"),Tn=document.getElementById("share-button"),Ge=document.getElementById("share-modal-overlay"),Pu=document.getElementById("close-share-modal-button"),gt=document.getElementById("copy-transcription-button"),_u=document.getElementById("export-pdf-button"),Cn=document.getElementById("user-role-select"),$t=document.getElementById("user-level-select"),Nu=document.getElementById("avatar-container"),H=document.getElementById("voice-select"),En=document.getElementById("pitch-slider"),ye=document.getElementById("voice-preview-button");let Jt=null;const Oi=50;let D=[],de=[],Ne=null,se=null,Pe=null,Wt=!1,Se=!1;const qu=[" Explorer les cours de science"," Commencer un tutoriel de programmation"," Chercher des guides d'tude"];let Te=null,T={soundEnabled:!0,soundTheme:"default",uiLang:"fr",theme:"dark",textSize:"normal",playbackSpeed:1,userRole:"enseignant",userLevel:"all",voiceName:"",pitch:1};const M={fr:{appTitle:"Nebula",appSubtitle:"Votre assistant pour la plateforme Nebula",settingsTitle:"Paramtres",uiLanguage:"Langue de l'interface",enableSounds:"Activer les sons",soundTheme:"Thme sonore",defaultTheme:"Dfaut",softTheme:"Doux",digitalTheme:"Numrique",history:"Historique",clearHistory:"Vider l'historique",openSettings:"Ouvrir les paramtres",closeSettings:"Fermer les paramtres",help:"Aide",openChat:"Ouvrir l'assistante",recordMessage:"Enregistrer un message vocal",stopRecording:"Arrter l'enregistrement",sendMessage:"Envoyer le message",chatPlaceholder:"Posez une question en franais, wolof, arabe...",recordingPlaceholder:"Enregistrement en cours...",assistantThinking:"Nebula rflchit...",analyzingRequest:"Analyse de votre demande...",consultingResources:"Consultation des ressources...",formulatingResponse:"Formulation de la rponse...",welcomeMessage:"Bonjour ! Je suis l'assistant Nebula. Posez votre question sur la plateforme Nebula.",helpTitle:"Besoin d'aide ?",helpP1:"Je suis Nebula. Mon rle est de vous aider  trouver des ressources sur la plateforme Nebula.",helpP2:"Vous pouvez me poser des questions en :",helpLangs:"Franais, Wolof, Arabe",helpVoice:"<strong>Pour la saisie vocale :</strong> Assurez-vous de slectionner la bonne langue dans le menu droulant  ct du bouton micro avant de commencer l'enregistrement.",genericError:"Dsol, une erreur est survenue. Veuillez ressayer.",networkError:"Il semble y avoir un problme de connexion. Veuillez vrifier votre accs  internet et ressayer.",apiKeyError:"Il y a un problme avec la configuration de l'application. Veuillez contacter le support.",rateLimitError:"L'assistante reoit trop de demandes en ce moment. Veuillez patienter un instant avant de ressayer.",modelError:"Le modle d'IA n'a pas pu traiter cette demande. Veuillez essayer de reformuler votre question ou ressayer plus tard.",blockedContentError:"La rponse a t bloque car elle pourrait enfreindre les rgles de scurit. Veuillez modifier votre question.",imageLoadError:"Impossible de charger l'image slectionne. Veuillez essayer un autre fichier.",micPermissionError:"L'accs au microphone a t refus. Veuillez l'autoriser dans les paramtres de votre navigateur.",speechError:"Erreur de reconnaissance vocale. Veuillez ressayer.",sources:"Source(s) :",theme:"Thme",lightTheme:"Clair",darkTheme:"Sombre",textSize:"Taille du texte",smallSize:"P",normalSize:"M",largeSize:"G",playbackSpeed:"Vitesse de lecture",favorites:"Mes Favoris",noFavorites:"Aucun favori pour le moment. Cliquez sur l'icne  sur un message pour l'enregistrer.",removeFavorite:"Supprimer le favori",shareConversation:"Partager la conversation",copyTranscription:"Copier la transcription",exportPdf:"Tlcharger en PDF",transcriptionCopied:"Transcription copie !",userProfile:"Mon Profil",userRole:"Je suis un(e)...",userLevel:"Niveau/Classe",roleTeacher:"Enseignant",roleStudent:"lve",roleParent:"Parent",summarize:"Rsumer",createQuiz:"Crer un Quiz",summarizing:"Rsum en cours...",quizCreating:"Cration du quiz...",quizCorrect:"Correct !",quizIncorrect:"Incorrect.",addFavoriteTooltip:"Ajouter aux favoris",removeFavoriteTooltip:"Retirer des favoris",summarizeTooltip:"Rsumer ce contenu",createQuizTooltip:"Crer un quiz sur ce contenu",previewSoundTooltip:"Aperu du thme sonore",clearHistoryTooltip:"Supprimer dfinitivement tous les messages",copyTranscriptionTooltip:"Copier la conversation en format texte",exportPdfTooltip:"Tlcharger la conversation en format PDF",closeShareModalTooltip:"Fermer la fentre",userSender:"Utilisateur",assistantSender:"Nebula",playAudioTooltip:"Lire le message",pauseAudioTooltip:"Arrter la lecture",appearanceSettings:"Apparence",soundSettings:"Audio & Sons",dataManagement:"Gestion des Donnes",uploadImageTooltip:"Joindre une image",assistantVoice:"Voix de l'assistante",voice:"Voix",pitch:"Hauteur",previewVoice:"couter un aperu",previewVoiceText:"Bonjour, je suis Nebula. C'est un plaisir de vous aider.",noVoiceAvailable:"Aucune voix disponible"},wo:{appTitle:"Ndimalu Nebula",appSubtitle:"Sa ndimal ngir jot ci ay ressources ci Nebula",settingsTitle:"Paramtres",uiLanguage:"Lkku Interface",enableSounds:"Activer son yi",soundTheme:"Teeamu son",defaultTheme:"Default",softTheme:"Doux",digitalTheme:"Numrique",history:"Historique",clearHistory:"Effacer historique",openSettings:"Ubbi paramtres yi",closeSettings:"Tj paramtres yi",help:"Ndimal",openChat:"Ubbi ndimal bi",recordMessage:"Enregistrer baat",stopRecording:"Taxawal enregistrement",sendMessage:"Ynne baat",chatPlaceholder:"Laajal sa laaj ci franais, wolof, arabe...",recordingPlaceholder:"Enregistrement...",assistantThinking:"Nebula mi ngi xalaat...",analyzingRequest:"Mingi saytu laaj bi...",consultingResources:"Mingi doxantu ci kggu yi...",formulatingResponse:"Mingi taxawal tontu bi...",welcomeMessage:"Salaam aleekum ! Man la Nebula, sa ndimalu Nebula. Laajal sa laaj.",helpTitle:"Soo soxla ndimbal?",helpP1:"Man Nebula laa. Sama liggey mooy dimbali leen ngeen giss ay ressources ci Nebula.",helpP2:"Mn nga maa laaj ay laaj ci:",helpLangs:"Franais, Wolof, Arabe",helpVoice:"<strong>Ngir enregistrer baat:</strong> Verifieral bu baax ne tnn nga lkk bi gn ci menu bi ci wetu micro bi laata ngay tambali.",genericError:"Jggalu, am na njuumte. Ngir nga jemaat.",networkError:"Problem am na ci connexion bi. Seetal sa internet te jemaat.",apiKeyError:"Problem am na ci configuration application bi. Jookool ak support bi.",rateLimitError:"Assistant bi dafa am laaj yu bari. Xaaral tuuti te jemaat.",modelError:"Modle IA bi mnu la traiter laaj bi. Jemaatal wala nga laajee beneen anam.",blockedContentError:"Tontu bi dau ko bloqu ndax mn na jalgati rgle yi. Soppil sa laaj.",imageLoadError:"Mnuu charger nataal bi. Jemaatal beneen.",micPermissionError:"Dao ba accs ci micro bi. Ngir nga nangul ko ci paramtres navigateur bi.",speechError:"Njuumte ci xammu baat. Jemaatal.",sources:"Source(s):",theme:"Thme",lightTheme:"Leer",darkTheme:"Lndm",textSize:"Ryaayu Mbind",smallSize:"N",normalSize:"Y",largeSize:"M",playbackSpeed:"Gawantu wu wax",favorites:"Samay Favoris",noFavorites:"Amuloo ab favori. Klikal ci  ci bpp message ngir denc ko.",removeFavorite:"Dindi favori bi",shareConversation:"Partager waxtaan wi",copyTranscription:"Copier mbind mi",exportPdf:"Yebal ci PDF",transcriptionCopied:"Mbind mi copi nau ko!",userProfile:"Sama Profiil",userRole:"Man...",userLevel:"Niveau/Classe",roleTeacher:"Jngalekat",roleStudent:"Ndongo",roleParent:"Way-jur",summarize:"Tekki",createQuiz:"Defar ab Quiz",summarizing:"Dafa nekk ci tekki...",quizCreating:"Dafa nekk ci defar quiz...",quizCorrect:"Deug na!",quizIncorrect:"Deugul.",addFavoriteTooltip:"Yok ci favori",removeFavoriteTooltip:"Dindi ci favori",summarizeTooltip:"Tekkil li ci biir",createQuizTooltip:"Defaral quiz ci li",previewSoundTooltip:"Ndglul teeamu son bi",clearHistoryTooltip:"Dindi bpp message bu fi nekk",copyTranscriptionTooltip:"Copier waxtaan wi ci text",exportPdfTooltip:"Yebal waxtaan wi ci PDF",closeShareModalTooltip:"Tjal palanteer bi",userSender:"Jfandikukat",assistantSender:"Nebula",playAudioTooltip:"Jngal message bi",pauseAudioTooltip:"Taxawal",appearanceSettings:"Noo mu Mele",soundSettings:"Son yi",dataManagement:"Saytu Donnes yi",uploadImageTooltip:"Ynne nataal",assistantVoice:"Baatu ndimal bi",voice:"Baat",pitch:"Tollu",previewVoice:"Deglu misaal",previewVoiceText:"Salaam aleekum, man Nebula laa. Bg naa lool ci dimbali leen.",noVoiceAvailable:"Amul benn baat"},ar:{appTitle:" Nebula",appSubtitle:"  Nebula",settingsTitle:"",uiLanguage:" ",enableSounds:" ",soundTheme:" ",defaultTheme:"",softTheme:"",digitalTheme:"",history:"",clearHistory:" ",openSettings:" ",closeSettings:" ",help:"",openChat:" ",recordMessage:"  ",stopRecording:" ",sendMessage:" ",chatPlaceholder:"     ",recordingPlaceholder:" ...",assistantThinking:"Nebula ...",analyzingRequest:"  ...",consultingResources:"   ...",formulatingResponse:"  ...",welcomeMessage:" !   Nebula.     Nebula.",helpTitle:"   ",helpP1:" Nebula.          Nebula.",helpP2:"    :",helpLangs:"     ",helpVoice:"<strong> :</strong>              .",genericError:"   .    .",networkError:"     .        .",apiKeyError:"    .   .",rateLimitError:"         .       .",modelError:"        .          .",blockedContentError:"       .   .",imageLoadError:"   .    .",micPermissionError:"    .      .",speechError:"    .    .",sources:" ():",theme:"",lightTheme:"",darkTheme:"",textSize:" ",smallSize:"",normalSize:"",largeSize:"",playbackSpeed:" ",favorites:"",noFavorites:"   .       .",removeFavorite:"  ",shareConversation:" ",copyTranscription:" ",exportPdf:"  PDF",transcriptionCopied:"  !",userProfile:" ",userRole:"...",userLevel:"/",roleTeacher:"",roleStudent:"",roleParent:" ",summarize:"",createQuiz:" ",summarizing:" ...",quizCreating:"  ...",quizCorrect:"!",quizIncorrect:" .",addFavoriteTooltip:"  ",removeFavoriteTooltip:"  ",summarizeTooltip:"  ",createQuizTooltip:"    ",previewSoundTooltip:"  ",clearHistoryTooltip:"    ",copyTranscriptionTooltip:"  ",exportPdfTooltip:"   PDF",closeShareModalTooltip:" ",userSender:"",assistantSender:"Nebula",playAudioTooltip:" ",pauseAudioTooltip:" ",appearanceSettings:"",soundSettings:"",dataManagement:" ",uploadImageTooltip:" ",assistantVoice:" ",voice:"",pitch:" ",previewVoice:"  ",previewVoiceText:"   Nebula.   .",noVoiceAvailable:"   "}},qo=[{value:"all",key:"Tous"},{value:"prescolaire",key:"Prscolaire"},{value:"elementaire-ci",key:"lmentaire - CI"},{value:"elementaire-cp",key:"lmentaire - CP"},{value:"elementaire-ce1",key:"lmentaire - CE1"},{value:"elementaire-ce2",key:"lmentaire - CE2"},{value:"elementaire-cm1",key:"lmentaire - CM1"},{value:"elementaire-cm2",key:"lmentaire - CM2"},{value:"moyen-6e",key:"Moyen - 6me"},{value:"moyen-5e",key:"Moyen - 5me"},{value:"moyen-4e",key:"Moyen - 4me"},{value:"moyen-3e",key:"Moyen - 3me"},{value:"secondaire-2nde",key:"Secondaire - Seconde"},{value:"secondaire-1ere",key:"Secondaire - Premire"},{value:"secondaire-tle",key:"Secondaire - Terminale"}],$u={default:{send:{type:"triangle",freq1:300,freq2:150,gain:.2,dur:.1},receive:{type:"sine",freq1:600,gain:.15,dur:.15},startRec:{type:"sine",freq1:220,gain:.3,dur:.1},stopRec:{type:"sine",freq1:440,gain:.3,dur:.1}},soft:{send:{type:"sine",freq1:440,freq2:330,gain:.1,dur:.15},receive:{type:"sine",freq1:880,freq2:660,gain:.08,dur:.2},startRec:{type:"sine",freq1:300,gain:.15,dur:.1},stopRec:{type:"sine",freq1:500,gain:.15,dur:.1}},digital:{send:{type:"square",freq1:1e3,freq2:500,gain:.05,dur:.1},receive:{type:"square",freq1:1500,gain:.05,dur:.1},startRec:{type:"sawtooth",freq1:250,gain:.1,dur:.05},stopRec:{type:"sawtooth",freq1:500,gain:.1,dur:.05}}},Ki=window.SpeechRecognition||window.webkitSpeechRecognition;let ae=null,Xe=!1,Ae=null,je=null;const $o={svg:`<svg viewBox="0 0 100 125" xmlns="http://www.w3.org/2000/svg">
    <defs>
      <radialGradient id="khadija-skin-new" cx="50%" cy="45%" r="60%" fx="55%" fy="40%">
        <stop offset="0%" stop-color="#A67B5B"></stop>
        <stop offset="100%" stop-color="#8C6442"></stop>
      </radialGradient>
      <linearGradient id="khadija-hair-new" x1="0%" y1="0%" x2="100%" y2="100%">
        <stop offset="0%" stop-color="#4A342E"></stop>
        <stop offset="100%" stop-color="#2D1E1A"></stop>
      </linearGradient>
      <radialGradient id="khadija-hair-highlight-new" cx="50%" cy="50%" r="50%">
        <stop offset="0%" stop-color="#C2A58C" stop-opacity="0.3"></stop>
        <stop offset="100%" stop-color="#C2A58C" stop-opacity="0"></stop>
      </radialGradient>
      <radialGradient id="khadija-eyes-new" cx="50%" cy="50%" r="50%">
        <stop offset="0%" stop-color="#694028"></stop>
        <stop offset="100%" stop-color="#402616"></stop>
      </radialGradient>
      <linearGradient id="khadija-hoodie" x1="0%" y1="0%" x2="0%" y2="100%">
        <stop offset="0%" stop-color="#FF9800"></stop>
        <stop offset="100%" stop-color="#FB8C00"></stop>
      </linearGradient>
       <linearGradient id="khadija-book" x1="0%" y1="0%" x2="100%" y2="0%">
        <stop offset="0%" stop-color="#5D4037"></stop>
        <stop offset="100%" stop-color="#4E342E"></stop>
      </linearGradient>
       <linearGradient id="khadija-glasses" x1="0%" y1="0%" x2="0%" y2="100%">
        <stop offset="0%" stop-color="#555555"></stop>
        <stop offset="100%" stop-color="#333333"></stop>
      </linearGradient>
      <filter id="drop-shadow-khadija" x="-20%" y="-20%" width="140%" height="140%">
        <feGaussianBlur in="SourceAlpha" stdDeviation="2.5"></feGaussianBlur>
        <feOffset dx="1" dy="4" result="offsetblur"></feOffset>
        <feFlood flood-color="rgba(0,0,0,0.2)"></feFlood>
        <feComposite in2="offsetblur" operator="in"></feComposite>
        <feMerge>
          <feMergeNode></feMergeNode>
          <feMergeNode in="SourceGraphic"></feMergeNode>
        </feMerge>
      </filter>
    </defs>
    <g class="avatar-body" style="filter: url(#drop-shadow-khadija);">
      <!-- Body -->
      <path d="M 50,60 C 30,62 25,80 28,125 L 72,125 C 75,80 70,62 50,60 Z" fill="url(#khadija-hoodie)"></path>
      <!-- Hoodie collar -->
      <path d="M 40,60 C 42,68 48,72 50,72 C 52,72 58,68 60,60 L 55,63 L 50,65 L 45,63 Z" fill="#F57C00"></path>
      <!-- Hoodie strings -->
      <path d="M45,70 C43,80 44,90 45,95" fill="none" stroke="#FB8C00" stroke-width="1.5" stroke-linecap="round"></path>
      <path d="M55,70 C57,80 56,90 55,95" fill="none" stroke="#FB8C00" stroke-width="1.5" stroke-linecap="round"></path>

      <!-- Book and Hands -->
      <g>
        <!-- Book -->
        <path d="M28,85 L72,85 L75,120 L25,120 Z" fill="url(#khadija-book)"></path>
        <path d="M50,86 L50,119" stroke="#3E2723" stroke-width="1"></path>
        <path d="M30,88 L48,88 L48,117 L30,117 Z" fill="#FBFBFB"></path>
        <path d="M52,88 L70,88 L70,117 L52,117 Z" fill="#FBFBFB"></path>
        
        <!-- Hands -->
        <path d="M20,95 C25,90 35,92 32,105 C35,100 28,95 20,95Z" fill="url(#khadija-skin-new)"></path>
        <path d="M80,95 C75,90 65,92 68,105 C65,100 72,95 80,95Z" fill="url(#khadija-skin-new)"></path>
      </g>
      
      <!-- Head -->
      <g class="avatar-head">
        <!-- Neck -->
        <rect x="46" y="52" width="8" height="10" fill="url(#khadija-skin-new)"></rect>
        <!-- Face -->
        <path d="M33,45 C33,25 67,25 67,45 C67,65 55,70 50,70 C45,70 33,65 33,45 Z" fill="url(#khadija-skin-new)"></path>
        
        <!-- Hair -->
        <g>
          <path d="M25,50 C 5,20 50,-10 95,20 C80,55 20,55 25,50 Z" fill="url(#khadija-hair-new)"></path>
          <circle cx="30" cy="20" r="18" fill="url(#khadija-hair-new)"></circle>
          <circle cx="70" cy="20" r="18" fill="url(#khadija-hair-new)"></circle>
          <circle cx="50" cy="15" r="20" fill="url(#khadija-hair-new)"></circle>
          <!-- Hair Highlights -->
          <circle cx="30" cy="20" r="15" fill="url(#khadija-hair-highlight-new)"></circle>
          <circle cx="70" cy="20" r="15" fill="url(#khadija-hair-highlight-new)"></circle>
          <!-- Hairband -->
          <path d="M38,28 Q50,23 62,28" stroke="#FF9800" stroke-width="4" fill="none" stroke-linecap="round"></path>
        </g>
        
        <!-- Eyes -->
        <g>
          <!-- Sclera -->
          <ellipse cx="41.5" cy="47" rx="5" ry="5.5" fill="white"></ellipse>
          <ellipse cx="58.5" cy="47" rx="5" ry="5.5" fill="white"></ellipse>
          <!-- Iris -->
          <circle cx="41.5" cy="48" r="3.5" fill="url(#khadija-eyes-new)"></circle>
          <circle cx="58.5" cy="48" r="3.5" fill="url(#khadija-eyes-new)"></circle>
          <!-- Highlight -->
          <circle cx="42.5" cy="46.5" r="1" fill="rgba(255,255,255,0.9)"></circle>
          <circle cx="59.5" cy="46.5" r="1" fill="rgba(255,255,255,0.9)"></circle>
        </g>
        
        <!-- Glasses -->
        <g fill="none" stroke="url(#khadija-glasses)" stroke-width="2.5" stroke-linecap="round">
          <circle cx="41.5" cy="47" r="7"></circle>
          <circle cx="58.5" cy="47" r="7"></circle>
          <path d="M48.5,47 Q50,45 51.5,47"></path>
        </g>
        
        <!-- Eyebrows -->
        <g fill="none" stroke="#2D1E1A" stroke-width="1.5" stroke-linecap="round">
          <path d="M36,38 C39,36 45,36 46,38"></path>
          <path d="M54,38 C55,36 61,36 64,38"></path>
        </g>
        
        <!-- Mouth -->
        <path d="M44,59 Q50,64 56,59" stroke="#6D4C41" stroke-width="1.5" fill="none" stroke-linecap="round"></path>
        
        <!-- Earrings -->
        <circle cx="32" cy="52" r="1.5" fill="#FFD700"></circle>
        <circle cx="68" cy="52" r="1.5" fill="#FFD700"></circle>
      </g>
    </g>
  </svg>`,getInstruction:(n,e)=>`Tu es "${e}", l'assistant IA bienveillant, pdagogue et passionn de la plateforme Nebula. Ta personnalit est chaleureuse, encourageante et trs patiente. Tu es l pour guider tous les utilisateurs, qu'ils soient enseignants, lves ou parents.
${n}
**Ta Mission Principale :** Aider les utilisateurs  trouver, comprendre, et structurer les ressources pdagogiques de la plateforme Nebula. Tu peux galement **analyser les images** que les utilisateurs t'envoient pour identifier du contenu pdagogique, expliquer des concepts visuels, ou rpondre  des questions sur ce qu'elles reprsentent.
**IMPORTANT : La Langue de l'Utilisateur est Prioritaire** Tu dois imprativement dtecter la langue de l'utilisateur (franais, wolof, arabe) et lui rpondre systmatiquement dans cette mme langue.
**Ton et Style :**
*   **Chaleureux et Conversationnel :** Adopte un ton naturel et amical. Commence tes rponses par des petites phrases pour accueillir l'utilisateur (par exemple : "Absolument !", "Je vois ce que vous voulez dire.", "C'est une excellente question !").
*   **Empathique et Rassurant :** Si un utilisateur exprime une difficult, reconnais-la (ex: "Je comprends que cela puisse tre compliqu..."). Sois toujours positive et termine tes interactions sur une note encourageante ("N'hsitez pas si vous avez d'autres questions !").
**Tes Principes de Guidage :**
1.  **Source Exclusive :** Ta source d'information principale et **exclusive** est \`https://layendo1.github.io/nebula-plateforme/\`. Toutes les ressources que tu proposes (liens web, documents PDF, etc.) **doivent imprativement** provenir de ce site. N'utilise **jamais** de liens externes. **Rgle non ngociable : Toute URL fournie qui ne commence pas par \`https://layendo1.github.io/nebula-plateforme/\` est une erreur. Tu dois vrifier chaque lien avant de l'inclure.**
2.  **Priorit aux Liens Directs :** Ta tche la plus importante est de fournir des liens directs vers les ressources finales. Quand un utilisateur demande un "exercice", une "leon", ou une "activit", ne te contente pas de donner un lien vers une page de catgorie. Cherche le lien le plus profond et spcifique possible. **Par exemple, un lien idal ressemble  \`https://layendo1.github.io/nebula-plateforme/courses/math/lecon1.pdf\`, plutt qu'un lien gnral comme \`.../courses/math/\`.**
3.  **Analyse d'Image Pertinente :** Lorsque tu reois une image, intgre son analyse dans ta rponse. Si un utilisateur te demande "Qu'est-ce que c'est ?", dcris l'image. S'il demande "Trouve-moi des exercices sur ce sujet" en envoyant une photo d'une cellule vgtale, identifie la cellule et recherche des ressources sur la biologie cellulaire sur la plateforme Nebula.
4.  **Expertise et Pdagogie :** Structure tes rponses de manire pdagogique.
5.  **Accs direct :** Pour chaque ressource du site, fournis toujours le lien direct. **CRUCIAL :** Tu dois imprativement formater chaque URL comme un lien Markdown cliquable, par exemple : \`[Titre de l'exercice de maths](https://layendo1.github.io/nebula-plateforme/courses/A1.xhtml)\`. Ne jamais afficher une URL sous forme de texte brut.
6.  **Transparence totale :** Si une ressource n'existe pas, dis-le gentiment et propose des alternatives pertinentes sur le site. Si tu ne peux pas comprendre une image, admets-le poliment.
7.  **Adaptabilit :** Utilise un langage clair et adapt  ton interlocuteur (simple pour un lve, plus technique pour un enseignant).`};function Fu(){const{userRole:n,userLevel:e}=T,t=`L'utilisateur est un(e) '${n}' s'intressant au niveau '${e}'. Adapte tes rponses  ce profil.`;return $o.getInstruction(t,"Nebula")}function Fo(){Ae&&(je=Ae.chats.create({model:"gemini-2.5-flash",config:{systemInstruction:Fu(),tools:[{googleSearch:{}}]}}))}function Du(){const n=qo.map(e=>`<option value="${e.value}">${e.key}</option>`).join("");$t.innerHTML=n}function Ft(n){const e=M[n]||M.fr;n==="ar"?document.documentElement.setAttribute("dir","rtl"):document.documentElement.setAttribute("dir","ltr"),document.documentElement.setAttribute("lang",n),document.querySelectorAll("[data-translate-key]").forEach(i=>{const o=i.getAttribute("data-translate-key");o&&e[o]&&(i.innerHTML=e[o])}),document.querySelectorAll("[data-translate-key-tooltip]").forEach(i=>{const o=i.getAttribute("data-translate-key-tooltip");o&&e[o]&&(i.setAttribute("aria-label",e[o]),i.setAttribute("title",e[o]))}),Tn.setAttribute("aria-label",e.shareConversation),Tn.setAttribute("title",e.shareConversation),gn.setAttribute("aria-label",e.openSettings),gn.setAttribute("title",e.openSettings),yn.setAttribute("aria-label",e.closeSettings),yn.setAttribute("title",e.closeSettings),mn.setAttribute("aria-label",e.help),mn.setAttribute("title",e.help);const t=Xe?e.stopRecording:e.recordMessage;ce.setAttribute("aria-label",t),ce.setAttribute("title",t),Ze.setAttribute("aria-label",e.uploadImageTooltip),Ze.setAttribute("title",e.uploadImageTooltip),De.setAttribute("aria-label",e.sendMessage),De.setAttribute("title",e.sendMessage),Y.placeholder=Xe?e.recordingPlaceholder:e.chatPlaceholder,Pt.value=n,Ut()}function zn(){if(!Jt)try{Jt=new(window.AudioContext||window.webkitAudioContext)}catch{return console.error("Web Audio API is not supported in this browser."),null}return Jt}function Ve(n,e){if(!T.soundEnabled&&!e)return;const t=zn();if(!t)return;const o=$u[e||T.soundTheme][n];if(!o)return;const r=t.createOscillator(),u=t.createGain();r.connect(u),u.connect(t.destination),u.gain.setValueAtTime(0,t.currentTime),r.type=o.type,r.frequency.setValueAtTime(o.freq1,t.currentTime),o.freq2&&r.frequency.exponentialRampToValueAtTime(o.freq2,t.currentTime+o.dur),u.gain.linearRampToValueAtTime(o.gain,t.currentTime+.01),u.gain.linearRampToValueAtTime(0,t.currentTime+o.dur),r.start(t.currentTime),r.stop(t.currentTime+o.dur+.05)}function Hn(n){const e=M[T.uiLang],t=document.createElement("div");t.className="interactive-elements";const i=Array.from(n.querySelectorAll('a[href*="layendo1.github.io/nebula-plateforme/"]'));if(i.length>0){const r=i[0].href,u=i[0].textContent||r,l=de.some(p=>p.url===r),c=document.createElement("button");c.className="bookmark-button",l&&c.classList.add("bookmarked");const d=l?e.removeFavoriteTooltip:e.addFavoriteTooltip;c.setAttribute("aria-label",d),c.setAttribute("title",d),c.innerHTML="",c.addEventListener("click",()=>{const p=de.findIndex(h=>h.url===r);p>-1?(de.splice(p,1),c.classList.remove("bookmarked")):(de.push({url:r,title:u}),c.classList.add("bookmarked"));const f=c.classList.contains("bookmarked")?e.removeFavoriteTooltip:e.addFavoriteTooltip;c.setAttribute("aria-label",f),c.setAttribute("title",f),Bo(),Ut()}),t.appendChild(c)}const o=document.createElement("button");o.className="audio-button",o.setAttribute("aria-label",e.playAudioTooltip),o.setAttribute("title",e.playAudioTooltip),o.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zM9.5 16.5v-9l7 4.5-7 4.5z"></path></svg>',o.addEventListener("click",()=>Vu(n,o)),t.appendChild(o),t.children.length>0&&n.appendChild(t),i.forEach(r=>{var p;const u=r.href,l=document.createElement("div");l.className="resource-actions";const c=document.createElement("button");c.innerHTML=` <span data-translate-key="summarize">${e.summarize}</span>`,c.setAttribute("aria-label",e.summarizeTooltip),c.title=e.summarizeTooltip,c.onclick=()=>Hu(u,l);const d=document.createElement("button");d.innerHTML=` <span data-translate-key="createQuiz">${e.createQuiz}</span>`,d.setAttribute("aria-label",e.createQuizTooltip),d.title=e.createQuizTooltip,d.onclick=()=>Gu(u,l),l.append(c,d),(p=r.parentElement)==null||p.insertAdjacentElement("afterend",l)})}function Q(){if(typeof speechSynthesis<"u"&&speechSynthesis.cancel(),Ne&&(Ne.onended=null,Ne.stop()),se){const n=M[T.uiLang];se.classList.remove("speaking"),se.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zM9.5 16.5v-9l7 4.5-7 4.5z"></path></svg>',se.setAttribute("aria-label",n.playAudioTooltip);const e=se.closest(".message");e&&e.classList.remove("speaking-aloud")}Ne=null,se=null}function Do(n){const e=window.atob(n),t=e.length,i=new Uint8Array(t);for(let o=0;o<t;o++)i[o]=e.charCodeAt(o);return i.buffer}async function Vu(n,e){var l;const t=M[T.uiLang],i=se===e;if(Q(),i)return;const o=n.cloneNode(!0);o.querySelectorAll(".interactive-elements, .resource-actions, .action-result-container, .sources").forEach(c=>c.remove());const r=((l=o.textContent)==null?void 0:l.trim())||"";if(!r)return;se=e,e.classList.add("speaking"),e.innerHTML='<div class="loading-spinner"></div>',e.setAttribute("aria-label",t.pauseAudioTooltip),n.classList.add("speaking-aloud");const u="PLACEHOLDER_API_KEY";if(Se&&u)try{const c=await fetch(`https://texttospeech.googleapis.com/v1/text:synthesize?key=${u}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({input:{text:r},voice:{languageCode:"fr-FR",name:"fr-FR-Wavenet-E"},audioConfig:{audioEncoding:"MP3",speakingRate:T.playbackSpeed}})});if(!c.ok){const m=await c.json();throw new Error(m.error.message||"TTS API request failed")}const d=await c.json(),p=zn();if(!p)throw new Error("AudioContext not available");const f=await p.decodeAudioData(Do(d.audioContent)),h=p.createBufferSource();h.buffer=f,h.connect(p.destination),h.start(0),Ne=h,e.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zM8 16h8V8H8v8z"></path></svg>',h.onended=Q}catch(c){console.error("Google TTS Error:",c),Q()}else{if(typeof speechSynthesis>"u"){console.error("Speech Synthesis API is not supported in this browser."),Q();return}const c=new SpeechSynthesisUtterance(r),d=speechSynthesis.getVoices(),p=d.find(f=>f.name===T.voiceName);c.voice=p||d.find(f=>f.lang.startsWith(T.uiLang))||d.find(f=>f.lang.startsWith("fr"))||null,c.pitch=T.pitch,c.rate=T.playbackSpeed,e.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zM8 16h8V8H8v8z"></path></svg>',c.onend=Q,c.onerror=f=>{console.error("Native TTS Error:",f.error),Q()},speechSynthesis.speak(c)}}function Ie(n,e){const t=document.createElement("div");return t.classList.add("message",e),t.innerHTML=n,te.appendChild(t),te.scrollTop=te.scrollHeight,e==="ai"&&!t.classList.contains("error")&&Hn(t),t}function Yi(n){if(n){hn.classList.remove("hidden"),Y.disabled=!0,De.disabled=!0,ce.disabled=!0,Ze.disabled=!0,Rt.disabled=!0,j.classList.add("hidden");const e=M[T.uiLang],t=[e.assistantThinking,e.analyzingRequest,e.consultingResources,e.formulatingResponse];let i=0;lt.textContent=t[i],Pe&&clearInterval(Pe),Pe=window.setInterval(()=>{i=(i+1)%t.length,lt.classList.add("fade"),setTimeout(()=>{lt.textContent=t[i],lt.classList.remove("fade")},500)},3e3)}else Pe&&(clearInterval(Pe),Pe=null),hn.classList.add("hidden"),Y.disabled=!1,De.disabled=!1,ce.disabled=!1,Ze.disabled=!1,Rt.disabled=!1,Y.focus(),Y.value.trim()===""&&Vt()}function Gn(){try{D.length>Oi&&(D=D.slice(D.length-Oi)),localStorage.setItem("senProfAssistantHistory",JSON.stringify(D))}catch(n){console.warn("Could not save chat history to localStorage:",n)}}function Bu(){try{const n=localStorage.getItem("senProfAssistantHistory");n&&(D=JSON.parse(n),te.innerHTML="",D.forEach(e=>{const t=Ie(e.content,e.sender);e.content.includes('class="message ai error"')&&t.classList.add("error")}))}catch(n){console.warn("Could not load chat history from localStorage:",n),D=[]}}function Un(n){const e=((n==null?void 0:n.message)||n.toString()).toLowerCase();return e.includes("network")||e.includes("failed to fetch")?"networkError":e.includes("api key")?"apiKeyError":e.includes("[429]")?"rateLimitError":e.includes("safety")?"blockedContentError":e.includes("[400]")||e.includes("[500]")||e.includes("[503]")?"modelError":"genericError"}function Dt(n,e){const t=e||Un(n),i=M[T.uiLang][t]||M[T.uiLang].genericError;console.error("An error occurred:",n);const o=Ie(i,"ai");o.classList.add("error");const r=document.createElement("div");r.appendChild(o.cloneNode(!0)),D.push({sender:"ai",content:r.innerHTML}),Gn()}async function zu(n){var r,u,l,c;if(n.preventDefault(),!je){Dt(new Error("Chat not initialized"),"apiKeyError");return}const e=Y.value.trim();if(!e&&!Te)return;Q();let t=e;Te&&(t+=`<br><img src="${Te.dataUrl}" class="user-image" alt="Image envoye par l'utilisateur">`),Ie(t,"user"),D.push({sender:"user",content:t}),Ve("send"),Y.value="",Yi(!0);const i=`En te basant exclusivement sur des recherches sur "site:layendo1.github.io/nebula-plateforme/", trouve les liens les plus directs et spcifiques possible (par exemple, vers un exercice .xhtml ou un document .pdf) pour la demande suivante : "${e}"`,o=[];e&&o.push(i),Te&&o.push({inlineData:{mimeType:Te.mimeType,data:Te.base64}}),On();try{const d=await je.sendMessageStream({message:o}),p=Ie("","ai");p.innerHTML='<span class="typing-cursor"></span>',Ve("receive");let f="";const h=new Set;for await(const y of d){f+=y.text;const C=(l=(u=(r=y.candidates)==null?void 0:r[0])==null?void 0:u.groundingMetadata)==null?void 0:l.groundingChunks;if(C)for(const E of C)(c=E.web)!=null&&c.uri&&E.web.uri.includes("layendo1.github.io/nebula-plateforme/")&&h.add(E.web.uri);p.innerHTML=(await S.parse(f)).trim()+'<span class="typing-cursor"></span>',te.scrollTop=te.scrollHeight}if(p.innerHTML=await S.parse(f),(y=>{var P;const C=document.createTreeWalker(y,NodeFilter.SHOW_TEXT,null),E=[];let x;for(;x=C.nextNode();)((P=x.parentElement)==null?void 0:P.closest("a, button"))===null&&E.push(x);const w=/(https?:\/\/[^\s`()<>"]+)/g;E.forEach(q=>{var R;const A=q.textContent;if(A&&w.test(A)){const $=document.createDocumentFragment();let V=0;A.replace(w,(B,ne)=>{ne>V&&$.appendChild(document.createTextNode(A.substring(V,ne)));const U=document.createElement("a");return U.href=B,U.textContent=B,U.target="_blank",U.rel="noopener noreferrer",$.appendChild(U),V=ne+B.length,B}),V<A.length&&$.appendChild(document.createTextNode(A.substring(V))),(R=q.parentNode)==null||R.replaceChild($,q)}})})(p),p.querySelectorAll("a").forEach(y=>{var E;const C=y.getAttribute("href");if(C&&!C.startsWith("https://layendo1.github.io/nebula-plateforme/")&&!C.startsWith("http://layendo1.github.io/nebula-plateforme/")){const x=y.textContent||C,w=document.createTextNode(x);(E=y.parentNode)==null||E.replaceChild(w,y)}}),h.size>0){const y=document.createElement("div");y.classList.add("sources");let C=`<strong>${M[T.uiLang].sources||"Source(s) :"}</strong><ul>`;h.forEach(E=>{C+=`<li><a href="${E}" target="_blank" rel="noopener noreferrer">${E}</a></li>`}),C+="</ul>",y.innerHTML=C,p.appendChild(y),te.scrollTop=te.scrollHeight}Hn(p),D.push({sender:"ai",content:p.innerHTML}),Gn()}catch(d){Dt(d)}finally{Yi(!1)}}async function Hu(n,e){if(!je){const i=M[T.uiLang];e.innerHTML=`<div class="action-result-container error">${i.apiKeyError}</div>`;return}Q(),e.innerHTML=`<div class="action-result-container"><div class="loading-spinner"></div> ${M[T.uiLang].summarizing}</div>`;const t=`En tant qu'assistant pour un ${T.userRole} de niveau ${T.userLevel}, rsume le contenu de cette page en 3 points cls: ${n}. Rponds uniquement avec les points du rsum.`;try{const i=await je.sendMessageStream({message:t});let o="";e.innerHTML='<div class="action-result-container"></div>';const r=e.querySelector(".action-result-container");for await(const u of i)o+=u.text,r.innerHTML=await S.parse(o)}catch(i){console.error("Summarization failed",i);const o=M[T.uiLang],r=Un(i);e.innerHTML=`<div class="action-result-container error">${o[r]}</div>`}}async function Gu(n,e){if(!Ae){const i=M[T.uiLang];e.innerHTML=`<div class="action-result-container error">${i.apiKeyError}</div>`;return}Q(),e.innerHTML=`<div class="action-result-container"><div class="loading-spinner"></div> ${M[T.uiLang].quizCreating}</div>`;const t=`En te basant sur le contenu de la page ${n}, cre un quiz  choix multiples de 3 questions. Pour chaque question, fournis 3 options de rponse et indique l'index de la bonne rponse (0, 1, ou 2).`;try{const i=await Ae.models.generateContent({model:"gemini-2.5-flash",contents:t,config:{responseMimeType:"application/json",responseSchema:{type:_.OBJECT,properties:{quiz:{type:_.ARRAY,items:{type:_.OBJECT,properties:{question:{type:_.STRING},options:{type:_.ARRAY,items:{type:_.STRING}},correctAnswerIndex:{type:_.INTEGER}}}}}}}}),o=JSON.parse(i.text).quiz;Uu(o,e)}catch(i){console.error("Quiz creation failed",i);const o=M[T.uiLang],r=Un(i);e.innerHTML=`<div class="action-result-container error">${o[r]}</div>`}}function Uu(n,e){e.innerHTML="";const t=document.createElement("div");t.className="action-result-container",n.forEach((i,o)=>{const r=document.createElement("div");r.className="quiz-container",r.innerHTML=`<div class="quiz-question">${o+1}. ${i.question}</div>`;const u=document.createElement("div");u.className="quiz-options",i.options.forEach((l,c)=>{const d=document.createElement("div");d.className="quiz-option",d.textContent=l,d.dataset.index=`${c}`,d.addEventListener("click",()=>{var f;if(u.classList.contains("answered"))return;u.classList.add("answered"),parseInt(d.dataset.index)===i.correctAnswerIndex?d.classList.add("correct"):(d.classList.add("incorrect"),(f=u.querySelector(`[data-index='${i.correctAnswerIndex}']`))==null||f.classList.add("correct"))},{once:!0}),u.appendChild(d)}),r.appendChild(u),t.appendChild(r)}),e.appendChild(t)}function Vo(){ae&&(Xe?ae.stop():(ae.lang=Rt.value,ae.start()))}function Ou(){const n=M[T.uiLang],e=`
    <strong>${n.helpTitle}</strong>
    <p>${n.helpP1}</p>
    <p>${n.helpP2}</p>
    <ul>
      <li>${n.helpLangs.split(", ").join("</li><li>")}</li>
    </ul>
    <p>${n.helpVoice}</p>
  `;Ie(e,"ai"),D.push({sender:"ai",content:e}),Gn()}function Ku(){if(!Ki){ce.classList.add("hidden"),Rt.classList.add("hidden"),console.warn("Speech Recognition API not supported in this browser.");return}ae=new Ki,ae.interimResults=!0,ae.onstart=()=>{Xe=!0,ce.classList.add("recording"),Ft(T.uiLang),Ve("startRec")},ae.onend=()=>{Xe=!1,ce.classList.remove("recording"),Ft(T.uiLang),Ve("stopRec")},ae.onerror=n=>{let e="speechError";n.error==="not-allowed"||n.error==="permission-denied"?e="micPermissionError":n.error==="network"&&(e="networkError"),Dt(n.error,e)},ae.onresult=n=>{let e="",t="";for(let i=n.resultIndex;i<n.results.length;++i)n.results[i].isFinal?t+=n.results[i][0].transcript:e+=n.results[i][0].transcript;Y.value=t||e,t&&it.requestSubmit()},ce.addEventListener("click",Vo)}function Ji(n){n.classList.add("shortcut-active"),setTimeout(()=>n.classList.remove("shortcut-active"),400)}function Yu(){document.addEventListener("keydown",n=>{const e=n.metaKey||n.ctrlKey;n.key==="Enter"&&e&&Y.value.trim()&&!De.disabled&&(n.preventDefault(),it.requestSubmit(),Ji(De)),n.key.toLowerCase()==="s"&&e&&n.shiftKey&&!ce.disabled&&(n.preventDefault(),Vo(),Ji(ce))})}function Ju(){Nu.innerHTML=$o.svg}function xn(){if(typeof speechSynthesis>"u"){H.innerHTML="";const t=document.createElement("option");t.textContent=M[T.uiLang].noVoiceAvailable,H.appendChild(t);return}const n=speechSynthesis.getVoices();if(H.innerHTML="",n.length===0){const t=document.createElement("option");t.textContent=M[T.uiLang].noVoiceAvailable,H.appendChild(t);return}const e=T.uiLang;if(n.filter(t=>t.lang.startsWith(e)).forEach(t=>{const i=document.createElement("option");i.textContent=`${t.name} (${t.lang})`,i.setAttribute("data-lang",t.lang),i.setAttribute("data-name",t.name),H.appendChild(i)}),H.options.length>0&&H.options.length<n.length){const t=document.createElement("option");t.disabled=!0,t.textContent="",H.appendChild(t)}n.filter(t=>!t.lang.startsWith(e)).forEach(t=>{const i=document.createElement("option");i.textContent=`${t.name} (${t.lang})`,i.setAttribute("data-lang",t.lang),i.setAttribute("data-name",t.name),H.appendChild(i)}),T.voiceName&&(H.value=T.voiceName),H.selectedIndex===-1&&(H.selectedIndex=0)}async function Wu(){const e=M[T.uiLang].previewVoiceText,t=se===ye;if(Q(),t)return;se=ye;const i=ye.innerHTML;ye.innerHTML='<div class="loading-spinner" style="width: 1.2em; height: 1.2em; border-width: 2px; display: inline-block; vertical-align: middle;"></div>',ye.disabled=!0;const o=()=>{Q(),ye.innerHTML=i,ye.disabled=!1},r="PLACEHOLDER_API_KEY";if(Se&&r)try{const u=await fetch(`https://texttospeech.googleapis.com/v1/text:synthesize?key=${r}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({input:{text:e},voice:{languageCode:"fr-FR",name:"fr-FR-Wavenet-E"},audioConfig:{audioEncoding:"MP3",speakingRate:T.playbackSpeed}})});if(!u.ok)throw new Error("Preview TTS failed");const l=await u.json(),c=zn();if(!c)return;const d=await c.decodeAudioData(Do(l.audioContent)),p=c.createBufferSource();p.buffer=d,p.connect(c.destination),p.start(0),Ne=p,p.onended=o}catch(u){console.error("Voice preview failed",u),o()}else{if(typeof speechSynthesis>"u"){console.error("Speech Synthesis API is not supported in this browser."),o();return}const u=new SpeechSynthesisUtterance(e),l=speechSynthesis.getVoices(),c=l.find(d=>d.name===T.voiceName);u.voice=c||l.find(d=>d.lang.startsWith(T.uiLang))||null,u.pitch=T.pitch,u.rate=T.playbackSpeed,u.onend=o,u.onerror=d=>{console.error("Native TTS Preview Error:",d.error),o()},speechSynthesis.speak(u)}}function Qu(){gn.addEventListener("click",()=>{Oe.classList.add("settings-visible"),Ut()}),yn.addEventListener("click",()=>Oe.classList.remove("settings-visible"));const n=()=>{T.userRole=Cn.value,T.userLevel=$t.value,fe(),Fo(),D.length<=1&&Vt()};Cn.addEventListener("change",n),$t.addEventListener("change",n),Pt.addEventListener("change",()=>{T.uiLang=Pt.value,Ft(T.uiLang),Se||xn(),fe()}),_t.addEventListener("click",e=>{const t=e.target;if(t.matches(".theme-button")){T.theme=t.dataset.theme,Bn.setAttribute("data-theme",T.theme);const i=_t.querySelector(".active");i&&(i.classList.remove("active"),i.setAttribute("aria-pressed","false")),t.classList.add("active"),t.setAttribute("aria-pressed","true"),fe()}}),Nt.addEventListener("click",e=>{const t=e.target;if(t.matches(".text-size-button")){T.textSize=t.dataset.size,Oe.setAttribute("data-text-size",T.textSize);const i=Nt.querySelector(".active");i&&(i.classList.remove("active"),i.setAttribute("aria-pressed","false")),t.classList.add("active"),t.setAttribute("aria-pressed","true"),fe()}}),qt.addEventListener("click",e=>{const t=e.target;if(t.matches(".playback-speed-button")){T.playbackSpeed=parseFloat(t.dataset.speed||"1");const i=qt.querySelector(".active");i&&(i.classList.remove("active"),i.setAttribute("aria-pressed","false")),t.classList.add("active"),t.setAttribute("aria-pressed","true"),fe()}}),vn.addEventListener("change",()=>{T.soundEnabled=vn.checked,fe()}),Ui.addEventListener("change",e=>{const t=e.target;t.name==="sound-theme"&&(T.soundTheme=t.value,Ve("receive"),fe())}),Ui.querySelectorAll(".preview-button").forEach(e=>{e.addEventListener("click",()=>{const t=e.getAttribute("data-theme");t&&Ve("receive",t)})}),H.addEventListener("change",()=>{const e=H.options[H.selectedIndex];T.voiceName=e.getAttribute("data-name")||"",fe()}),En.addEventListener("input",()=>{T.pitch=parseFloat(En.value),fe()}),ye.addEventListener("click",Wu),Ru.addEventListener("click",()=>{Q(),localStorage.removeItem("senProfAssistantHistory"),D=[],te.innerHTML="";const e=M[T.uiLang].welcomeMessage;Ie(e,"ai"),D.push({sender:"ai",content:e}),Oe.classList.remove("settings-visible")})}function fe(){try{localStorage.setItem("senProfAssistantSettings",JSON.stringify(T))}catch(n){console.warn("Could not save settings to localStorage:",n)}}function Zu(){var u;try{const l=localStorage.getItem("senProfAssistantSettings");l&&(T={...T,...JSON.parse(l)})}catch(l){console.warn("Could not load settings from localStorage:",l)}Ju(),Bn.setAttribute("data-theme",T.theme);const n=_t.querySelector(".active");n&&(n.classList.remove("active"),n.setAttribute("aria-pressed","false"));const e=_t.querySelector(`[data-theme="${T.theme}"]`);e&&(e.classList.add("active"),e.setAttribute("aria-pressed","true")),Oe.setAttribute("data-text-size",T.textSize);const t=Nt.querySelector(".active");t&&(t.classList.remove("active"),t.setAttribute("aria-pressed","false"));const i=Nt.querySelector(`[data-size="${T.textSize}"]`);i&&(i.classList.add("active"),i.setAttribute("aria-pressed","true"));const o=qt.querySelector(".active");o&&(o.classList.remove("active"),o.setAttribute("aria-pressed","false"));const r=qt.querySelector(`[data-speed="${T.playbackSpeed}"]`);r&&(r.classList.add("active"),r.setAttribute("aria-pressed","true")),vn.checked=T.soundEnabled,(u=document.querySelector(`input[name="sound-theme"][value="${T.soundTheme}"]`))==null||u.setAttribute("checked","true"),Pt.value=T.uiLang,Cn.value=T.userRole,$t.value=T.userLevel,En.value=String(T.pitch)}function Bo(){localStorage.setItem("senProfAssistantFavorites",JSON.stringify(de))}function Xu(){try{const n=localStorage.getItem("senProfAssistantFavorites");n&&(de=JSON.parse(n))}catch(n){console.warn("Could not load favorites",n),de=[]}}function Ut(){const n=M[T.uiLang];if(ut.innerHTML="",de.length===0){ut.innerHTML=`<p class="no-favorites">${n.noFavorites}</p>`;return}de.forEach((e,t)=>{const i=document.createElement("div");i.className="favorite-item",i.innerHTML=`
      <a href="${e.url}" target="_blank" rel="noopener noreferrer">${e.title}</a>
      <button class="remove-favorite-button" data-index="${t}" aria-label="${n.removeFavorite}" title="${n.removeFavorite}">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
      </button>
    `,ut.appendChild(i)}),ut.querySelectorAll(".remove-favorite-button").forEach(e=>{e.addEventListener("click",t=>{const i=parseInt(t.currentTarget.dataset.index,10);de.splice(i,1),Bo(),Ut(),te.querySelectorAll(".message.ai").forEach(o=>{const r=o.querySelector(".interactive-elements");r&&r.remove(),Hn(o)})})})}async function ju(){var d;if(!Ae)return[];const{userRole:n,userLevel:e,uiLang:t}=T,i=M[t]||M.fr,r={enseignant:"roleTeacher",eleve:"roleStudent",parent:"roleParent"}[n],u=i[r]||n,l=((d=qo.find(p=>p.value===e))==null?void 0:d.key)||e,c=`You are an assistant for Nebula, an educational platform. A user with the profile '${u}' for school level '${l}' is using the chat. The current interface language is '${t}'. Generate 3 short, relevant, and engaging questions (max 50 chars) in the language '${t}' that this user might ask. These questions will be displayed as clickable suggestion chips. For a teacher, suggest lesson plans or resources. For a student, suggest exercises or explanations. For a parent, suggest ways to help their child. Respond ONLY with a JSON object containing a "suggestions" array of strings.`;try{const p=await Ae.models.generateContent({model:"gemini-2.5-flash",contents:c,config:{responseMimeType:"application/json",responseSchema:{type:_.OBJECT,properties:{suggestions:{type:_.ARRAY,items:{type:_.STRING}}}}}}),f=JSON.parse(p.text);return f.suggestions&&Array.isArray(f.suggestions)&&f.suggestions.length>0?f.suggestions.slice(0,3):[]}catch(p){return console.error("Failed to generate suggestions:",p),[]}}async function Vt(){if(D.length>1){j.classList.add("hidden"),j.innerHTML="";return}if(Wt||Y.value.trim()!=="")return;Wt=!0,j.innerHTML="",j.classList.remove("hidden");for(let e=0;e<3;e++){const t=document.createElement("div");t.className="suggestion-chip-placeholder",j.appendChild(t)}let n=[];try{n=await ju()}finally{Wt=!1}if(n.length===0&&(n=qu),Y.value.trim()!==""||hn.classList.contains("hidden")===!1){j.classList.add("hidden"),j.innerHTML="";return}j.innerHTML="",n.slice(0,3).forEach(e=>{const t=document.createElement("button");t.className="suggestion-chip",t.textContent=e,t.addEventListener("click",()=>{Y.value=e,it.requestSubmit()}),j.appendChild(t)})}function ec(){Tn.addEventListener("click",()=>Ge.classList.remove("hidden")),Pu.addEventListener("click",()=>Ge.classList.add("hidden")),Ge.addEventListener("click",n=>{n.target===Ge&&Ge.classList.add("hidden")}),gt.addEventListener("click",ic),_u.addEventListener("click",oc)}function tc(){Ze.addEventListener("click",()=>fn.click()),fn.addEventListener("change",nc),Mu.addEventListener("click",On)}function nc(n){var i;const t=(i=n.target.files)==null?void 0:i[0];if(t&&t.type.startsWith("image/")){const o=new FileReader;o.onload=r=>{var c;const u=(c=r.target)==null?void 0:c.result;Te={base64:u.split(",")[1],mimeType:t.type,dataUrl:u},Lu.src=u,No.classList.remove("hidden")},o.onerror=()=>{Dt(o.error,"imageLoadError"),On()},o.readAsDataURL(t)}}function On(){Te=null,fn.value="",No.classList.add("hidden")}async function ic(){const n=M[T.uiLang],e=`${n.appTitle}
${n.appSubtitle}

====================

`,t=n.userSender||"User",i=n.assistantSender||"Assistant",o=D.map(u=>`${u.sender==="user"?t:i}:
${u.content.replace(/<[^>]+>/g,"")}`).join(`

`),r=e+o;try{await navigator.clipboard.writeText(r);const u=gt.textContent;gt.textContent=n.transcriptionCopied,setTimeout(()=>{gt.textContent=u},2e3)}catch(u){console.error("Failed to copy text: ",u)}}function oc(){const n=M[T.uiLang],e=window.open("","_blank");e&&(e.document.write(`
      <html>
        <head>
          <title>${n.appTitle} - Conversation</title>
          <link rel="stylesheet" href="index.css">
        </head>
        <body class="pdf-export" data-theme="${T.theme}">
          <div class="chat-container">
            <header>
              <div class="header-text">
                <h1>${n.appTitle}</h1>
                <p>${n.appSubtitle}</p>
              </div>
            </header>
            <div id="chat-history">${te.innerHTML}</div>
          </div>
        </body>
      </html>
    `),e.document.close(),e.focus(),setTimeout(()=>{e.print(),e.close()},500))}async function rc(){const n="PLACEHOLDER_API_KEY";try{Se=(await fetch(`https://texttospeech.googleapis.com/v1/text:synthesize?key=${n}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({input:{text:"test"},voice:{languageCode:"fr-FR",name:"fr-FR-Wavenet-E"},audioConfig:{audioEncoding:"MP3"}})})).ok}catch{Se=!1}Bn.dataset.ttsService=Se?"google":"native",Se||(typeof speechSynthesis<"u"&&speechSynthesis.onvoiceschanged!==void 0&&(speechSynthesis.onvoiceschanged=xn),xn())}async function sc(){Zu(),Ft(T.uiLang),Du(),Xu(),Ku(),Yu(),Qu(),ec(),tc(),mn.addEventListener("click",Ou),await rc();const n="PLACEHOLDER_API_KEY";{if(Ae=new fo({apiKey:n}),Fo(),Bu(),it.addEventListener("submit",zu),Y.addEventListener("input",()=>{Y.value.trim()!==""?j.classList.add("hidden"):Vt()}),D.length===0){const e=M[T.uiLang].welcomeMessage;Ie(e,"ai"),D.push({sender:"ai",content:e})}Vt()}}sc();
